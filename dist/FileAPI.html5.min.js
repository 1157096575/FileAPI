/*! fileapi 2.0.0 - BSD | git://github.com/mailru/FileAPI.git */
(function(e){"use strict";var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,n=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),i=n&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),a=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,r=(n||a)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,r,o,s,l,u;for(t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURIComponent(e.split(",")[1]),r=new ArrayBuffer(t.length),o=new Uint8Array(r),s=0;t.length>s;s+=1)o[s]=t.charCodeAt(s);return l=e.split(",")[0].split(":")[1].split(";")[0],n?new Blob([i?o:r],{type:l}):(u=new a,u.append(r),u.getBlob(l))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,t){e(this.mozGetAsFile("blob",t))}:t.toDataURL&&r&&(t.toBlob=function(e,t,n){e(r(this.toDataURL(t,n)))})),"function"==typeof define&&define.amd?define(function(){return r}):e.dataURLtoBlob=r})(window),function(e,t,n){"use strict";function i(e,t,n,i,a){var r={type:n.type||n,target:e,result:i};Q.extend(r,a),t(r)}function a(e){return y&&!!y.prototype["readAs"+e]}function r(e,t,r,o){if(Q.isFile(e)&&a(r)){var s=new y;N(s,z,function l(n){var a=n.type;"progress"==a?i(e,t,n,n.target.result,{loaded:n.loaded,total:n.total}):"loadend"==a?(P(s,z,l),s=null):i(e,t,n,n.target.result)});try{o?s["readAs"+r](o,e):s["readAs"+r](e)}catch(u){i(e,t,"error",n,{error:""+u})}}else i(e,t,"error",n,{error:"filreader_not_support_"+r})}function o(e,t){if(!e.type&&0===e.size%4096&&102400>=e.size)if(y)try{var n=new y;X(n,z,function(e){var i="error"!=e.type;t(i),i&&n.abort()}),n.readAsDataURL(e)}catch(i){t(!1)}else t(null);else t(!0)}function s(e){var t;return e.getAsEntry?t=e.getAsEntry():e.webkitGetAsEntry&&(t=e.webkitGetAsEntry()),t}function l(e,t){if(e)if(e.isFile)e.file(function(e){t(!1,[e])},function(){t("entry_file")});else if(e.isDirectory){var n=e.createReader(),i=[];n.readEntries(function(e){Q.afor(e,function(e,n){l(n,function(n,a){n||(i=i.concat(a)),e?e():t(!1,i)})})},function(){t("directory_reader")})}else l(s(e),t);else t("empty_entry")}function u(e){var t={};return q(e,function(e,n){e&&"object"==typeof e&&void 0===e.nodeType&&(e=Q.extend({},e)),t[n]=e}),t}function c(e){return _.test(e&&e.tagName)}function f(e){return(e.originalEvent||e||"").dataTransfer||{}}var d=1,p=function(){},h=e.document,m=e.navigator.userAgent,g=e.createObjectURL&&e||e.URL&&URL.revokeObjectURL&&URL||e.webkitURL&&webkitURL,v=e.File,y=e.FileReader,b=e.FormData,w=!(!v||!(y&&e.Uint8Array||b)||/safari\//.test(m)&&/windows/i.test(m)),x=w&&"withCredentials"in new XMLHttpRequest,A=w&&!!Blob&&!!(Blob.prototype.webkitSlice||Blob.prototype.mozSlice||Blob.prototype.slice),F=e.dataURLtoBlob,R=/img/i,T=/canvas/i,I=/img|canvas/i,_=/input/i,U=/^data:[^,]+,/,B=e.Number,L=e.Math,D=L.pow,E=L.round,k=function(e){return e=new B(D(1024,e)),e.from=function(e){return E(e*this)},e},H={},C=[],z="abort progress error load loadend",S="status statusText readyState response responseXML responseText responseBody".split(" "),j="currentTarget",M="preventDefault",O=function(e){return"object"==typeof e&&e&&"length"in e},q=function(e,t,n){if(e)if(O(e))for(var i=0,a=e.length;a>i;i++)i in e&&t.call(n,e[i],i,e);else for(var r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)},N=function(e,n,i){if(e){var a=Q.uid(e);H[a]||(H[a]={}),q(n.split(/\s+/),function(n){t?t.event.add(e,n,i):(H[a][n]||(H[a][n]=[]),H[a][n].push(i),e.addEventListener?e.addEventListener(n,i,!1):e.attachEvent?e.attachEvent("on"+n,i):e["on"+n]=i)})}},P=function(e,n,i){if(e){var a=Q.uid(e),r=H[a]||{};q(n.split(/\s+/),function(n){if(t)t.event.remove(e,n,i);else{for(var a=r[n]||[],o=a.length;o--;)if(a[o]===i){a.splice(o,1);break}e.addEventListener?e.removeEventListener(n,i,!1):e.detachEvent?e.detachEvent("on"+n,i):e["on"+n]=null}})}},X=function(e,t,n){N(e,t,function i(a){P(e,t,i),n(a)})},W=function(t){return t.target||(t.target=e.event&&e.event.srcElement||h),3===t.target.nodeType&&(t.target=t.target.parentNode),t},G=function(e){var t=h.createElement("input");return t.setAttribute("type","file"),e in t},Q={version:"2.0.0b",cors:!1,debug:!1,pingUrl:!1,multiFlash:!1,staticPath:"./dist/",flashUrl:0,flashImageUrl:0,accept:{"image/*":"art bm bmp dwg dxf cbr cbz fif fpx gif ico iefs jfif jpe jpeg jpg jps jut mcf nap nif pbm pcx pgm pict pm png pnm qif qtif ras rast rf rp svf tga tif tiff xbm xbm xpm xwd","audio/*":"m4a flac aac rm mpa wav wma ogg mp3 mp2 m3u mod amf dmf dsm far gdm imf it m15 med okt s3m stm sfx ult uni xm sid ac3 dts cue aif aiff wpl ape mac mpc mpp shn wv nsf spc gym adplug adx dsp adp ymf ast afc hps xs","video/*":"m4v 3gp nsv ts ty strm rm rmvb m3u ifo mov qt divx xvid bivx vob nrg img iso pva wmv asf asx ogm m2v avi bin dat dvr-ms mpg mpeg mp4 mkv avc vp3 svq3 nuv viv dv fli flv wpl"},chunkSize:0,chunkUploadRetry:0,chunkNetworkDownRetryTimeout:2e3,KB:k(1),MB:k(2),GB:k(3),TB:k(4),expando:"fileapi"+(new Date).getTime(),uid:function(e){return e?e[Q.expando]=e[Q.expando]||Q.uid():(++d,Q.expando+d)},log:function(){Q.debug&&e.console&&console.log&&(console.log.apply?console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},getXHR:function(){var t;if(e.XMLHttpRequest)t=new XMLHttpRequest;else if(e.ActiveXObject)try{t=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(n){}return t},isArray:O,support:{dnd:x&&"ondrop"in h.createElement("div"),cors:x,html5:w,chunked:A,dataURI:!0,accept:G("accept"),multiple:G("multiple")},event:{on:N,off:P,one:X,fix:W},throttle:function(t,n){var i,a;return function(){a=arguments,i||(t.apply(e,a),i=setTimeout(function(){i=0,t.apply(e,a)},n))}},F:function(){},parseJSON:function(t){var n;return n=e.JSON&&JSON.parse?JSON.parse(t):Function("return ("+t.replace(/([\r\n])/g,"\\$1")+");")()},trim:function(e){return e+="",e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},defer:function(){var e,t,i=[],a={resolve:function(n,r){for(a.resolve=p,t=n||!1,e=r;r=i.shift();)r(t,e)},then:function(a){t!==n?a(t,e):i.push(a)}};return a},queue:function(e){var t=0,n=0,i=!1,a=!1,r={inc:function(){n++},next:function(){t++,setTimeout(r.check,0)},check:function(){t>=n&&!i&&r.end()},isFail:function(){return i},fail:function(){!i&&e(i=!0)},end:function(){a||(a=!0,e())}};return r},each:q,afor:function(e,t){var n=0,i=e.length;O(e)&&i--?function a(){t(i!=n&&a,e[n],n++)}():t(!1)},extend:function(e){for(var t=arguments,n=1,i=function(t,n){e[n]=t};t.length>n;n++)q(t[n],i);return e},isFile:function(e){return w&&e&&e instanceof v},isCanvas:function(e){return e&&T.test(e.nodeName)},getFilesFilter:function(e){return e="string"==typeof e?e:e.getAttribute&&e.getAttribute("accept")||"",e?RegExp("("+e.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(e,t){Q.isCanvas(e)?i(e,t,"load",Q.toDataURL(e)):r(e,t,"DataURL")},readAsBinaryString:function(e,t){a("BinaryString")?r(e,t,"BinaryString"):r(e,function(e){if("load"==e.type)try{e.result=Q.toBinaryString(e.result)}catch(n){e.type="error",e.message=""+n}t(e)},"DataURL")},readAsArrayBuffer:function(e,t){r(e,t,"ArrayBuffer")},readAsText:function(e,t,n){n||(n=t,t="utf-8"),r(e,n,"Text",t)},toDataURL:function(e){return"string"==typeof e?e:e.toDataURL?e.toDataURL("image/png"):void 0},toBinaryString:function(t){return e.atob(Q.toDataURL(t).replace(U,""))},readAsImage:function(e,t,a){if(Q.isFile(e))if(g){var r=g.createObjectURL(e);r===n?i(e,t,"error"):Q.readAsImage(r,t,a)}else Q.readAsDataURL(e,function(n){"load"==n.type?Q.readAsImage(n.result,t,a):(a||"error"==n.type)&&i(e,t,n,null,{loaded:n.loaded,total:n.total})});else if(Q.isCanvas(e))i(e,t,"load",e);else if(R.test(e.nodeName))if(e.complete)i(e,t,"load",e);else{var o="error abort load";X(e,o,function s(n){"load"==n.type&&g&&g.revokeObjectURL(e.src),P(e,o,s),i(e,t,n,e)})}else if(e.iframe)i(e,t,{type:"error"});else{var l=new Image;l.src=e.dataURL||e,Q.readAsImage(l,t,a)}},checkFileObj:function(e){var t={},n=Q.accept;return"object"==typeof e?t=e:t.name=(e+"").split(/\\|\//g).pop(),null==t.type&&(t.type=t.name.split(".").pop()),q(n,function(e,n){e=RegExp(e.replace(/\s/g,"|"),"i"),e.test(t.type)&&(t.type=n.split("/")[0]+"/"+t.type)}),t},getDropFiles:function(e,t){var n=[],i=f(e),a=O(i.items)&&i.items[0]&&s(i.items[0]),r=Q.queue(function(){t(n)});q((a?i.items:i.files)||[],function(e){r.inc(),a?l(e,function(e,t){!e&&n.push.apply(n,t),r.next()}):o(e,function(t){t&&n.push(e),r.next()})}),r.check()},getFiles:function(e,t,n){var i=[];return n?(Q.filterFiles(Q.getFiles(e),t,n),null):(e.jquery&&(e.each(function(){i=i.concat(Q.getFiles(this))}),e=i,i=[]),"string"==typeof t&&(t=Q.getFilesFilter(t)),e.originalEvent?e=W(e.originalEvent):e.srcElement&&(e=W(e)),e.dataTransfer?e=e.dataTransfer:e.target&&(e=e.target),e.files?i=e.files:!w&&c(e)?Q.trim(e.value)&&(i=[Q.checkFileObj(e.value)],i[0].blob=e,i[0].iframe=!0):O(e)&&(i=e),Q.filter(i,function(e){return!t||t.test(e.name)}))},getTotalSize:function(e){for(var t=0,n=e&&e.length;n--;)t+=e[n].size;return t},getInfo:function(e,t){var n={},i=C.concat();Q.isFile(e)?function a(){var r=i.shift();r?r.test(e.type)?r(e,function(e,i){e?t(e):(Q.extend(n,i),a())}):a():t(!1,n)}():t("not_support_info",n)},addInfoReader:function(e,t){t.test=function(t){return e.test(t)},C.push(t)},filter:function(e,t){for(var n,i=[],a=0,r=e.length;r>a;a++)a in e&&(n=e[a],t.call(n,n,a,e)&&i.push(n));return i},filterFiles:function(e,t,n){if(e.length){var i,a=e.concat(),r=[],o=[];(function s(){a.length?(i=a.shift(),Q.getInfo(i,function(e,n){(t(i,e?!1:n)?r:o).push(i),s()})):n(r,o)})()}else n([],e)},upload:function(e){e=Q.extend({prepare:Q.F,beforeupload:Q.F,upload:Q.F,fileupload:Q.F,fileprogress:Q.F,filecomplete:Q.F,progress:Q.F,complete:Q.F,pause:Q.F,chunkSize:Q.chunkSize,chunkUpoloadRetry:Q.chunkUploadRetry},e),e.imageAutoOrientation&&!e.imageTransform&&(e.imageTransform={rotate:"auto"});var t,n=new Q.XHR(e),i=this._getFilesDataArray(e.files),a=this,r=0,o=0,s=!1;return q(i,function(e){r+=e.size}),n.files=[],q(i,function(e){n.files.push(e.file)}),n.total=r,n.loaded=0,e.beforeupload(n,e),t=function(){var l=i.shift(),c=l&&l.file,f=!1,d=u(e);("abort"!=n.statusText||n.current)&&l?(s=!1,n.currentFile=c,e.prepare(c,d),a._getFormData(d,l,function(i){o||e.upload(n,e);var s=new Q.XHR(Q.extend({},d,{upload:function(){e.fileupload(c,s,d)},progress:function(t){f||(e.fileprogress({type:"progress",total:l.total=t.total,loaded:l.loaded=t.loaded},c,s,d),e.progress({type:"progress",total:r,loaded:n.loaded=0|o+l.size*(t.loaded/t.total)},c,s,d))},complete:function(i){q(S,function(e){n[e]=s[e]}),l.loaded=l.total,this.progress(l),o+=l.size,n.loaded=o,e.filecomplete(i,s,c,d),f=!0,t.call(a)}}));n.abort=function(e){this.current=e,s.abort()},s.send(i)})):(e.complete(200==n.status||201==n.status?!1:n.statusText||"error",n,e),s=!0)},setTimeout(t,0),n.append=function(e){e=Q._getFilesDataArray([].concat(e)),q(e,function(e){r+=e.size,n.files.push(e.file),i.push(e)}),s&&t.call(a)},n.remove=function(e){for(var t,n=i.length;n--;)i[n].file==e&&(t=i.splice(n,1),r-=t.size);return t},n},_getFilesDataArray:function(e){var t=[],n={};if(c(e)){var i=Q.getFiles(e);n[e.name||"file"]=null!==e.getAttribute("multiple")?i:i[0]}else O(e)&&c(e[0])?q(e,function(e){n[e.name||"file"]=Q.getFiles(e)}):n=e;return q(n,function a(e,n){O(e)?q(e,function(e){a(e,n)}):e&&(e.name||e.image)&&t.push({name:n,file:e,size:e.size,total:e.size,loaded:0})}),t},_getFormData:function(e,t,n){var i=t.file,a=t.name,r=i.name,o=i.type,s=Q.support.transform&&e.imageTransform,l=new Q.Form,u=Q.queue(function(){n(l)}),c=s&&(parseInt(s.maxWidth||s.minWidth||s.width,10)>0||s.rotate||s.crop||s.type||s.quality||s.overlay);(function f(t){t.image?(u.inc(),t.get(function(e,t){r=r||""+new Date+".png",f(t),u.next()})):Q.Image&&s&&(/^image/.test(t.type)||I.test(t.nodeName))?(u.inc(),c&&(s=[s]),Q.Image.transform(t,s,e.imageAutoOrientation,function(n,i){c&&!n?(F||Q.flashEngine||(l.multipart=!0),l.append(a,i[0],r,s[0].type||o)):(n||(q(i,function(e,t){F||Q.flashEngine||(l.multipart=!0),l.append(a+"["+t+"]",e,r,s[t].type||o)}),a+="[original]"),(n||e.imageOriginal)&&l.append(a,t,r,o)),u.next()})):l.append(a,t,r)})(i),q(e.data,function d(e,t){"object"==typeof e?q(e,function(e,n){d(e,t+"["+n+"]")}):l.append(t,e)}),u.check()},reset:function(e){var n,i;return t?(i=t(e).clone(!0).insertBefore(e).val("")[0],t(e).remove()):(n=e.parentNode,i=n.insertBefore(e.cloneNode(!0),e),i.value="",n.removeChild(e),q(H[Q.uid(e)],function(t,n){q(t,function(t){P(e,n,t),N(i,n,t)})})),i},load:function(e,t){var n=Q.getXHR();return n?(n.open("GET",e,!0),n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),N(n,"progress",function(e){e.lengthComputable&&t({type:e.type,loaded:e.loaded,total:e.total},n)}),n.onreadystatechange=function(){if(4==n.readyState)if(n.onreadystatechange=null,200==n.status){e=e.split("/");var i={name:e[e.length-1],size:n.getResponseHeader("Content-Length"),type:n.getResponseHeader("Content-Type")};i.dataURL="data:"+i.type+";base64,"+Q.encode64(n.responseBody||n.responseText),t({type:"load",result:i})}else t({type:"error"})},n.send(null)):t({type:"error"}),n},encode64:function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="",i=0;for("string"!=typeof e&&(e+="");e.length>i;){var a,r,o=255&e.charCodeAt(i++),s=255&e.charCodeAt(i++),l=255&e.charCodeAt(i++),u=o>>2,c=(3&o)<<4|s>>4;isNaN(s)?a=r=64:(a=(15&s)<<2|l>>6,r=isNaN(l)?64:63&l),n+=t.charAt(u)+t.charAt(c)+t.charAt(a)+t.charAt(r)}return n}};Q.addInfoReader(/^image/,function(e,t){if(!e.__dimensions){var n=e.__dimensions=Q.defer();Q.readAsImage(e,function(e){var t=e.target;n.resolve("load"==e.type?!1:"error",{width:t.width,height:t.height}),t=null})}e.__dimensions.then(t)}),Q.event.dnd=function(e,t,n){var i,a;n||(n=t,t=Q.F),y?(N(e,"dragenter dragleave dragover",function(e){for(var n=f(e).types,r=n&&n.length,o=!1;r--;)if(~n[r].indexOf("File")){e[M](),a!==e.type&&(a=e.type,"dragleave"!=a&&t.call(e[j],!0,e),o=!0);break}o&&(clearTimeout(i),i=setTimeout(function(){t.call(e[j],"dragleave"!=a,e)},50))}),N(e,"drop",function(e){e[M](),a=0,t.call(e[j],!1,e),Q.getDropFiles(e,function(t){n.call(e[j],t,e)})})):Q.log("Drag'n'Drop -- not supported")},Q.event.dnd.off=function(e,t,n){P(e,"dragenter dragleave dragover",t),P(e,"drop",n)},t&&!t.fn.dnd&&(t.fn.dnd=function(e,t){return this.each(function(){Q.event.dnd(this,e,t)})},t.fn.offdnd=function(e,t){return this.each(function(){Q.event.dnd.off(this,e,t)})}),e.FileAPI=Q.extend(Q,e.FileAPI),Q.flashUrl||(Q.flashUrl=Q.staticPath+"FileAPI.flash.swf"),Q.flashImageUrl||(Q.flashImageUrl=Q.staticPath+"FileAPI.flash.image.swf")}(window,window.jQuery),function(e,t,n){"use strict";function i(t){if(t instanceof i){var n=new i(t.file);return e.extend(n.matrix,t.matrix),n}return this instanceof i?(this.file=t,this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0,quality:1},void 0):new i(t)}var a=Math.min,r=Math.round,o=function(){return t.createElement("canvas")},s=!1,l={8:270,3:180,6:90};try{s=o().toDataURL("image/png").indexOf("data:image/png")>-1}catch(u){}i.prototype={image:!0,constructor:i,set:function(t){return e.extend(this.matrix,t),this},crop:function(e,t,i,a){return i===n&&(i=e,a=t,e=t=0),this.set({sx:e,sy:t,sw:i,sh:a||i})},resize:function(e,t,n){return"string"==typeof t&&(n=t,t=e),this.set({dw:e,dh:t,resize:n})},preview:function(e,t){return this.resize(e,t||e,"preview")},rotate:function(e){return this.set({deg:e})},overlay:function(e){return this.set({overlay:e})},clone:function(){return new i(this)},_load:function(t,n){var i=this;/img|video/i.test(t.nodeName)?n.call(i,null,t):e.readAsImage(t,function(e){n.call(i,"load"!=e.type,e.result)})},_apply:function(t,n){for(var i,r=o(),s=this.getMatrix(t),l=r.getContext("2d"),u=t.videoWidth||t.width,c=t.videoHeight||t.height,f=s.deg,d=s.dw,p=s.dh,h=u,m=c,g=t,v=s.overlay,y=e.queue(function(){n(!1,r)});a(h/d,m/p)>2;)h=0|h/2+.5,m=0|m/2+.5,i=o(),i.width=h,i.height=m,g!==t?(i.getContext("2d").drawImage(g,0,0,g.width,g.height,0,0,h,m),g=i):(g=i,g.getContext("2d").drawImage(t,s.sx,s.sy,s.sw,s.sh,0,0,h,m),s.sx=s.sy=s.sw=s.sh=0);r.width=f%180?p:d,r.height=f%180?d:p,r.type=s.type,r.quality=s.quality,l.rotate(f*Math.PI/180),l.drawImage(g,s.sx,s.sy,s.sw||g.width,s.sh||g.height,180==f||270==f?-d:0,90==f||180==f?-p:0,d,p),d=r.width,p=r.height,v&&e.each([].concat(v),function(t){y.inc();var n=new window.Image,i=function(){var a=0|t.x,r=0|t.y,o=t.w||n.width,s=t.h||n.height,u=t.rel;a=1==u||4==u||7==u?(d-o+a)/2:2==u||5==u||8==u?d-(o+a):a,r=3==u||4==u||5==u?(p-s+r)/2:u>=6?p-(s+r):r,e.event.off(n,"error load abort",i);try{l.globalAlpha=t.opacity||1,l.drawImage(n,a,r,o,s)}catch(c){}y.next()};e.event.on(n,"error load abort",i),n.src=t.src,n.complete&&i()}),y.check()},getMatrix:function(t){var n=e.extend({},this.matrix),i=n.sw=n.sw||t.videoWidth||t.width,o=n.sh=n.sh||t.videoHeight||t.height,s=n.dw=n.dw||i,l=n.dh=n.dh||o,u=i/o,c=s/l,f=n.resize;if("preview"==f){if(s!=i||l!=o){var d,p;c>=u?(d=i,p=d/c):(p=o,d=p*c),(d!=i||p!=o)&&(n.sx=~~((i-d)/2),n.sy=~~((o-p)/2),i=d,o=p)}}else f&&("min"==f?(s=r(c>u?a(i,s):l*u),l=r(c>u?s/u:a(o,l))):(s=r(u>=c?a(i,s):l*u),l=r(u>=c?s/u:a(o,l))));return n.sw=i,n.sh=o,n.dw=s,n.dh=l,n},_trans:function(e){this._load(this.file,function(t,n){t?e(t):this._apply(n,e)})},get:function(t){if(e.support.transform){var n=this,i=n.matrix;"auto"==i.deg?e.getInfo(n.file,function(e,a){i.deg=l[a&&a.exif&&a.exif.Orientation]||0,n._trans(t)}):n._trans(t)}else t("not_support_transform")},toData:function(e){this.get(e)}},i.exifOrientation=l,i.transform=function(t,a,r,o){function s(s,l){var u={},c=e.queue(function(e){o(e,u)});s?c.fail():e.each(a,function(e,a){if(!c.isFail()){var o=new i(l.nodeType?l:t);if("function"==typeof e?e(l,o):e.width?o[e.preview?"preview":"resize"](e.width,e.height,e.type):e.maxWidth&&(l.width>e.maxWidth||l.height>e.maxHeight)&&o.resize(e.maxWidth,e.maxHeight,"max"),e.crop){var s=e.crop;o.crop(0|s.x,0|s.y,s.w||s.width,s.h||s.height)}e.rotate===n&&r&&(e.rotate="auto"),o.set({deg:e.rotate,type:e.type||t.type||"image/png",quality:e.quality||1,overlay:e.overlay}),c.inc(),o.toData(function(e,t){e?c.fail():(u[a]=t,c.next())})}})}t.width?s(!1,t):e.getInfo(t,s)},e.each(["TOP","CENTER","BOTTOM"],function(t,n){e.each(["LEFT","CENTER","RIGHT"],function(e,a){i[t+"_"+e]=3*n+a,i[e+"_"+t]=3*n+a})}),e.support.canvas=e.support.transform=s,e.Image=i}(FileAPI,document),function(e,t){"use strict";function n(t,n){var i=t.blob,a=t.file;if(a){var r={"image/jpeg":".jpe?g","image/png":".png"},o=r[t.type]?t.type:"image/png",s=r[o]||".png",l=i.quality||1;a.match(RegExp(s+"$","i"))||(a+=s.replace("?","")),t.file=a,t.type=o,i.toBlob?i.toBlob(function(e){n(t,e)},o,l):i=e.toBinaryString(i.toDataURL(o,l))}return i}var i=t.document,a=t.FormData,r=function(){this.items=[]},o=t.encodeURIComponent;r.prototype={append:function(e,t,n,i){this.items.push({name:e,blob:t&&t.blob||t,file:n||t.name,type:i||t.type})},each:function(e){for(var t=0,n=this.items.length;n>t;t++)e.call(this,this.items[t])},toData:function(t,n){n._chunked=e.support.chunked&&n.chunkSize>0&&1==e.filter(this.items,function(e){return e.file}).length,e.support.html5?this.multipart?(e.log("FileAPI.Form.toMultipartData"),this.toMultipartData(t)):n._chunked?(e.log("FileAPI.Form.toPlainData"),this.toPlainData(t)):(e.log("FileAPI.Form.toFormData"),this.toFormData(t)):(e.log("FileAPI.Form.toHtmlData"),this.toHtmlData(t))},_to:function(t,n,i,a){var r=e.queue(function(){n(t)});this.each(function(e){i(e,t,r,a)}),r.check()},toHtmlData:function(t){this._to(i.createDocumentFragment(),t,function(t,n){var a,r=t.blob;t.file?(e.reset(r),r.name=t.name,n.appendChild(r)):(a=i.createElement("input"),a.name=t.name,a.type="hidden",a.value=r,n.appendChild(a))})},toPlainData:function(e){this._to({},e,function(e,t,i){e.file&&(t.type=e.file),e.blob.toBlob?(i.inc(),n(e,function(e,n){t.name=e.name,t.file=n,t.size=n.length,t.type=e.type,i.next()})):e.file?(t.name=e.blob.name,t.file=e.blob,t.size=e.blob.size,t.type=e.type):(t.params||(t.params=[]),t.params.push(o(e.name)+"="+o(e.blob))),t.start=-1,t.end=-1,t.retry=0})},toFormData:function(e){this._to(new a,e,function(e,t,i){e.blob&&e.blob.toBlob?(i.inc(),n(e,function(e,n){t.append(e.name,n,e.file),i.next()})):e.file?t.append(e.name,e.blob,e.file):t.append(e.name,e.blob),e.file&&t.append("_"+e.name,e.file)})},toMultipartData:function(t){this._to([],t,function(e,t,i,a){n(e,function(e,n){t.push("--_"+a+('\r\nContent-Disposition: form-data; name="'+e.name+'"'+(e.file?'; filename="'+o(e.file)+'"':"")+(e.file?"\r\nContent-Type: "+(e.type||"application/octet-stream"):"")+"\r\n"+"\r\n"+(e.file?n:o(n))+"\r\n"))})},e.expando)}},e.Form=r}(FileAPI,window),function(e,t){"use strict";var n=function(){},i=e.document,a=function(e){this.uid=t.uid(),this.xhr={abort:n,getResponseHeader:n,getAllResponseHeaders:n},this.options=e},r={"":1,XML:1,Text:1,Body:1};a.prototype={status:0,statusText:"",constructor:a,getResponseHeader:function(e){return this.xhr.getResponseHeader(e)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(i,a){var r=this,o=r.options;r.end=r.abort=n,r.status=i,a&&(r.statusText=a),t.log("xhr.end:",i,a),o.complete(200==i||201==i?!1:r.statusText||"unknown",r),r.xhr&&r.xhr.node&&setTimeout(function(){var t=r.xhr.node;try{t.parentNode.removeChild(t)}catch(n){}try{delete e[r.uid]}catch(n){}e[r.uid]=r.xhr.node=null},9)},abort:function(){this.end(0,"abort"),this.xhr&&(this.xhr.aborted=!0,this.xhr.abort())},send:function(e){var t=this,n=this.options;e.toData(function(e){n.upload(n,t),t._send.call(t,n,e)},n)},_send:function(n,a){var o,s=this,l=s.uid,u=n.url;if(t.log("XHR._send:",a),u+=(~u.indexOf("?")?"&":"?")+t.uid(),a.nodeName){n.upload(n,s),o=i.createElement("div"),o.innerHTML='<form target="'+l+'" action="'+u+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;">'+'<iframe name="'+l+'" src="javascript:false;"></iframe>'+'<input value="'+l+'" name="callback" type="hidden"/>'+"</form>",s.xhr.abort=function(){var e=o.getElementsByName("iframe")[0];if(e)try{e.stop?e.stop():e.contentWindow.stop?e.contentWindow.stop():e.contentWindow.document.execCommand("Stop")}catch(t){}o=null};var c=o.getElementsByTagName("form")[0];c.appendChild(a),t.log(c.parentNode.innerHTML),i.body.appendChild(o),s.xhr.node=o,e[l]=function(e,t,n){s.readyState=4,s.responseText=n,s.end(e,t),o=null},s.readyState=2,c.submit(),c=null}else if(o=s.xhr=t.getXHR(),a.params&&(u+=(0>u.indexOf("?")?"?":"&")+a.params.join("&")),o.open("POST",u,!0),o.withCredential="true",n.headers&&n.headers["X-Requested-With"]||o.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.each(n.headers,function(e,t){o.setRequestHeader(t,e)}),n._chunked){o.upload&&o.upload.addEventListener("progress",function(e){a.retry||n.progress({type:e.type,total:a.size,loaded:a.start+e.loaded,totalSize:a.size},s,n)},!1),o.onreadystatechange=function(){if(s.status=o.status,s.statusText=o.statusText,s.readyState=o.readyState,4==o.readyState){for(var e in r)s["response"+e]=o["response"+e];if(o.onreadystatechange=null,!o.status||o.status-201>0)if(t.log("Error: "+o.status),(!o.status&&!o.aborted||500==o.status||416==o.status)&&++a.retry<=n.chunkUploadRetry){var i=o.status?0:t.chunkNetworkDownRetryTimeout;n.pause(a.file,n);var l=o.getResponseHeader("X-Last-Known-Byte");t.log("X-Last-Known-Byte: "+l),a.end=l?parseInt(l,10):a.start-1,setTimeout(function(){s._send(n,a)},i)}else s.end(o.status);else a.retry=0,a.end==a.size-1?s.end(o.status):setTimeout(function(){s._send(n,a)},0);o=null}},a.start=a.end+1,a.end=Math.min(a.start+n.chunkSize,a.size)-1;var f;(f="slice")in a.file||(f="mozSlice")in a.file||(f="webkitSlice")in a.file,o.setRequestHeader("Content-Range","bytes "+a.start+"-"+a.end+"/"+a.size),o.setRequestHeader("Content-Disposition","attachment; filename="+encodeURIComponent(a.name)),o.setRequestHeader("Content-Type",a.type||"application/octet-stream"),f=a.file[f](a.start,a.end+1),o.send(f),f=null}else if(o.upload&&o.upload.addEventListener("progress",t.throttle(function(e){n.progress(e,s,n)},100),!1),o.onreadystatechange=function(){if(s.status=o.status,s.statusText=o.statusText,s.readyState=o.readyState,4==o.readyState){for(var e in r)s["response"+e]=o["response"+e];o.onreadystatechange=null,s.end(o.status),o=null}},t.isArray(a))if(o.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+t.expando),a=a.join("")+"--_"+t.expando+"--",o.sendAsBinary)o.sendAsBinary(a);else{var d=Array.prototype.map.call(a,function(e){return 255&e.charCodeAt(0)});o.send(new Uint8Array(d).buffer)}else o.send(a)}},t.XHR=a}(window,FileAPI),function(e,t){"use strict";function n(e){return e>=0?e+"px":e}function i(e){var t,n=r.createElement("canvas"),i=!1;try{t=n.getContext("2d"),t.drawImage(e,0,0),i=255!=t.getImageData(0,0,1,1).data[4]}catch(a){}return i}var a=e.URL||e.webkitURL,r=e.document,o=e.navigator,s=o.getUserMedia||o.webkitGetUserMedia||o.mozGetUserMedia||o.msGetUserMedia,l=!!s;t.support.media=l;var u=function(e){this.video=e};u.prototype={isActive:function(){return!!this._active},start:function(e){var t,n,r=this,l=r.video,u=function(i){r._active=!i,clearTimeout(n),clearTimeout(t),e&&e(i,r)};s.call(o,{video:!0},function(e){r.stream=e,l.src=a.createObjectURL(e),t=setInterval(function(){i(l)&&u(null)},1e3),n=setTimeout(function(){u("timeout")},5e3),l.play()},u)},stop:function(){try{this._active=!1,this.video.pause(),this.stream.stop()}catch(e){}},shot:function(){return new c(this.video)}},u.get=function(e){return new u(e.firstChild)},u.publish=function(i,a,o){if("function"==typeof a&&(o=a,a={}),a=t.extend({},{width:"100%",height:"100%",start:!0},a),i.jquery&&(i=i[0]),l){var s,c=r.createElement("video");c.style.width=n(a.width),c.style.height=n(a.height),e.jQuery?jQuery(i).empty():i.innerHTML="",i.appendChild(c),s=u.get(i),a.start?s.start(o):o(null,s)}else o("not_support_camera")};var c=function(e){var n=new t.Image(e);return n.type="image/png",n.width=e.videoWidth,n.height=e.videoHeight,n.size=4*n.width*n.height,n};t.Camera=u}(window,FileAPI),"function"==typeof define&&define.amd&&define("fileapi",[],function(){return fileapi});