/*! FileAPI v1.2.4 | 2013-03-07 | git://github.com/mailru/FileAPI.git */
(function(e){"use strict";var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,n=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),a=n&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),i=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,r=(n||i)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,r,o,s,l,u;for(t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURIComponent(e.split(",")[1]),r=new ArrayBuffer(t.length),o=new Uint8Array(r),s=0;t.length>s;s+=1)o[s]=t.charCodeAt(s);return l=e.split(",")[0].split(":")[1].split(";")[0],n?new Blob([a?o:r],{type:l}):(u=new i,u.append(r),u.getBlob(l))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,t){e(this.mozGetAsFile("blob",t))}:t.toDataURL&&r&&(t.toBlob=function(e,t){e(r(this.toDataURL(t)))})),"function"==typeof define&&define.amd?define(function(){return r}):e.dataURLtoBlob=r})(window),function(e,t){"use strict";function n(e,t,n,a,i){var r={type:n.type||n,target:e,result:a};$.extend(r,i),t(r)}function a(e){return g&&!!g.prototype["readAs"+e]}function i(e,i,r,o){if($.isFile(e)&&a(r)){var s=new g;G(s,O,function l(t){var a=t.type;"progress"==a?n(e,i,t,t.target.result,{loaded:t.loaded,total:t.total}):"loadend"==a?(K(s,O,l),s=null):n(e,i,t,t.target.result)});try{o?s["readAs"+r](o,e):s["readAs"+r](e)}catch(u){n(e,i,"error",t,{error:""+u})}}else n(e,i,"error",t,{error:"filreader_not_support_"+r})}function r(e,t){if(!e.type&&0===e.size%4096&&102400>=e.size)if(g)try{var n=new g;J(n,O,function(e){var a="error"!=e.type;t(a),a&&n.abort()}),n.readAsDataURL(e)}catch(a){t(!1)}else t(null);else t(!0)}function o(e){var t;return e.getAsEntry?t=e.getAsEntry():e.webkitGetAsEntry&&(t=e.webkitGetAsEntry()),t}function s(e,t){if(e)if(e.isFile)e.file(function(e){t(!1,[e])},function(){t("entry_file")});else if(e.isDirectory){var n=e.createReader(),a=[];n.readEntries(function(e){$.afor(e,function(e,n){s(n,function(n,i){n||(a=a.concat(i)),e?e():t(!1,a)})})},function(){t("directory_reader")})}else s(o(e),t);else t("empty_entry")}function l(e){var t={};return W(e,function(e,n){e&&"object"==typeof e&&(e=$.extend({},e)),t[n]=e}),t}function u(e){return B.test(e&&e.tagName)}function c(e){return(e.originalEvent||e||"").dataTransfer||{}}var f=1,d=function(){},p=e.navigator.userAgent,h=e.createObjectURL&&e||e.URL&&URL.revokeObjectURL&&URL||e.webkitURL&&webkitURL,m=e.File,g=e.FileReader,v=e.FormData,y=e.jQuery,b=!(!m||!(g&&e.Uint8Array||v)||/safari\//.test(p)&&/windows/i.test(p)),w=b&&"withCredentials"in new XMLHttpRequest,x=b&&!!Blob&&!!(Blob.prototype.webkitSlice||Blob.prototype.mozSlice||Blob.prototype.slice),A=e.document,F=e.dataURLtoBlob,R=/img/i,I=/canvas/i,T=/img|canvas/,B=/input/i,D=/^data:[^,]+,/,U=Number,_=_,L=_.pow,k=_.round,E=function(e){return k(e*this)},C=new U(1024),S=new U(L(C,2)),H=new U(L(C,3)),z=new U(L(C,4)),M={},j=[],O="abort progress error load loadend",P="status statusText readyState response responseXML responseText responseBody".split(" "),N="currentTarget",X="preventDefault",q=function(e){return"object"==typeof e&&e&&"length"in e},W=function(e,t,n){if(e)if(q(e))for(var a=0,i=e.length;i>a;a++)a in e&&t.call(n,e[a],a,e);else for(var r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)},G=function(e,t,n){if(e){var a=$.uid(e);M[a]||(M[a]={}),W(t.split(/\s+/),function(t){y?y.event.add(e,t,n):(M[a][t]||(M[a][t]=[]),M[a][t].push(n),e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n)})}},K=function(e,t,n){if(e){var a=$.uid(e),i=M[a]||{};W(t.split(/\s+/),function(t){if(y)y.event.remove(e,t,n);else{for(var a=i[t]||[],r=a.length;r--;)if(a[r]===n){a.splice(r,1);break}e.addEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null}})}},J=function(e,t,n){G(e,t,function a(i){K(e,t,a),n(i)})},Q=function(t){return t.target||(t.target=e.event&&e.event.srcElement||A),3===t.target.nodeType&&(t.target=t.target.parentNode),t},$={version:"1.2.4",cors:!1,debug:!1,pingUrl:!1,staticPath:"./",flashUrl:0,flashImageUrl:0,accept:{"image/*":"art bm bmp dwg dxf cbr cbz fif fpx gif ico iefs jfif jpe jpeg jpg jps jut mcf nap nif pbm pcx pgm pict pm png pnm qif qtif ras rast rf rp svf tga tif tiff xbm xbm xpm xwd","audio/*":"m4a flac aac rm mpa wav wma ogg mp3 mp2 m3u mod amf dmf dsm far gdm imf it m15 med okt s3m stm sfx ult uni xm sid ac3 dts cue aif aiff wpl ape mac mpc mpp shn wv nsf spc gym adplug adx dsp adp ymf ast afc hps xs","video/*":"m4v 3gp nsv ts ty strm rm rmvb m3u ifo mov qt divx xvid bivx vob nrg img iso pva wmv asf asx ogm m2v avi bin dat dvr-ms mpg mpeg mp4 mkv avc vp3 svq3 nuv viv dv fli flv wpl"},chunkSize:0,chunkUploadRetry:0,chunkNetworkDownRetryTimeout:2e3,KB:(C.from=E,C),MB:(S.from=E,S),GB:(H.from=E,H),TB:(z.from=E,z),expando:"fileapi"+(new Date).getTime(),uid:function(e){return e?e[$.expando]=e[$.expando]||$.uid():(++f,$.expando+f)},log:function(){$.debug&&e.console&&console.log&&(console.log.apply?console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},getXHR:function(){var t;if(e.XMLHttpRequest)t=new XMLHttpRequest;else if(e.ActiveXObject)try{t=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(n){}return t},isArray:q,support:{dnd:w&&"ondrop"in A.createElement("div"),cors:w,html5:b,chunked:x,dataURI:!0},event:{on:G,off:K,one:J,fix:Q},throttle:function(t,n){var a,i;return function(){i=arguments,a||(t.apply(e,i),a=setTimeout(function(){a=0,t.apply(e,i)},n))}},F:function(){},parseJSON:function(t){var n;return n=e.JSON&&JSON.parse?JSON.parse(t):Function("return ("+t.replace(/([\r\n])/g,"\\$1")+");")()},trim:function(e){return e+="",e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},defer:function(){var e,n,a=[],i={resolve:function(t,r){for(i.resolve=d,n=t||!1,e=r;r=a.shift();)r(n,e)},then:function(i){n!==t?i(n,e):a.push(i)}};return i},queue:function(e){var t=0,n=0,a=!1,i=!1,r={inc:function(){n++},next:function(){t++,setTimeout(r.check,0)},check:function(){t>=n&&!a&&r.end()},isFail:function(){return a},fail:function(){!a&&e(a=!0)},end:function(){i||(i=!0,e())}};return r},each:W,afor:function(e,t){var n=0,a=e.length;q(e)&&a--?function i(){t(a!=n&&i,e[n],n++)}():t(!1)},extend:function(e){return W(arguments,function(t){W(t,function(t,n){e[n]=t})}),e},isFile:function(e){return b&&e&&e instanceof m},isCanvas:function(e){return e&&I.test(e.nodeName)},getFilesFilter:function(e){return e="string"==typeof e?e:e.getAttribute&&e.getAttribute("accept")||"",e?RegExp("("+e.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(e,t){$.isCanvas(e)?n(e,t,"load",$.toDataURL(e)):i(e,t,"DataURL")},readAsBinaryString:function(e,t){a("BinaryString")?i(e,t,"BinaryString"):i(e,function(e){if("load"==e.type)try{e.result=$.toBinaryString(e.result)}catch(n){e.type="error",e.message=""+n}t(e)},"DataURL")},readAsArrayBuffer:function(e,t){i(e,t,"ArrayBuffer")},readAsText:function(e,t,n){n||(n=t,t="utf-8"),i(e,n,"Text",t)},toDataURL:function(e){return"string"==typeof e?e:e.toDataURL?e.toDataURL("image/png"):void 0},toBinaryString:function(t){return e.atob($.toDataURL(t).replace(D,""))},readAsImage:function(e,a,i){if($.isFile(e))if(h){var r=h.createObjectURL(e);r===t?n(e,a,"error"):$.readAsImage(r,a,i)}else $.readAsDataURL(e,function(t){"load"==t.type?$.readAsImage(t.result,a,i):(i||"error"==t.type)&&n(e,a,t,null,{loaded:t.loaded,total:t.total})});else if($.isCanvas(e))n(e,a,"load",e);else if(R.test(e.nodeName))if(e.complete)n(e,a,"load",e);else{var o="error abort load";J(e,o,function s(t){"load"==t.type&&h&&h.revokeObjectURL(e.src),K(e,o,s),n(e,a,t,e)})}else if(e.iframe)n(e,a,{type:"error"});else{var l=new Image;l.src=e.dataURL||e,$.readAsImage(l,a,i)}},checkFileObj:function(e){var t={},n=$.accept;return"object"==typeof e?t=e:t.name=(e+"").split(/\\|\//g).pop(),null==t.type&&(t.type=t.name.split(".").pop()),W(n,function(e,n){e=RegExp(e.replace(/\s/g,"|"),"i"),e.test(t.type)&&(t.type=n.split("/")[0]+"/"+t.type)}),t},getDropFiles:function(e,t){var n=[],a=c(e),i=q(a.items)&&a.items[0]&&o(a.items[0]),l=$.queue(function(){t(n)});W((i?a.items:a.files)||[],function(e){l.inc(),i?s(e,function(e,t){!e&&n.push.apply(n,t),l.next()}):r(e,function(t){t&&n.push(e),l.next()})}),l.check()},getFiles:function(e,t,n){var a=[];return n?($.filterFiles($.getFiles(e),t,n),null):(e.jquery&&(e.each(function(){a=a.concat($.getFiles(this))}),e=a,a=[]),"string"==typeof t&&(t=$.getFilesFilter(t)),e.originalEvent?e=Q(e.originalEvent):e.srcElement&&(e=Q(e)),e.dataTransfer?e=e.dataTransfer:e.target&&(e=e.target),e.files?a=e.files:!b&&u(e)?$.trim(e.value)&&(a=[$.checkFileObj(e.value)],a[0].blob=e,a[0].iframe=!0):q(e)&&(a=e),$.filter(a,function(e){return!t||t.test(e.name)}))},getInfo:function(e,t){var n={},a=j.concat();$.isFile(e)?function i(){var r=a.shift();r?r.test(e.type)?r(e,function(e,a){e?t(e):($.extend(n,a),i())}):i():t(!1,n)}():t("not_support",n)},addInfoReader:function(e,t){t.test=function(t){return e.test(t)},j.push(t)},filter:function(e,t){for(var n,a=[],i=0,r=e.length;r>i;i++)i in e&&(n=e[i],t.call(n,n,i,e)&&a.push(n));return a},filterFiles:function(e,t,n){if(e.length){var a,i=e.concat(),r=[],o=[];(function s(){i.length?(a=i.shift(),$.getInfo(a,function(e,n){(t(a,e?!1:n)?r:o).push(a),s()})):n(r,o)})()}else n([],e)},upload:function(e){e=$.extend({prepare:$.F,beforeupload:$.F,upload:$.F,fileupload:$.F,fileprogress:$.F,filecomplete:$.F,progress:$.F,complete:$.F,pause:$.F,chunkSize:$.chunkSize,chunkUpoloadRetry:$.chunkUploadRetry},e),e.imageAutoOrientation&&!e.imageTransform&&(e.imageTransform={rotate:"auto"});var t,n=new $.XHR(e),a=this._getFilesDataArray(e.files),i=0,r=0,o=0,s=1,u=this,c=!1;return W(a,function(e){i+=e.size}),n.files=[],W(a,function(e){n.files.push(e.file)}),n.total=i,n.loaded=0,e.beforeupload(n,e),(t=function t(){var f=a.shift(),d=f&&f.file,p=!1,h=l(e);("abort"!=n.statusText||n.current)&&f?(c=!1,n.currentFile=d,e.prepare(d,h),this._getFormData(h,f,function(a){r||e.upload(n,e);var l=new $.XHR($.extend({},h,{upload:function(){e.fileupload(d,l,h)},progress:function(t){p||(r+=0|i*s*(t.loaded/t.total)-o+.5,o=r,f.total=t.total,f.loaded=t.loaded,e.fileprogress(t,d,l,h),e.progress({type:t.type,total:i,loaded:n.loaded=r,lengthComputable:!0},d,l,h))},complete:function(a){W(P,function(e){n[e]=l[e]}),p=!0,f.loaded=f.total,n.loaded=r+=0|r-o+(i*s+.5),e.filecomplete(a,l,d,h),t.call(u)}}));s=f.size/i,n.abort=function(e){this.current=e,l.abort()},l.send(a)})):(e.complete(200==n.status||201==n.status?!1:n.statusText||"error",n,e),c=!0)}).call(this),n.append=function(e){e=$._getFilesDataArray(e),W(e,function(e){i+=e.size,n.files.push(e.file),a.push(e)}),c&&t.call(u)},n.remove=function(e){var t=-1;W(a,function(n){return t++,n.file==e?a.splice(t,1):void 0})},n},_getFilesDataArray:function(e){var t=[],n={};if(u(e)){var a=$.getFiles(e);n[e.name||"file"]=null!==e.getAttribute("multiple")?a:a[0]}else q(e)&&u(e[0])?W(e,function(e){n[e.name||"file"]=$.getFiles(e)}):n=e;return W(n,function i(e,n){q(e)?W(e,function(e){i(e,n)}):e&&e.name&&t.push({name:n,file:e,size:e.size,total:e.size,loaded:0})}),t},_getFormData:function(e,t,n){var a=t.file,i=t.name,r=a.name,o=a.type,s=$.support.transform&&e.imageTransform,l=new $.Form,u=$.queue(function(){n(l)}),c=s&&(parseInt(s.maxWidth||s.minWidth||s.width,10)>0||s.rotate);$.Image&&s&&(/image/.test(a.type)||T.test(a.nodeType))?(u.inc(),c&&(s=[s]),$.Image.transform(a,s,e.imageAutoOrientation,function(t,n){c&&!t?(F||$.flashEngine||(n[0]=$.toBinaryString(n[0]),l.multipart=!0),l.append(i,n[0],r,o)):(t||(W(n,function(e,t){F||$.flashEngine||(e=$.toBinaryString(e),l.multipart=!0),l.append(i+"["+t+"]",e,r,o)}),i+="[original]"),(t||e.imageOriginal)&&l.append(i,a,r,o)),u.next()})):l.append(i,a,r),W(e.data,function f(e,t){"object"==typeof e?W(e,function(e,n){f(e,t+"["+n+"]")}):l.append(t,e)}),u.check()},reset:function(e){var t,n;return y?(n=y(e).clone(!0).insertBefore(e).val("")[0],y(e).remove()):(t=e.parentNode,n=t.insertBefore(e.cloneNode(!0),e),n.value="",t.removeChild(e),W(M[$.uid(e)],function(t,a){W(t,function(t){K(e,a,t),G(n,a,t)})})),n},load:function(e,t){var n=$.getXHR();return n?(n.open("GET",e,!0),n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),G(n,"progress",function(e){e.lengthComputable&&t({type:e.type,loaded:e.loaded,total:e.total},n)}),n.onreadystatechange=function(){if(4==n.readyState)if(n.onreadystatechange=null,200==n.status){e=e.split("/");var a={name:e[e.length-1],size:n.getResponseHeader("Content-Length"),type:n.getResponseHeader("Content-Type")};a.dataURL="data:"+a.type+";base64,"+$.encode64(n.responseBody||n.responseText),t({type:"load",result:a})}else t({type:"error"})},n.send(null)):t({type:"error"}),n},encode64:function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="",a=0;for("string"!=typeof e&&(e+="");e.length>a;){var i,r,o=255&e.charCodeAt(a++),s=255&e.charCodeAt(a++),l=255&e.charCodeAt(a++),u=o>>2,c=(3&o)<<4|s>>4;isNaN(s)?i=r=64:(i=(15&s)<<2|l>>6,r=isNaN(l)?64:63&l),n+=t.charAt(u)+t.charAt(c)+t.charAt(i)+t.charAt(r)}return n}};$.addInfoReader(/^image/,function(e,t){if(!e.__dimensions){var n=e.__dimensions=$.defer();$.readAsImage(e,function(e){var t=e.target;n.resolve("load"==e.type?!1:"error",{width:t.width,height:t.height}),t=null})}e.__dimensions.then(t)}),$.event.dnd=function(e,t,n){var a,i;n||(n=t,t=$.F),g?(G(e,"dragenter dragleave dragover",function(e){for(var n=c(e).types,r=n&&n.length,o=!1;r--;)if(~n[r].indexOf("File")){e[X](),i!==e.type&&(i=e.type,"dragleave"!=i&&t.call(e[N],!0,e),o=!0);break}o&&(clearTimeout(a),a=setTimeout(function(){t.call(e[N],"dragleave"!=i,e)},50))}),G(e,"drop",function(e){e[X](),i=0,t.call(e[N],!1,e),$.getDropFiles(e,function(t){n.call(e[N],t,e)})})):$.log("Drag'n'Drop -- not supported")},y&&!y.fn.dnd&&(y.fn.dnd=function(e,t){return this.each(function(){$.event.dnd(this,e,t)})}),e.FileAPI=$.extend($,e.FileAPI),$.flashUrl||($.flashUrl=$.staticPath+"FileAPI.flash.swf"),$.flashImageUrl||($.flashImageUrl=$.staticPath+"FileAPI.flash.image.swf")}(window),function(e,t,n){"use strict";function a(e,t){return this instanceof a?(this.file=e,this.better=!t,this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0},void 0):new a(e)}var i=Math.min,r=Math.round,o=function(){return t.createElement("canvas")},s=!1,l={8:270,3:180,6:90};try{s=o().toDataURL("image/png").indexOf("data:image/png")>-1}catch(u){}a.prototype={constructor:a,set:function(t){return e.extend(this.matrix,t),this},crop:function(e,t,a,i){return a===n&&(a=e,i=t,e=t=0),this.set({sx:e,sy:t,sw:a,sh:i||a})},resize:function(e,t,n){return"string"==typeof t&&(n=t,t=e),this.set({dw:e,dh:t,resize:n})},preview:function(e,t){return this.set({dw:e,dh:t||e,resize:"preview"})},rotate:function(e){return this.set({deg:e})},_load:function(t,n){var a=this;e.readAsImage(t,function(e){n.call(a,"load"!=e.type,e.result)})},_apply:function(e,t){var n,a=o(),i=this.getMatrix(e),r=a.getContext("2d"),s=i.deg,l=i.dw,u=i.dh,c=e.width,f=e.height,d=e;if(this.better)for(;Math.min(c/l,f/u)>2;)c=~~(c/2+.5),f=~~(f/2+.5),n=o(),n.width=c,n.height=f,d!==e?(n.getContext("2d").drawImage(d,0,0,d.width,d.height,0,0,c,f),d=n):(d=n,d.getContext("2d").drawImage(e,i.sx,i.sy,i.sw,i.sh,0,0,c,f),i.sx=i.sy=i.sw=i.sh=0);a.width=s%180?u:l,a.height=s%180?l:u,r.rotate(s*Math.PI/180),r.drawImage(d,i.sx,i.sy,i.sw||d.width,i.sh||d.height,180==s||270==s?-l:0,90==s||180==s?-u:0,l,u),t.call(this,!1,a)},getMatrix:function(t){var n=e.extend({},this.matrix),a=n.sw=n.sw||t.width,o=n.sh=n.sh||t.height,s=n.dw=n.dw||n.sw,l=n.dh=n.dh||n.sh,u=a/o,c=s/l,f=n.resize;if("preview"==f){if(s!=a||l!=o){var d,p;c>=u?(d=a,p=d/c):(p=o,d=p*c),(d!=a||p!=o)&&(n.sx=~~((a-d)/2),n.sy=~~((o-p)/2),a=d,o=p)}}else f&&("min"==f?(s=r(c>u?i(a,s):l*u),l=r(c>u?s/u:i(o,l))):(s=r(u>=c?i(a,s):l*u),l=r(u>=c?s/u:i(o,l))));return n.sw=a,n.sh=o,n.dw=s,n.dh=l,n},_trans:function(e){this._load(this.file,function(t,n){t?e(t):this._apply(n,e)})},get:function(t){if(e.support.transform){var n=this;"auto"==n.matrix.deg?e.getInfo(this.file,function(e,a){n.matrix.deg=l[a&&a.exif&&a.exif.Orientation]||0,n._trans(t)}):n._trans(t)}else t("not_support")},toData:function(e){this.get(e)}},a.transform=function(t,i,r,o){e.getInfo(t,function(s,l){var u={},c=e.queue(function(e){o(e,u)});s?c.fail():e.each(i,function(e,i){if(!c.isFail()){var o=new a(l.nodeType?l:t);"function"==typeof e?e(l,o):e.width?o[e.preview?"preview":"resize"](e.width,e.height,e.type):e.maxWidth&&(l.width>e.maxWidth||l.height>e.maxHeight)&&o.resize(e.maxWidth,e.maxHeight,"max"),e.rotate===n&&r&&(e.rotate="auto"),o.rotate(e.rotate),c.inc(),o.toData(function(e,t){e?c.fail():(u[i]=t,c.next())})}})})},e.support.canvas=e.support.transform=s,e.Image=a}(FileAPI,document),function(e,t){var n=t.encodeURIComponent,a=t.document,i=t.FormData,r=function(){this.items=[]};r.prototype={append:function(e,t,n,a){this.items.push({name:e,blob:t&&t.blob||t,file:n||t.name,type:a||t.type})},each:function(e){for(var t=0,n=this.items.length;n>t;t++)e.call(this,this.items[t])},toData:function(t,n){n._chunked=e.support.chunked&&n.chunkSize>0&&1==e.filter(this.items,function(e){return e.file}).length,e.support.html5?this.multipart?(e.log("FileAPI.Form.toMultipartData"),this.toMultipartData(t)):n._chunked?(e.log("FileAPI.Form.toPlainData"),this.toPlainData(t)):(e.log("FileAPI.Form.toFormData"),this.toFormData(t)):(e.log("FileAPI.Form.toHtmlData"),this.toHtmlData(t))},_to:function(t,n,a,i){var r=e.queue(function(){n(t)});this.each(function(e){a(e,t,r,i)}),r.check()},toHtmlData:function(t){this._to(a.createDocumentFragment(),t,function(t,n){var i,r=t.blob;t.file?(e.reset(r),r.name=t.name,n.appendChild(r)):(i=a.createElement("input"),i.name=t.name,i.type="hidden",i.value=r,n.appendChild(i))})},toPlainData:function(e){this._to({},e,function(e,t,n){e.file&&(t.type=e.file),e.blob.toBlob?(n.inc(),e.blob.toBlob(function(a){t.name=e.name,t.file=a,t.size=a.length,t.type=e.type,n.next()},"image/png")):e.file?(t.name=e.blob.name,t.file=e.blob,t.size=e.blob.size,t.type=e.type):(t.params||(t.params=[]),t.params.push(encodeURIComponent(e.name)+"="+encodeURIComponent(e.blob))),t.start=-1,t.end=-1,t.retry=0})},toFormData:function(e){this._to(new i,e,function(e,t,n){e.file&&t.append("_"+e.name,e.file),e.blob&&e.blob.toBlob?(n.inc(),e.blob.toBlob(function(a){t.append(e.name,a,e.file),n.next()},"image/png")):e.file?t.append(e.name,e.blob,e.file):t.append(e.name,e.blob)})},toMultipartData:function(t){this._to([],t,function(e,t,a,i){t.push("--_"+i+('\r\nContent-Disposition: form-data; name="'+e.name+'"'+(e.file?'; filename="'+n(e.file)+'"':"")+(e.file?"\r\nContent-Type: "+(e.type||"application/octet-stream"):"")+"\r\n"+"\r\n"+(e.file?e.blob:n(e.blob))+"\r\n"))},e.expando)}},e.Form=r}(FileAPI,window),function(e,t){var n=function(){},a=e.document,i=function(e){this.uid=t.uid(),this.xhr={abort:n,getResponseHeader:n,getAllResponseHeaders:n},this.options=e};i.prototype={status:0,statusText:"",getResponseHeader:function(e){return this.xhr.getResponseHeader(e)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(a,i){var r=this,o=r.options;r.end=r.abort=n,r.status=a,i&&(r.statusText=i),t.log("xhr.end:",a,i),o.complete(200==a||201==a?!1:r.statusText||"unknown",r),r.xhr&&r.xhr.node&&setTimeout(function(){var t=r.xhr.node;try{t.parentNode.removeChild(t)}catch(n){}try{delete e[r.uid]}catch(n){}e[r.uid]=r.xhr.node=null},9)},abort:function(){this.end(0,"abort"),this.xhr&&(this.xhr.aborted=!0,this.xhr.abort())},send:function(e){var t=this,n=this.options;e.toData(function(e){n.upload(n,t),t._send.call(t,n,e)},n)},_send:function(n,i){var r,o=this,s=o.uid,l=n.url;if(t.log("XHR._send:",i),l+=(~l.indexOf("?")?"&":"?")+t.uid(),i.nodeName){n.upload(n,o),r=a.createElement("div"),r.innerHTML='<form target="'+s+'" action="'+l+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;">'+'<iframe name="'+s+'" src="javascript:false;"></iframe>'+'<input value="'+s+'" name="callback" type="hidden"/>'+"</form>",o.xhr.abort=function(){var e=r.getElementsByName("iframe")[0];if(e)try{e.stop?e.stop():e.contentWindow.stop?e.contentWindow.stop():e.contentWindow.document.execCommand("Stop")}catch(t){}r=null};var u=r.getElementsByTagName("form")[0];u.appendChild(i),t.log(u.parentNode.innerHTML),a.body.appendChild(r),o.xhr.node=r,e[s]=function(e,t,n){o.readyState=4,o.responseText=n,o.end(e,t),r=null},o.readyState=2,u.submit(),u=null}else if(r=o.xhr=t.getXHR(),i.params&&(l+=(0>l.indexOf("?")?"?":"&")+i.params.join("&")),r.open("POST",l,!0),r.withCredential="true",n.headers&&n.headers["X-Requested-With"]||r.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.each(n.headers,function(e,t){r.setRequestHeader(t,e)}),n._chunked){r.upload&&r.upload.addEventListener("progress",function(e){i.retry||n.progress({type:e.type,total:i.size,loaded:i.start+e.loaded,totalSize:i.size},o,n)},!1),r.onreadystatechange=function(){if(o.status=r.status,o.statusText=r.statusText,o.readyState=r.readyState,4==r.readyState){for(var e in{"":1,XML:1,Text:1,Body:1})o["response"+e]=r["response"+e];if(r.onreadystatechange=null,!r.status||r.status-201>0)if(t.log("Error: "+r.status),(!r.status&&!r.aborted||500==r.status||416==r.status)&&++i.retry<=n.chunkUploadRetry){var a=r.status?0:t.chunkNetworkDownRetryTimeout;n.pause(i.file,n);var s=r.getResponseHeader("X-Last-Known-Byte");t.log("X-Last-Known-Byte: "+s),i.end=s?parseInt(s,10):i.start-1,setTimeout(function(){o._send(n,i)},a)}else o.end(r.status);else i.retry=0,i.end==i.size-1?o.end(r.status):setTimeout(function(){o._send(n,i)},0);r=null}},i.start=i.end+1,i.end=Math.min(i.start+n.chunkSize,i.size)-1;var c;(c="slice")in i.file||(c="mozSlice")in i.file||(c="webkitSlice")in i.file,r.setRequestHeader("Content-Range","bytes "+i.start+"-"+i.end+"/"+i.size),r.setRequestHeader("Content-Disposition","attachment; filename="+encodeURIComponent(i.name)),r.setRequestHeader("Content-Type",i.type||"application/octet-stream"),c=i.file[c](i.start,i.end+1),r.send(c),c=null}else if(r.upload&&r.upload.addEventListener("progress",t.throttle(function(e){n.progress(e,o,n)},100),!1),r.onreadystatechange=function(){if(o.status=r.status,o.statusText=r.statusText,o.readyState=r.readyState,4==r.readyState){for(var e in{"":1,XML:1,Text:1,Body:1})o["response"+e]=r["response"+e];r.onreadystatechange=null,o.end(r.status),r=null}},t.isArray(i))if(r.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+t.expando),i=i.join("")+"--_"+t.expando+"--",r.sendAsBinary)r.sendAsBinary(i);else{var f=Array.prototype.map.call(i,function(e){return 255&e.charCodeAt(0)});r.send(new Uint8Array(f).buffer)}else r.send(i)}},t.XHR=i}(window,FileAPI);