(function(F){"function"===typeof define&&define.amd?define("xtpl",[],F):window.xtpl=F()})(function(){function F(H,D){var v={exports:{}};D(v,v.exports,N);F[H]=v.exports}function N(H){return F[H]}F("utils",function(H,D,v){var l=/[&<>"]/,K=/&/g,A=/>/g,a=/</g,g=/"/g,h=[].slice,p;void 0===String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/,"")});void 0===Function.prototype.bind&&(Function.prototype.bind=function(b){var q=h.call(arguments,1),f=this;return function(){return f.apply(b,
q.concat(h.call(arguments,0)))}});H.exports=p={isClient:"undefined"!==typeof navigator,shortTags:{area:1,base:1,br:1,col:1,command:1,embed:1,hr:1,img:1,input:1,keygen:1,link:1,meta:1,param:1,source:1,wbr:1,space:1,enter:1},extend:function(b,q){var f;b=b||{};for(f in q)q.hasOwnProperty(f)&&(b[f]=q[f]);return b},each:function(b,q,f){if(b){var a=0,d=b.length;if(0<=d&&0 in b)for(;a<d;a++)q.call(f,b[a],a,b);else for(a in b)b.hasOwnProperty(a)&&q.call(f,b[a],a,b)}},map:Array.map||function(b,q,f){for(var a=
[],d=0,k=b.length;d<k;d++)a.push(q.call(f,b[d],d,b));return a},filter:Array.filter||function(b,q,f){for(var a=[],d=0,k=b.length;d<k;d++)q.call(f,b[d],d,b)&&a.push(b[d]);return a},inArray:Array.indexOf||function(b,q){for(var f=b.length;f--;)if(b[f]===q)return f;return-1},isEmptyObject:function(b){for(var q in b)return!1;return!0},escapeHTML:function(b){"string"===typeof b?l.test(b)&&(~b.indexOf("&")&&(b=b.replace(K,"&amp;")),~b.indexOf("<")&&(b=b.replace(a,"&lt;")),~b.indexOf(">")&&(b=b.replace(A,
"&gt;")),~b.indexOf('"')&&(b=b.replace(g,"&quot;"))):void 0===b&&(b="");return b},notEqual:function q(f,a){var d,k=typeof a;if(typeof f!==k&&"object"===k)return!0;if(a instanceof Array){d=a.length;if(f.length!==d)return!0;for(;d--;)if(q(f[d],a[d]))return!0}else if("object"===k){for(d in a)if(a.hasOwnProperty(d)&&q(f[d],a[d]))return!0;for(d in f)if(f.hasOwnProperty(d)&&q(f[d],a[d]))return!0}else return f!=a;return!1},simpleNotEqual:function f(a,d){var k,g=typeof d;if(typeof a!==g&&"object"===g)return!0;
if(d instanceof Array){k=d.length;if(a.length!==k)return!0;for(;k--;)if(a[k]!==d[k])return!0}else if("object"===g){for(k in d)if(d.hasOwnProperty(k)&&f(a[k],d[k]))return!0;for(k in a)if(a.hasOwnProperty(k)&&f(a[k],d[k]))return!0}else return a!=d;return!1},simpleClone:function(a){var g=a,d;if(a instanceof Array)for(d=a.length,g=[];d--;)g[d]=a[d];else if(a instanceof Function)g=a;else if(a instanceof Object)for(d in g={},a)a.hasOwnProperty(d)&&(g[d]=a[d]);return g},print:function(){console.log(p.map(arguments,
function(a){return a?JSON.stringify(a).toString().replace(/^"|"$/g,""):a}))},error:function(a,g,d){console.log(a.message+"\nline: "+d+"\nfile: "+g)},matchAll:function(a,g){for(var d=[],k;k=g.exec(a);)void 0!==k[1]&&d.push(k.slice(1));return d},throttel:function(a,g,d){var k,h,p,l,x=function(){p.call(d)};return function(e,c){l=(new Date).getTime();p=e;void 0===k?(h=l,k=setTimeout(x,c)):l-h>=c&&(clearTimeout(k),k=void 0,x())}}}});F("xmlparser",function(H,D,v){function l(b,a){return new K(b,a)}function K(b,
a){this.name=b||"#";this.shorty=void 0!==h[b];this.value="";this.attrs=a||{};this.length=0;this.children=[];this.binding=[]}var A=/^[\r\n\s\t]+$/,a=34,g=v("utils").each,h=v("utils").shortTags,p=function(b,q,f){function g(n){var c=f[n.name];void 0!==c&&(c="string"===typeof c?c:c(n,n.attrs),"string"===typeof c&&n.replace(c))}function d(n){var c=f["#text"],b=n.value;void 0!==c&&(c=c(b,n),c!==b&&(b=q.line,c=p(c,q,f),q.line=b,n.replace(c.children)))}function k(n){var c=b.indexOf("\n",r),e=r-w+1;0>=c&&
(c=b.length);throw{file:s,line:m+":"+e,message:n+"\n"+b.substring(w,c).replace(/\t/g," ")+"\n"+Array(e).join("-")+"^"};}function h(){var c=b.charCodeAt(++r);c!==a&&k('"'+J+'" expected value of the attribute in quotes');for(B=++r;r<x;){e=b.charCodeAt(r);if(c===e)return b.substring(B,r);r++}r-=(r-B)/2+1|0;k('Unclosed string literal in "'+J+'" attribute')}f=f||{};q=q||{};for(var r=0,B=0,x=b.length,e,c=l("#root"),m=q.line||1,s=q.file,w=0,n,z=0,t,C,L,J,E=null==q.trim?1:q.trim;r<x;)e=b.charCodeAt(r),33>
e&&10===e&&(w=r+1,m++),1===C?62===e||47===e&&62===b.charCodeAt(++r)?(L=b.substring(n,z+1),C=void 0,z=r+1,"#"===c.name?(c.name=L,47===e&&(c.shorty=!0,g(c),c=c.parent)):c.name===L?(g(c),c=c.parent):k('Wrong close "'+L+'" tag should be "'+c.name+'"')):33>e?(B=r,C=2,t=void 0):97<=e&&122>=e||48<=e&&57>=e||45===e||58===e?z=r:k("Invalid character in node name"):2===C?47===e||62===e?(void 0!==t&&c.attr(b.substring(t,r).trim(),!0),r--,C=1):61===e||33>e?void 0!==t&&(J=b.substring(t,r).trim(),c.attr(J,33>e?
!0:h()),t=void 0):(97>e||122<e)&&45!==e&&58!==e?k("Invalid character in attrbiute name"):void 0===t&&(t=r):60===e&&(0<r-z&&(n=b.substring(z,r),0===E||!1===A.test(n))&&(c.appendText(n),d(c.last)),47===b.charCodeAt(r+1)?r++:(c=c.newChild(),c.file=s,c.line=m),n=r+1,C=1),r++;1===C?k('"'+b.substring(n,r)+'" tag should be closed'):"#root"!==c.name&&k('"'+c.name+'" tag should be closed');0<r-z&&(n=b.substring(z,r),0===E||!1===A.test(n))&&(c.appendText(n),d(c.last));return c};K.prototype={create:function(b,
a){return l(b,a)},attr:function(b,a){this.attrs[b]=a;return this},bind:function(b){b.binded=this.binded=!0;this.binding.push(b)},on:function(b,a){void 0===this.events&&(this.events=[]);this.events.push(b.replace(/^.+[:-]+/,""),a)},bindDecl:function(b,a){void 0===this.decl&&(this.decl=[]);this.decl.push(b,a)},closest:function(b){var a=this.parent;if(a.name!==b)for(;(a=a.parent)&&a.name!==b;);return a},index:function(){for(var b=this.parent.children,a=b.length;a--;)if(b[a]===this)return a;return-1},
append:function(b,a){var f=this.children;void 0===a?f.push(b):f.splice(a.index(),0,b);this.first=f[0];this.last=f[(this.length=f.length)-1];b.parent=this;return this},appendArray:function(b){g(b,function(b){this.append(b)},this);return this},empty:function(){this.children=[];this.length;delete this.first;delete this.last;return this},remove:function(){var b=this.parent,a=b.children,f=this.index();-1!==f&&a.splice(f,1);b.first=a[0];b.last=a[(b.length=a.length)-1];return this},find:function(a){var q=
[],f=">"!=a.charAt(0);a=a.replace(">","");g(this.children,function d(k){k.name!==a&&"*"!==a||q.push(k);f&&g(k.children,d)});return q},wrap:function(a,g){var f=l(a,g);f.file=this.file;f.line=this.line;this.parent.append(f,this);f.append(this.remove());return f},innerWrap:function(a,g){var f=l(a,g),h=this.children,d=0,k=h.length;for(this.children=[];d<k;d++)f.append(h[d]);return this.append(f)},replace:function(a){var g=this.parent,f=[].concat(a),h=0,d=f.length;for(this.remove();h<d;h++)a=f[h],"string"===
typeof a?g.appendText(a):g.append(a);return this},appendText:function(a){if(""!==a){var g=this.last;void 0===g||"#text"!==g.name?this.newChild("#text").value=a:g.value+=a}return this},newChild:function(a,g){var f=l(a,g);f.file=this.file;f.line=this.line;this.append(f);return f},exception:function(a){throw{message:'Tag "'+this.name+'", '+a,line:this.line,file:this.file};},toString:function(a,h){h=a&&h||"";a=a?"\n":"";var f=h+this.value;g(this.children,function(d){f+=d.toString(a,"  "+h)});if("#"!=
this.name.charAt(0)){var p=a+h+"<"+this.name,d=[],k,l;for(k in this.attrs)l=this.attrs[k],!0===l?d.push(k):d.push(k+'="'+l+'"');d.length&&(p+=" "+d.join(" "));f=p+(this.shorty&&!this.length?"/>":">"+f+a+h+"</"+this.name+">")}return f}};p.newNode=l;H.exports=p});F("xparser",function(H,D,v){var l=v("xmlparser").newNode,K=10,A=123,a=125,g=34,h=39,p=47,b=44,q=33,f=v("utils").each,I=/(width|height|left|right|top|bottom|font-size|text-indent)$/,d="a abbr acronym address applet area article aside audio b base basefont bdi bdo big blockquote body br canvas caption center cite code col colgroup command datalist dd del details dfn dialog dir div dl dt em embed fieldset figcaption figure font footer form frame frameset h1 to h6 head header hgroup hr html i iframe img input ins kbd keygen label legend li link map mark menu meta meter nav noframes noscript object ol optgroup option output p param pre progress q rp rt ruby s samp script section select small source span strike strong style sub summary sup table tbody td textarea tfoot th thead time title tr track tt u ul var video wbr".split(" "),
k={"if":"if","for":"each"};f(d,function(a){d[a]=1});H.exports=function(u,r){function B(a,n){var w=u.indexOf("\n",c),e=c-J+1;0>=w&&(w=u.length);throw{file:L,line:C+":"+e,message:a+"\n"+u.substring(J,w).replace(/\t/g," ")+"\n"+Array(e+(n|0)).join("-")+"^"};}function x(a,c){var n;try{n=(new Function("return "+a))()}catch(w){if(w instanceof ReferenceError)return c?{expr:a,str:a}:"{{"+a+"}}";B(w.message+"\n---\n"+a+"\n---")}return c?{value:a,str:a,result:n}:n}function e(){var w;for(m=++c;c<s;){n=u.charCodeAt(c);
if(n===g||n===h||n===p&&!/["'\)]/.test(String.fromCharCode(z))){c++;for(z=n;c<s;){n=u.charCodeAt(c);if(n===p)w=!w;else{if(n===z&&!w)break;w=0}c++}c>=s&&B("Unterminated string")}else{if(n===b||n===a||n===K)return u.substring(m,c--).trim().replace(/[;,]$/,"");if(n===A)break}n>q&&(z=n);c++}c=m}r=r||{};for(var c=0,m=0,s=u.length,w,n,z,t=l("#root"),C=r.line||1,L=r.file,J=0,E,y,M,G;c<s;){n=u.charCodeAt(c);if(z>q&&n<q&&k[w=u.substring(m,c).trim()]){m=c;for(y="";c<s;){n=u.charCodeAt(c);if(n===A){G=y=u.substring(m,
c).trim();break}c++}y||(c=m,B("Syntax error"));t=t.newChild("x:"+k[w]);"for"===w?((y=y.match(/^\(?(\w+)(?:\s|,)\s*(\w+)?\)?\s*in\s*([^\|]+)(\|.+)?/i))||B("Expression error\n---\n"+G+"\n---"),t.attrs={data:y[3],as:y[2]||y[1],key:y[2]?y[1]:"$index",filter:/^\|/.test(y[y.length-1])?y.pop().substr(1):void 0}):"if"===w&&(t.attrs.test=y);m=c+1}else if(4===E){if(n<q||n===A||61===n){y=u.substring(m,c).trim();for(t=t.newChild(y);c<s;)if(n=u.charCodeAt(c++),61===n){E=void 0;t.name="x:decl";t.attrs.name=y;break}else if(n===
A){E=2;break}else if(97<=n&&122>=n){E=t.attrs;for(m=c-1;c<s;){n=u.charCodeAt(c);if(n<=q)break;c++}y=u.substring(m,c);E["x:context"]=y;t=t.parent;E=void 0;break}m=c+1}}else void 0===E&&38===n?(E=4,m=c+1):n===A?(2===E?(E=3,t.attrs[M]={}):(y=u.substring(m,c-1).trim(),/^([a-z0-9_-]+|[a-z-]+\.[a-z0-9_-]+)$/i.test(y)||B('Invalid node name "'+y+'"',-y.length/2),y=y.split("."),t=t.newChild(1<y.length||void 0!==d[y[0]]?y.shift():"div"),y.length&&(t.attrs["class"]='"'+y.join(" ")+'"')),m=c+1):n===a?(3!==E?
(f(t.attrs,function(a,c){"string"===typeof a?(G=a,/^x:/.test(t.name)||(G=x(a))):(G="",f(a,function(a,n){a=x(a,!0);"class"===c?void 0!==a.expr?(n=n.replace(/^([^'"])/,'" $1').replace(/([^'"])$/,'$1"'),G+="{{"+a.expr+" ? "+n+' : ""}}'):a.result&&(G+=" "+n):"style"===c&&(G+=n+":"+(void 0!==a.expr?"{{"+a.expr+"}}":a.result)+(I.test(n)&&(a.expr?!/(\+\s*["'](%|[a-z]{2,3})['"]|%)$/.test(a.str):/^\d+(\.\d+)?$/.test(a.str))?"px":"")+";")}));t.attrs[c]=G}),t=t.parent,"x:decl"==t.name&&(t=t.parent)):3===E&&
(E=n=void 0),m=c):58===n&&(3===E?(G=u.substring(m,c).trim().replace(/^,\s*/g,""),t.attrs[M][G]=e()):(M=u.substring(m,c).trim().replace(/^,\s*/g,""),t.attrs[M]=G=e(),void 0===G&&(E=2)),m=c+1);z=n;c++}"#root"!==t.name&&B('"'+t.name+'" not closed');return t}});F("compile",function(H,D,v){function l(v,A,a){l.pre(v,A);return l.code(v,a)}l.pre=function A(a,g){var h=a.name,p=g[h],b,q=a.attrs;if(!a.noPre){void 0!==p&&(b=p(a,a.attrs));!0!==b&&(b=g["**"](a,a.attrs));if(!0===b){A(a.parent,g);return}for(h in q)if(p=
g["@"+h],void 0!==p&&!0===p.call(g,a,h,q[h])||!0===g["@"].call(g,a,h,q[h])){delete q[h];A(a.parent,g);return}}h=a.children.slice(0);p=0;for(b=h.length;p<b;p++)A(h[p],g)};l.code=function a(g,h){var p,b=g.name;p=h[b];var q=g.children,f="",v,d,k,u,r=g.binding,B=g.decl,x=g.events,e=(r.length||B||x)&&l.xpath(g),c="",m="",s="";p=void 0===p?h["**"](b,g,g.attrs):""===p?["",""]:p(g,g.attrs);g.xctrl&&(p[0]=l.tryCatch(g,'xtpl.ctrl["_'+g.xctrl+'"](ctx)')+p[0]);if(v=r.length){var w=0,n;for(d=0;d<v;d++){u=r[d];
c+=",__xbind"+d;if("x:if"==u.name)k=l.getExpr(u,"test"),w=1,u.attrs.test="__xbind"+d;else if("x:value"==u.name)k=l.getExpr(u,"data"),u.attrs.data="__xbind"+d;else if("x:var"==u.name){var z=u.key;if(u.expr){var t=l.getExpr(u,z,u.value);k=l.tryCatch(u,"__xval="+t);"context"==z?(m=k+'if( __xval instanceof Object ) for( var key in __xval ){  __xval0 = __xval[key];  __xargs[key] = __xval0;  __xargs["__"+key] = __xclone(__xval0);  __xc = 1;}'+m,s='for( var key in __xargs ){  if( !/^__/.test(key) ){    __xval = __xargs[key];    if( __xnotEq(__xval, __xargs["__"+key]) ){'+
l.tryCatch(u,t+"[key] = __xval;")+"       __xc = 1;    }  }}"+s):(m+=k+'  __xargs["'+z+'"] = __xval;  __xargs["__'+z+'"] = __xclone(__xval);  __xc = 1;',s+='__xval=__xargs["'+z+'"];if( __xnotEq(__xval, __xargs["__'+z+'"]) ){'+l.tryCatch(u,t+" = __xval;")+"  __xc = 1;}")}else m+='__xargs["'+z+'"]='+l.lex(u.value)+";";continue}m+=l.tryCatch(u,"__xargs["+d+"]="+k);u.attrs.safe=!0}"x:attr"==b?(w=3,n=l.lex(g.attrs.name)):"x:decl"===b&&(w=5,n=l.lex(g.declName),c=" ctx,__xsync",m="var __xc;if(apply===void 0){"+
m+"}else{"+s+"}return __xc");p[0]+="__buf.b("+w+", ["+e+"],function(__xargs,apply){"+m+"},function("+c.substr(1)+"){";p[1]="}"+(n?","+n:"")+");"+p[1];"x:decl"===b&&(p[0]+="var ___$apply=__buf.$apply, __$apply=__buf.$apply=function(force){if( __xsync(ctx,true) || force === true ){ ___$apply(true) }};")}if(x)for(d=0,v=x.length;d<v;d+=2)p[1]+="__buf.b(4,["+e+"],"+l.lex(x[d])+",function(evt){evt.preventDefault();"+x[d+1]+"\n __$apply()});";if(B)for(d=0,v=B.length;d<v;d+=2)p[1]+="__buf.b(5,["+e+"],function(__xargs){"+
l.tryCatch(g,"__xargs["+d+"]="+B[d+1])+"\nreturn __xargs},"+l.lex(B[d])+");";v=q.length;for(d=0;d<v;d++)f+=a(q[d],h);return(p[0]+f+p[1]).replace(/"\)\n__buf\.s\("/g,"").replace(/{;_/g,"{_")};l.lex=function(a){return JSON.stringify(a)};l.str=function(a){return"__buf.s("+l.lex(a)+")\n"};l.variable=function(a,g,h){return l.expr(a,"__buf.w($"+g+(h?',"'+h+'"':"")+");")};l.tryCatch=function(a,g,h){return"try{"+g+"}catch(e){"+(h||"")+(a.file?';__xerr(e,"'+a.file+'",'+a.line+")}":"}")};l.expr=function(a,
g){var h="",p=0;g=g.replace(/([\$@&])([\w-]+)/g,function(b,g,f){b=a.attrs[f];"$"!=g||a.attrs.safe?"@"==g&&(b=l.lex(b)):(b=l.getExpr(a,f),f="__xval"+p++,h+=l.tryCatch(a,f+"="+b,f+"=void 0"),b=f);return b});return h+g};l.getExpr=function(a,g,h){h=void 0===h?a.attrs[g]:h;try{new Function('"use strict";\n'+h+"")}catch(p){try{new Function('"use strict";\n('+h+")")}catch(b){a.exception(' attribute "'+g+'": '+p.message+"\n---\n"+h+"\n---")}}return h};l.wrap=function(a,g){if(!a.binded){do{var h=a.parent,
p=h.children,b=p.length,l=b,f=/#text|value/,v=0;g=g||a.attrs.bind;if("both"==g&&(1!=a.length||f.test(a.first.name)))return a.innerWrap("x"),!0;if(1===b)"both"==h.bindMod&&h.innerWrap("x"),a.sys&&h.sys&&(h=a.wrap("#scope"),h.sys=1,h.hidden=1),a.manualBind||h.manualBind||h.bind(a);else if(f.test(a.name)){for(;l--;)if(!f.test(p[l].name)&&!p[l].hidden)return a.wrap("x"),!0;a.manualBind||h.manualBind||h.bind(a)}else if("wrap"==g||"both"==g)a.wrap("x"),v=1}while(v);a.bindMod=g;delete a.attrs.bind}};l.xpath=
function(a,g){var h=a.xpath;g=a.attrs.x||g;if(void 0===h)h=[];else return h;g&&console.group(a.name+": "+JSON.stringify(a.attrs));if(a.parent){do for(var l=a.parent.children,b=0,q=l.length,f=0;b<q;b++)if(g&&console.log(l[b].hidden,l[b].toString()),!l[b].hidden){if(l[b]===a){h.push(f);break}f++}while((a=a.parent)&&a.parent&&!a.sys)}g&&(console.log("xpath:",h),console.groupEnd());return h};H.exports=l});F("buffer",function(H,D,v){function l(a){var n=a.min,c=n,e=a.max;if(void 0!==n)for(;c<=e;c++)n=a[c],
void 0!==n&&(n.zmb=1,l(n))}function F(c,n,e,t,b,m){var d=0,g=n.childNodes,f=t.extra,h=document.createElement("div"),s=t.render,k=[];q(b,function(a,b){if(void 0===f||f(a)){var l=g[d],C;if(a!==m[d]){e.remove(d);c.idx=d;c.xpath=t.xpath;c.clear();s(a,b);C=h;var p=c.toString();/^<option/i.test(p)?(C.innerHTML="<select>"+p+"</select>",C=C.firstChild):/^<tr/.test(p)?(C.innerHTML="<table><tbody>"+p+"</tbody></table>",C=C.firstChild.firstChild):C.innerHTML=p;C=C.firstChild;void 0===l?n.appendChild(C):(p=n,
void 0===p&&(p=l.parentNode),p.insertBefore(C,l),p.removeChild(l))}k[d]=a;d++}});for(b=g.length-1;b>=d;b--)a(g[b],c._decl,!0),e.remove(b),n.removeChild(g[b]);h=null;return k}function A(a,c){if(void 0!==c.el)return c.el;for(var e=c.xpath,b=e.length;b--&&(a=a.childNodes[e[b]],a););return c.el=a}function a(a,c,e){var t=a.getElementsByTagName("*"),m=c[a.xdecl];!0===e&&(void 0!==a.xevents&&b(a),void 0!==m&&void 0!==m.remove&&m.remove(a,a.parentNode));for(e=t.length;e--;)a=t[e],m=c[a.xdecl],void 0!==a.xevents&&
b(a),void 0!==m&&void 0!==m.remove&&m.remove(a,a.parentNode)}function g(a,c){var e=a,b;if(a instanceof Array)for(b=a.length,e=[];b--;)e[b]=c?a[b]:g(a[b]);else if(a instanceof Function)e=a;else if(a instanceof Object)for(b in e={},a)a.hasOwnProperty(b)&&(e[b]=a[b]);return e}function h(a,c,e,b){var m,d,g,f=a.xevents=a.xevents||I++;b.gid=b.gid||I++;k[f]||(k[f]={});k[f][e]||(k[f][e]=[]);g=k[f][e];m=u[b.gid]=u[b.gid]||p(a,b);d=B(b,g);if(a.addEventListener)a[c?"addEventListener":"removeEventListener"](e,
m,!1);else a[c?"attachEvent":"detachEvent"]("on"+e,m);!0===c?~d||g.push(b):(~d||(g.splice(d,1),delete u[b.gid]),~g.length&&delete k[f][e],x(k[f])&&delete k[f])}function p(a,c){return function(e){e=e||window.event;e.target||(e.target=e.srcElement||document);3===e.target.nodeType&&(e.target=e.target.parentNode);e.currentTarget||(e.currentTarget=a);!e.relatedTarget&&e.fromElement&&(e.relatedTarget=e.fromElement===e.target?e.toElement:e.fromElement);e.stopPropagation||(e.stopPropagation=function(){this.cancelBubble=
!0});e.preventDefault||(e.preventDefault=function(){this.returnValue=!1});!1===c.call(a,e)&&(e.preventDefault(),e.stopPropagation())}}function b(a){var c=k[a.xevents],e,b,m;if(c)for(e in c)for(m=c[e],b=m.length;b--;)h(a,0,e,m[b])}function q(a,c){if(a){var e=0,b=a.length;if(void 0!==b&&e in a)for(;e<b;e++)c(a[e],e);else for(e in a)a.hasOwnProperty(e)&&c(a[e],e)}}var f=0,I=1,d={autofocus:1,autoplay:1,async:1,checked:1,controls:1,defer:1,disabled:1,hidden:1,loop:1,multiple:1,open:1,readonly:1,required:1,
scoped:1,selected:1},k={},u={};D=v("utils");var r=(v=D.isClient)&&(window.opera||/MSIE/.test(navigator.userAgent)),B=D.inArray,x=D.isEmptyObject,e=D.notEqual,c=D.escapeHTML,m=v&&"cssText"in document.createElement("div").style,s=function(a){this.id=++f;this._=[];a&&(this.ids={},this.index=[])};s.prototype={constructor:s,get:function(a){for(var c=a.length,e=this,b;c--;)b=a[c],e=e[b]||s.Null;return e},push:function(a,c){for(var e=a.xpath,b,m=e.length,d=this,g;m--;){b=e[m];g=d[b];if(void 0===g||void 0!==
g.zmb)d[b]=new s,d.min=void 0===d.min?b:Math.min(d.min,b),d.max=Math.max(d.max|0,b);d=d[b]}d.idx=e[0];d.label=c;1===d._.push(a)&&(d.type=a.type);e=this.ids;void 0===e[d.id]&&(e[d.id]=1,this.index.push(d));return a},removeItem:function(a){for(var c=this.get(a.xpath)._,e=c.length;e--;)if(c[e]===a){c.splice(e,1);break}},remove:function(a){var c=this,e=a.length,b;if("object"===typeof a)for(;e--;)void 0!==c&&(b=a[e],c=c[b]);else c=c[a];c&&(c.zmb=1,l(c))},empty:function(a){l(this);a&&1<this._.length&&this._.splice(1,
10)},each:function(a){for(var c,e=this.index,b=0,d=e.length,m,g,f={};b<d;)if(c=e[b],1!==c.zmb){b++;m=c._;for(var h=0,k;void 0!==m[h];h++)k=m[h],g=k.label,void 0===f[g]&&!1===a(c,k)&&(f[g]=1)}else d--,e.splice(b,1)}};s.Null=new s;D=function(a,c){this.el=a;this.data=r?[]:"";this.xpath=[];this.events=[];this.idxQueue=[];this.bindDecl=[];this.bindData=new s(!0);this.applyFns=[];this._decl=c;this.$apply=this.applyChanges.bind(this)};D.prototype={s:r?function(a){this.data.push(a)}:function(a){this.data+=
a},w:function(a,e){void 0!==a&&("text"===e?this.s(a):this.s(c(a)))},save:function(){this.__data=this.data;this.data=r?[]:""},revert:function(){this.data=this.__data},each:function(a,c,e){if(a){var b=0,m=a.length,d=0,g=this.idx,f;if(void 0!==m&&0 in a)for(;b<m;b++){if(f=a[b],void 0===e||e(f,b))this.idx=d++,c(f,b)}else for(b in a)f=a[b],a.hasOwnProperty(b)&&(void 0===e||e(f,b))&&(this.idx=d++,c(f,b));this.idx=g}},b:function(a,c,e,b,m){var d=this.idx,f=this.xpath,h=this.xlabel,k=c.length,s=[];void 0!==
d&&(0===k?c[0]=d:c[k-1]=d,delete this.idx);c=c.concat(f);4===a?this.events.push({name:e,fn:b,xpath:c}):(e(s),2===a?s[0]=g(s[0],!0):5===a&&void 0!==m?this.xlabel=I++:s=g(s),this.bindData.push(c={type:a,xpath:this.xpath=c,args:s,getter:e,render:b,extra:m,label:this.xlabel}),2===a?this.each(s[0],b,m):5===a?(this.bindDecl.push(c),void 0!==m&&(b(s,e),c.$apply=this.$apply)):3===a?(this.save(),b.apply(this,s),a=this.toString(),this.revert(),""!==a&&"false"!==a&&this.s(" "+m+'="'+a+'"')):b.apply(this,s));
this.idx=d;this.xpath=f;this.xlabel=h},clear:function(){this.data=r?[]:""},toString:r?function(){return this.data.join("")}:function(){return this.data},applyChanges:function(c){var b=this,f=b.el;"function"===typeof c&&this.applyFns.push(c);this.bindData.each(function(c,s){var h=[],k=s.args,l=s.type,p=s.extra,w=s.getter,q,r=b.idx,u=b.xpath,v=b.$apply;if(5===l&&void 0!==p){q=!0;if(void 0===w(h=k))return!1;b.$apply=s.$apply}else if(w(h),2===l)q=!0;else for(w=h.length;w--;)e(k[w],h[w])&&(h[w]=g(h[w]),
q=!0);q&&(b.xpath=s.xpath,q=A(f,s),2===l?h[0]=F(b,q,c,s,h[0],k[0]):5===l?(l=b._decl[p||s.render],void 0!==l.update&&(void 0===p?l.update(q,h[0],k[0]):l.update(q,k))):(b.clear(),3!==l&&c.empty(1===l),s.render.apply(b,h),k=b.toString(),3===l?"value"===p?q.value!==k&&(q.value=k):"class"===p?q.className=k:void 0!==d[p]?q[p]=""!==k&&"false"!==k:"style"===p&&m?q.style.cssText=k:q.setAttribute(p,k):(a(q,b._decl),q.innerHTML=k)),b.idx=r,b.xpath=u,b.$apply=v,s.args=h)});this.applyEnd()},applyEnd:function(){var a=
this.bindDecl,c=this.events,e=this.applyFns,b,m,d,f;for(b=a.length;b--;)f=a[b],m=A(this.el,f),d=this._decl[m.xdecl=f.extra||f.render],void 0!==d.init&&d.init(m,f.extra?f.args:f.args[0]);for(b=c.length;b--;){d=c[b];a=this.el;m=d.xpath;for(f=m.length;f--&&(a=a.childNodes[m[f]],null!=a););h(a,!0,d.name,d.fn)}this.events=[];this.bindDecl=[];this.applyFns=[];b=0;for(c=e.length;b<c;b++)e[b]()},destory:function(){a(this.el,this._decl,!0)}};H.exports=D});F("xtpl",function(H,D,v){var l=v("utils"),F=v("xparser"),
A=v("xmlparser"),a=v("compile"),g=v("buffer"),h=(D=l.isClient)&&window.xtpl,p=D?location.pathname:__dirname,b={},q={},f={},I={},d={"#text":function(a){return a.replace(/\{\{(.*?)\}\}/g,"<x:value bind>$1</x:value>").replace(/\{\*(.*?)\*\}/g,'<x:value output="text" bind>$1</x:value>')},"x:text":function(a,c){return a.first?a.first.value:c.value},"x:space":" ","x:enter":"\n","x-space":" ","x-enter":"\n"},k=l.each,u=l.extend,r=function(a,c){var b={},g=this;"object"===typeof a?b=a:b[a]=c;k(b,function(a,
c){if(a.pre||a.code){a.pre&&r.call(q,c,a.pre);a.code&&r.call(f,c,a.code);var e=a.children;e&&(d[c]=function(a){var c=a.children,b=a.length;if(e)for(0===b&&a.exception("can not be empty");b--;)-1===e.indexOf(c[b].name)&&a.exception("can contain only: "+e.replace(/\s/g,", "))})}else g[c]=g[c.replace(":","-")]=a})},B=function(a){var c=["",""];k(l.matchAll(a,/(?:\|\|)|(\|\s*([a-z]+[^|]+))/g),function(b){var d=b[0].trim().split(":");c[0]="__xmods."+d[0].replace(/\|\s*/,"")+"("+c[0];c[1]=c[1]+(1<d.length?
","+d.slice(1).join(","):"")+")";a=a.replace(b[0],"")});return c[0]+a+c[1]};D&&document.createElement("x");var x={each:k,cache:b,mods:{},utils:l,parse:function(a){return A(a,{file:p},d)},xparse:function(a){return F(a,{file:p},d)},compile:function(e,c){var m=b[c],g;if(void 0===m){try{e="string"===typeof e?A(e,{file:c||p},d):e,g=a(e,q,f),m=(new Function("return "+g))()}catch(h){m=(new Function("return function(__buf){"+a.str("<pre>"+h.message+"\nline: "+h.line+"\nfile: "+h.file+"</pre>")+"return __buf.toString()}"))(),
h.stack&&console.log(h.stack)}void 0!==c&&(b[c]=m)}return m},ctrl:function(a,c){x.ctrl["_"+a]=c},mod:function(a,c){x.mods[a]=c},bind:function(a,c,b){c="string"===typeof c?x.compile(c):c;var d=new g(a,I);b=b||{};b.xel=a;b.xfn=c;b.xbuffer=d;b.$set=function(a,c){b[a]=c;b.$apply()};b.$apply=d.$apply;a.innerHTML=c(d,b);d.applyEnd();return b},pre:r.bind(q),tag:r.bind(f),decl:function(a,c){var b;"object"===typeof a?b=a:(b={},b[a]=c);k(b,function(a,c){"function"===typeof a&&(a={init:a,update:a});a=I[c]=u(I[c],
a);a.tpl?q[c]=function(b,e){var d=x.parse(a.tpl).first,f=d.find("x:content");f.length&&(f[0].hidden=1,f[0].appendArray(b.children));d.hidden=1;b.name="x:decl";b.sys=1;b.declName=c;b.empty().append(d);k(e,function(a,c){b.bind({name:"x:var",key:c.replace(/^x[:-]/,""),expr:/^x[:-]/.test(c),value:a})});return!0}:q["@"+c]=function(c,b,e){a.compile&&a.compile(c,e);(a.init||a.update||a.remove)&&c.bindDecl(b,e);return!0}})},noConflict:function(){window.xtpl=h;return x}};x.pre({"@":function(b,c,d){if("string"===
typeof d&&-1!==d.indexOf("{{")){var f=b.create("x:attr",{name:c});b.append(f,b.first);k(d.match(/\{\{[^}]*\}\}|\{[^{]+|[^{]+/g),function(d){if(""!==d){var m=f.newChild("#text");m.file=b.file;m.line=b.line;"{{"===d.substr(0,2)?(m.name="x:value",m.attrs.data=a.getExpr(b,c,B(d.slice(2,-2)))):m.value=d}});return!0}},"@x:ctrl":function(a,c,b){a.xctrl=b;delete a.attrs[c]},"@x:if":function(a,c,b){a.wrap(c,{test:b});return!0},"@x:each":function(a,c,b,d){b=b.match(/^\(?(\w+)(?:\s|,)\s*(\w+)?\)?\s*in\s*([^\|]+)(\|.+)?/i);
a[d||"innerWrap"]("x:each",{data:b[3],as:b[2]||b[1],key:b[2]?b[1]:"$index",filter:/^\|/.test(b[b.length-1])?b.pop().substr(1):void 0});return!0},"@x:repeat":function(a,b,d){return this["@x:each"](a,b,d,"wrap")},"@x:model":function(a,b,d){"text"==a.attrs.type?(a.newChild("x:attr",{name:"value"}).newChild("x:value",{data:d}),a.on("input",d+"=evt.target.value")):(a.newChild("x:attr",{name:"checked"}).newChild("x:value",{data:d}),a.on("change",d+"=!"+d));return!0}});k("change select submit click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleaveinput keydown keypress keyup".split(" "),
function(a){x.pre("@x:"+a,function(a,b,e){a.on(b,e);return!0})});d["x:decl"]=d["x-decl"]=function(a,b){b.name&&(a.remove(),x.decl(a.attrs.name,{tpl:a.first.toString()}))};x.tag({"#root":function(){return["function _(__buf,ctx){var __xerr=xtpl.utils.error,__xlog=xtpl.utils.print,__xnotEq=xtpl.utils.notEqual,__xclone=xtpl.utils.simpleClone,__xmods=xtpl.mods,__xval,__xval0,__xval1,__xval2,__xval3,__xval4,__$apply=__buf.$apply;","__buf.$apply=__$apply;return __buf.toString()}"]},"#text":function(b){return[a.str(b.value),
""]},"#scope":function(){return["",""]},"x:decl":function(){return["",""]},"x:content":function(){return["",""]},"x:value":{children:"#cdata #text",pre:function(a,b){b.bind="false"!==b.bind;b.data=B(a.first?a.first.remove().value:b.data)},code:function(b,c){return[a.variable(b,"data",c.output),""]}},"x:if":{pre:function(a,b){b.bind="false"!==b.bind&&"wrap";a.sys=b.bind;a.hidden=1},code:function(b){return[a.expr(b,"if($test){"),"}"]}},"x:each":{pre:function(a,b){a.sys=1;a.hidden=1;a.manualBind=!0;
b.bind="both"},code:function(b,c){b.binded=!0;return["__buf.b(2, ["+a.xpath(b)+"],function(__xargs){"+a.tryCatch(b,"__xargs[0]="+c.data)+a.expr(b,"},function(&as,&key){"),a.expr(b,"},&filter);")]}},"x:attrs":function(){return["",""]},"x:attr":{pre:function(a){var b=a.parent,d=b.xattrs;if(void 0===d){if("x:attrs"===b.name)return;d=b.xattrs=a.create("x:attrs");d.allow=b.attrs["x:attrs-bind"];d.hidden=1;b.append(d,b.first);delete b.attrs["x:attrs-bind"]}a.hidden=1;a.manualBind=null!=d.allow&&-1==d.allow.indexOf(a.attrs.name);
d.append(a.remove())},code:function(b){var c=b.manualBind;return[c?a.str(" "+b.attrs.name+'="'):"",c?a.str('"'):""]}},"**":{pre:function(b,c){void 0===c.bind||c.bind||(b.hidden=1);return c.bind&&a.wrap(b)},code:function(b,c,d){var g=[""],h="",k,l,p=c.shorty;for(k in d)l=d[k],g.push(k+(!0===l?"":"="+a.lex(l)));g=1<g.length?g.join(" "):"";c.xattrs&&(h+=a(c.xattrs,q,f),c.xattrs.remove());g+=p?"/>":">";return[a.str("<"+b)+h+a.str(g),p?"":a.str("</"+b+">")]}}});x.decl({"x:show":{compile:function(a,b){var d=
a.attrs;d.style=(d.style||"")+";{{"+b+" ? '' : 'display: none;'}}"}},"x:hide":{compile:function(a,b){var d=a.attrs;d.style=(d.style||"")+";{{"+b+" ? 'display: none;' : ''}}"}},"x:fade-to":function(a,b){a.style.opacity=b|0}});x.mod("css",function(a,b){return b?a:""});l.isClient&&function(a,b){var d=!1,f=function(){if(a.addEventListener)a.removeEventListener("load",f,!1),b.removeEventListener("DOMContentLoaded",f,!1);else if("complete"===b.readyState)a.detachEvent("onload",f),b.detachEvent("onreadystatechange",
f);else return;k(b.scripts,function(a){var d=a.getAttribute("x-ctrl")||a.getAttribute("x:ctrl")||a.getAttribute("ctrl");if(d){var e=b.createElement("div");x.bind(e,'<div x:ctrl="'+d+'">'+a.innerHTML+"</div>");a.parentNode.insertBefore(e,a)}})};if("complete"===b.readyState)setTimeout(f,1);else if(a.addEventListener)a.addEventListener("load",f,!1),b.addEventListener("DOMContentLoaded",f,!1);else{a.attachEvent("onload",f);b.attachEvent("onreadystatechange",f);try{d=null==a.frameElement&&b.documentElement}catch(g){}d&&
d.doScroll&&function z(){try{d.doScroll("left"),f()}catch(a){setTimeout(z,50)}}()}}(window,document);H.exports=x});return F.xtpl});
