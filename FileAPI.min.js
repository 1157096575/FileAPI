/**!
 * FileAPI â€” a set of tools for working with files
 *
 * @author  RubaXa  <trash@rubaxa.org>
 * @build	lib/canvas-to-blob lib/FileAPI.html lib/FileAPI.Image lib/FileAPI.Form lib/FileAPI.XHR lib/FileAPI.Flash
 */
(function(a){var j=a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype,k=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder,f=k&&a.atob&&a.ArrayBuffer&&a.Uint8Array&&function(a){var d,e,f,q;d=0<=a.split(",")[0].indexOf("base64")?atob(a.split(",")[1]):decodeURIComponent(a.split(",")[1]);e=new ArrayBuffer(d.length);f=new Uint8Array(e);for(q=0;q<d.length;q+=1)f[q]=d.charCodeAt(q);d=new k;d.append(e);a=a.split(",")[0].split(":")[1].split(";")[0];return d.getBlob(a)};a.HTMLCanvasElement&&!j.toBlob&&(j.mozGetAsFile?
j.toBlob=function(a,d){a(this.mozGetAsFile("blob",d))}:j.toDataURL&&f&&(j.toBlob=function(a,d){a(f(this.toDataURL(d)))}));"undefined"!==typeof define&&define.amd?define(function(){return f}):a.dataURLtoBlob=f})(this);
(function(a,j){function k(b,a,c){if(b){var h=i.uid(b);w[h]||(w[h]={});i.each(a.split(/\s+/),function(a){w[h][a]||(w[h][a]=[]);w[h][a].push(c);b.addEventListener?b.addEventListener(a,c,!1):b.attachEvent?b.attachEvent("on"+a,c):b["on"+a]=c})}}function f(b,a,c){if(b){var h=i.uid(b),g=w[h]||{};i.each(a.split(/\s+/),function(a){for(var D=g[a]||[],h=D.length;h--;)if(D[h]===c){D.splice(h,1);break}b.addEventListener?b.removeEventListener(a,c,!1):b.detachEvent?b.detachEvent("on"+a,c):b["on"+a]=null})}}function p(b,
a,c){k(b,a,function G(g){c(g);f(b,a,G)})}function d(b,a,c,h,g){b={type:c.type||c,target:b,result:h};i.extend(b,g);a(b)}function e(b,a,c){if(x){var h=new x;k(h,"abort progress error load loadend",function E(c){var g=c.type;"progress"==g?d(b,a,c,c.target.result,{loaded:c.loaded,total:c.total}):"loadend"==g?(f(h,"abort progress error load loadend",E),h=null):d(b,a,c,c.target.result)});try{h["readAs"+c](b)}catch(g){d(b,a,"error",j,{error:g.toString()})}}else d(b,a,"error",j,{error:"FileReader is not supported"})}
function n(b){return"object"==typeof b&&b&&"length"in b}var q=1,u=a.createObjectURL&&a||a.URL&&URL.revokeObjectURL&&URL||a.webkitURL&&webkitURL,y=a.File,x=a.FileReader,v=a.FormData,m=!(!y||!(x&&a.Uint8Array||v)),s=a.document,r=a.dataURLtoBlob,A={},l=/img/i,t=/canvas/i,c=/img|canvas/,g=/input/i,I=/^data:[^,]+,/,v=Math.pow,w={},C=[],i={build:1,debug:!1,staticPath:"./",KB:1024,MB:v(1024,2),GB:v(1024,3),TB:v(1024,4),expando:"fileapi"+ +new Date,uid:function(b){return b?b[i.expando]=b[i.expando]||i.uid():
i.expando+ ++q},log:function(){i.debug&&(a.console&&console.log)&&(console.log.apply?console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},getXHR:function(){var b;if(a.XMLHttpRequest)b=new XMLHttpRequest;else if(a.ActiveXObject)try{b=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(c){}return b},isArray:n,support:{html5:m,dataURI:!0},event:{on:k,off:f,one:p,fix:function(b){b.target||(b.target=a.event&&a.event.srcElement||s);3===b.target.nodeType&&(b.target=event.target.parentNode);
return b}},throttle:function(b,c){var g,h,e;return function E(){h=arguments;e=!0;g||(e?(b.apply(a,h),e=!1,g=setTimeout(E,c)):g=null)}},F:function(b){return b},parseJSON:function(b){return a.JSON&&JSON.parse?JSON.parse(b):(new Function("return "+b+";"))()},trim:function(b){b=String(b);return b.trim?b.trim():b.replace(/^\s+|\s+$/g,"")},queue:function(b){var c=0,a=0,h=!1,g=!1,e={inc:function(){a++},next:function(){c++;setTimeout(e.check,0)},check:function(){c>=a&&!h&&e.end()},isFail:function(){return h},
fail:function(){!h&&b(h=!0)},end:function(){g||(g=!0,b())}};return e},each:function(b,c,a){if(b)if(b.forEach)b.forEach(c,a);else if(n(b))for(var h=0,g=b.length;h<g;h++)h in b&&c.call(a,b[h],h,b);else for(h in b)b.hasOwnProperty(h)&&c.call(a,b[h],h,b)},extend:function(b){i.each(arguments,function(c){i.each(c,function(c,a){b[a]=c})});return b},isFile:function(b){return m&&b&&b instanceof y},isCanvas:function(b){return b&&t.test(b.nodeName)},getFilesFilter:function(b){return(b="string"==typeof b?b:b.getAttribute&&
b.getAttribute("accept")||"")?RegExp("("+b.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(b,c){i.isFile(b)?e(b,c,"DataURL"):i.isCanvas(b)?d(b,c,"load",i.toDataURL(b)):d(b,c,"error")},readAsBinaryString:function(b,c){i.isFile(b)?e(b,c,"BinaryString"):d(b,c,"error")},toDataURL:function(b){if("string"==typeof b)return b;if(b.toDataURL)return b.toDataURL("image/png")},toBinaryString:function(b){return a.atob(i.toDataURL(b).replace(I,""))},readAsImage:function(b,c,a){if(i.isFile(b))if(u){var h=
u.createObjectURL(b);h===j?d(b,c,"error"):i.readAsImage(h,c,a)}else i.readAsDataURL(b,function(h){"load"==h.type?i.readAsImage(h.result,c,a):(a||"error"==h.type)&&d(b,c,h,null,{loaded:h.loaded,total:h.total})});else i.isCanvas(b)?d(b,c,"load",b):l.test(b.nodeName)?b.complete?d(b,c,"load",b):p(b,"error abort load",function z(a){"load"==a.type&&u&&u.revokeObjectURL(b.src);f(b,"error abort load",z);d(b,c,a,b)}):b.iframe?d(b,c,{type:"error"}):(h=new Image,h.src=b.dataURL||b,i.readAsImage(h,c,a))},checkFileObj:function(b){var c=
{};"object"==typeof b?c=b:c.name=(b+"").split(/(\\|\/)/g).pop();c.type===j&&(c.type=c.name.split(".").pop());i.each(A,function(b,a){b.test(c.type)&&(c.type=a+"/"+c.type)});return c},getFiles:function(b,c,a){var h=[];if(a)return i.filterFiles(i.getFiles(b),c,a),null;b.jquery&&(b.each(function(){h=h.concat(i.getFiles(this))}),b=h,h=[]);"string"==typeof c&&(c=i.getFilesFilter(c));b.originalEvent&&(b=b.originalEvent);b.dataTransfer?b=b.dataTransfer:b.target&&(b=b.target);b.files?h=b.files:!m&&g.test(b&&
b.tagName)?i.trim(b.value)&&(h=[i.checkFileObj(b.value)],h[0].blob=b,h[0].iframe=!0):n(b)&&(h=b);!c&&g.test(b&&b.tagName)&&(c=i.getFilesFilter(b));return i.filter(h,function(b){return!c||c.test(b.name)})},getInfo:function(b,c){var a={},h=C.concat();i.isFile(b)?function z(){var g=h.shift();g?g.test(b.type)?g(b,function(b,h){b?c(b):(i.extend(a,h),z())}):z():c(!1,a)}():c("not_support",a)},addInfoReader:function(b,c){c.test=function(c){return b.test(c)};C.push(c)},addMime:function(b,c){A[b]=RegExp("("+
c.replace(/,/g,"|")+")$","i")},filter:function(b,c){for(var a=[],h=0,g=b.length,e;h<g;h++)h in b&&(e=b[h],c.call(e,e,h,b)&&a.push(e));return a},filterFiles:function(b,c,a){if(b&&(m||b[0].id)){var h=b.concat(),g,e=[],d=[];(function B(){h.length?(g=h.shift(),i.getInfo(g,function(b,a){(c(g,b?!1:a)?e:d).push(g);B()})):a(e,d)})()}else a(b,[])},upload:function(b){var b=i.extend({beforeupload:i.F,upload:i.F,fileupload:i.F,fileprogress:i.F,filecomplete:i.F,progress:i.F,complete:i.F},b),c=new i.XHR(b),a=this._getFilesDataArray(b.files),
h=0,g=0,e=0;i.each(a,function(b){h+=b.size});b.total=h;b.loaded=g;b.beforeupload(c,b);(function H(){var d=a.shift(),u=this;"abort"!=c.statusText&&d?this._getFormData(b,d,function(a){g||b.upload(c,b);var q=new i.XHR(i.extend({},b,{upload:function(){b.fileupload(q,b)},progress:function(c){c.lengthComputable&&(e=g+=~~(h*d.part*(c.loaded/c.total)-e+0.5),b.fileprogress(c,q),b.progress({type:c.type,total:h,loaded:b.loaded=g,lengthComputable:!0}))},complete:function(a){i.extend(c,q);b.loaded=g+=g-e+~~(h*
d.part+0.5);b.filecomplete(a,q);H.call(u)}}));d.part=d.size/h;q.send(a);c.abort=function(){q.abort()}}):b.complete(200==c.status?!1:c.statusText||"error",c)}).call(this);return c},_getFilesDataArray:function(b){var c=[],a={};if(g.test(b&&b.tagName)){var h=i.getFiles(b);a[b.name||"file"]=null!==b.getAttribute("multiple")?h:h[0]}else n(b)&&g.test(b[0]&&b[0].tagName)?i.each(b,function(b){a[b.name||"file"]=i.getFiles(b)}):a=b;i.each(a,function z(b,a){n(b)?i.each(b,function(b,c){z(b,a+"["+c+"]")}):b&&
b.name&&c.push({name:a,file:b,size:b.size})});return c},_getFormData:function(b,a,g){var h=a.file,e=a.name,d=h.name,q=h.type,u=(a=i.support.transform&&b.imageTransform)&&"number"==typeof(a.maxWidth||a.minWidth||a.width),l=new i.Form,f=i.queue(function(){g(l)});a&&(/image/.test(h.type)||c.test(h.nodeType))?(f.inc(),u&&(a=[a]),i.Image.transform(h,a,function(c,a){u&&!c?(!r&&!i.flashEngine&&(a[0]=i.toBinaryString(a[0]),l.multipart=!0),l.append(e,a[0],d,q)):(c||(i.each(a,function(b,c){!r&&!i.flashEngine&&
(b=i.toBinaryString(b),l.multipart=!0);l.append(e+"["+c+"]",b,d,q)}),e+="[original]"),(c||b.imageOriginal)&&l.append(e,h,d,q));f.next()})):l.append(e,h,d);i.each(b.data,function J(b,c){"object"==typeof b?i.each(b,function(b,a){J(b,c+"["+a+"]")}):l.append(c,b)});f.check()},reset:function(b){var c,g;a.jQuery?(g=jQuery(b).clone(!0).insertBefore(b).val("")[0],jQuery(b).remove()):(c=b.parentNode,g=c.insertBefore(b.cloneNode(!0),b),g.value="",c.removeChild(b));i.each(w[i.uid(b)],function(c,a){i.each(c,
function(c){f(b,a,c);k(g,a,c)})});return g},load:function(b,c){var a=i.getXHR();a?(a.open("GET",b,!0),a.overrideMimeType&&a.overrideMimeType("text/plain; charset=x-user-defined"),k(a,"progress",function(b){b.lengthComputable&&c({type:b.type,loaded:b.loaded,total:b.total},a)}),a.onreadystatechange=function(){if(4==a.readyState)if(a.onreadystatechange=null,200==a.status){b=b.split("/");var g={name:b[b.length-1],size:a.getResponseHeader("Content-Length"),type:a.getResponseHeader("Content-Type")};g.dataURL=
"data:"+g.type+";base64,"+i.encode64(a.responseBody||a.responseText);c({type:"load",result:g})}else c({type:"error"})},a.send(null)):c({type:"error"});return a},encode64:function(b){var c="",a=0;for("string"!==typeof b&&(b=String(b));a<b.length;){var g=b.charCodeAt(a++)&255,e=b.charCodeAt(a++)&255,d=b.charCodeAt(a++)&255,q=g>>2,g=(g&3)<<4|e>>4;isNaN(e)?e=d=64:(e=(e&15)<<2|d>>6,d=isNaN(d)?64:d&63);c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(q)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)}return c}};i.each({image:"png,jpg,jpeg,bmp,gif,ico,tif,tiff,tga,pcx,cbz,cbr",audio:"m4a,flac,aac,rm,mpa,wav,wma,ogg,mp3,mp2,m3u,mod,amf,dmf,dsm,far,gdm,imf,it,m15,med,okt,s3m,stm,sfx,ult,uni,xm,sid,ac3,dts,cue,aif,aiff,wpl,ape,mac,mpc,mpp,shn,wv,nsf,spc,gym,adplug,adx,dsp,adp,ymf,ast,afc,hps,xsp",video:"m4v,3gp,nsv,ts,ty,strm,rm,rmvb,m3u,ifo,mov,qt,divx,xvid,bivx,vob,nrg,img,iso,pva,wmv,asf,asx,ogm,m2v,avi,bin,dat,dvr-ms,mpg,mpeg,mp4,mkv,avc,vp3,svq3,nuv,viv,dv,fli,flv,wpl"},
function(b,c){i.addMime(c,b)});i.addInfoReader(/^image/,function(b,c){i.readAsImage(b,function(b){var a=b.target;c("load"==b.type?!1:"error",{width:a.width,height:a.height})})});a.FileAPI=i.extend(i,a.FileAPI)})(this);
(function(a,j,k){function f(a,e){if(!(this instanceof f))return new f(a);this.data=a;this.better=!e;this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0}}var p=Math.min,d=Math.round,e=!1;try{e=-1<j.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")}catch(n){}f.prototype={constructor:f,set:function(e){a.extend(this.matrix,e);return this},crop:function(a,e,d,f){d===k&&(d=a,f=e,a=e=0);return this.set({sx:a,sy:e,sw:d,sh:f||d})},resize:function(a,e,d){"string"==typeof e&&
(d=e,e=a);return this.set({dw:a,dh:e,resize:d})},preview:function(a,e){return this.set({dw:a,dh:e||a,resize:"preview"})},rotate:function(a){return this.set({deg:a})},_load:function(e,d){var f=this;a.readAsImage(e,function(a){d.call(f,"load"!=a.type,a.result)})},_apply:function(a,e){var d=j.createElement("canvas"),f=this.getMatrix(a),k=d.getContext("2d"),m=f.deg,p=f.dw,r=f.dh,n=a.width,l=a.height,t,c=a;if(this.better)for(;2<Math.min(n/p,l/r);)n=~~(n/2+0.5),l=~~(l/2+0.5),t=j.createElement("canvas"),
t.width=n,t.height=l,c!==a?(t.getContext("2d").drawImage(c,0,0,c.width,c.height,0,0,n,l),c=t):(c=t,c.getContext("2d").drawImage(a,f.sx,f.sy,f.sw,f.sh,0,0,n,l),f.sx=f.sy=f.sw=f.sh=0);d.width=!(m%180)?p:r;d.height=m%180?p:r;k.rotate(m*Math.PI/180);k.drawImage(c,f.sx,f.sy,f.sw||c.width,f.sh||c.height,180==m||270==m?-p:0,90==m||180==m?-r:0,p,r);e.call(this,!1,d)},getMatrix:function(e){var f=a.extend({},this.matrix),n=f.sw=f.sw||e.width,e=f.sh=f.sh||e.height,k=f.dw=f.dw||f.sw,j=f.dh=f.dh||f.sh,m=n/e,s=
k/j,r=f.resize;if("preview"==r){if(k!=n||j!=e)if(s>=m?(m=n,r=m/s):(r=e,m=r*s),m!=n||r!=e)f.sx=~~((n-m)/2),f.sy=~~((e-r)/2),n=m,e=r}else r&&("min"==r?(k=d(m<s?p(n,k):j*m),j=d(m<s?k/m:p(e,j))):(k=d(m>=s?p(n,k):j*m),j=d(m>=s?k/m:p(e,j))));f.sw=n;f.sh=e;f.dw=k;f.dh=j;return f},get:function(e){a.support.transform?this._load(this.data,function(a,d){a?e(a):this._apply(d,e)}):e("not_support")},toData:function(a){this.get(a)}};f.transform=function(e,d,n){a.getInfo(e,function(k,j){var p={},s=a.queue(function(a){n(a,
p)});k?s.fail():a.each(d,function(a,d){if(!s.isFail()){var l=f(j.nodeType?j:e);if("function"==typeof a)a(j,l);else if(a.width)l[a.preview?"preview":"resize"](a.width,a.height,a.type);else a.maxWidth&&(j.width>a.maxWidth||j.height>a.maxHeight)&&l.resize(a.maxWidth,a.maxHeight,"max"),l.rotate(~~a.rotate);s.inc();l.toData(function(a,c){a?s.fail():(p[d]=c,s.next())})}})})};a.support.canvas=a.support.transform=e;a.Image=f})(FileAPI,document);
(function(a,j,k){var f=j.encodeURIComponent,p=j.FormData,j=function(){this.items=[]};j.prototype={append:function(a,e,f,k){this.items.push({name:a,blob:e&&e.blob||e,file:f||e.name,type:k||e.type})},each:function(a){for(var e=0,f=this.items.length;e<f;e++)a.call(this,this.items[e])},toData:function(d){a.support.html5?this.multipart?(a.log("FileAPI.Form.toMultipartData"),this.toMultipartData(d)):(a.log("FileAPI.Form.toFormData"),this.toFormData(d)):(a.log("tFileAPI.Form.toHtmlData"),this.toHtmlData(d))},
_to:function(d,e,f,k){var j=a.queue(function(){e(d)});this.each(function(a){f(a,d,j,k)});j.check()},toHtmlData:function(d){this._to(k.createDocumentFragment(),d,function(e,d){var f=e.blob,j;e.file?(a.reset(f),d.appendChild(f)):(j=k.createElement("input"),j.type="hidden",j.value=f,d.appendChild(j))})},toFormData:function(a){this._to(new p,a,function(a,d,f){a.file&&d.append("_"+a.name,a.file);a.blob.toBlob?(f.inc(),a.blob.toBlob(function(j){d.append(a.name,j,a.file);f.next()},"image/png")):a.file?d.append(a.name,
a.blob,a.file):d.append(a.name,a.blob)})},toMultipartData:function(d){this._to([],d,function(a,d,j,k){d.push("--_"+k+('\r\nContent-Disposition: form-data; name="'+a.name+'"'+(a.file?'; filename="'+f(a.file)+'"':"")+(a.file?"\r\nContent-Type: "+(a.type||"application/octet-stream"):"")+"\r\n\r\n"+(a.file?a.blob:f(a.blob))+"\r\n"))},a.expando)}};a.Form=j})(FileAPI,this,document);
(function(a){var j=function(){},k=function(f){this.uid=a.uid();this.xhr={abort:j,getResponseHeader:j,getAllResponseHeaders:j};this.options=f};k.prototype={status:0,statusText:"",getResponseHeader:function(a){return this.xhr.getResponseHeader(a)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(a,k){var d=this,e=d.options;d.abort=j;d.status=a;k&&(d.statusText=k);e.complete(200==a?!1:d.statusText||"unknown",d);d.xhr&&d.xhr.node&&setTimeout(function(){try{d.xhr.node.parentNode.removeChild(d.xhr.node)}catch(a){}d.xhr.node=
null;delete window[d.uid]},1)},abort:function(){this.end(0,"abort");this.xhr&&this.xhr.abort()},send:function(a){var j=this,d=this.options;a.toData(function(a){d.upload(d,j);j._send.call(j,d,a)})},_send:function(f,j){var d=this,e,k=d.uid;a.log("XHR._send:",j);if(j.nodeName){f.upload(f,d);e=document.createElement("div");e.innerHTML='<form target="'+k+'" action="'+f.url+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+
k+'" src="javascript:false;"></iframe><input value="'+k+'" name="callback" type="hidden"/></form>';d.xhr.abort=function(){var a=e.getElementsByName("iframe")[0];if(a)try{a.stop?a.stop():a.contentWindow.stop?a.contentWindow.stop():a.contentWindow.document.execCommand("Stop")}catch(d){}e=null};var q=e.getElementsByTagName("form")[0];q.appendChild(j);document.body.appendChild(e);this.xhr.node=e;window[k]=function(a,f,j){d.readyState=4;d.responseText=j;d.end(a,f);e=null};d.readyState=2;q.submit();q=null}else{e=
d.xhr=a.getXHR();e.open("POST",f.url,!0);e.withCredential="true";(!f.headers||!f.headers["X-Requested-With"])&&e.setRequestHeader("X-Requested-With","XMLHttpRequest");a.each(f.headers,function(a,d){e.setRequestHeader(d,a)});if(e.upload)a.event.on(e.upload,"progress",a.throttle(function(a){f.progress(a,f,d)},100));e.onreadystatechange=function(){d.status=e.status;d.statusText=e.statusText;d.readyState=e.readyState;if(4==e.readyState){for(var a in{"":1,XML:1,Text:1,Body:1})d["response"+a]=e["response"+
a];e.onreadystatechange=null;d.end(e.status)}e=null};a.isArray(j)?(e.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+a.expando),j=j.join("")+"--_"+a.expando+"--",e.sendAsBinary?e.sendAsBinary(j):(k=Array.prototype.map.call(j,function(a){return a.charCodeAt(0)&255}),e.send((new Uint8Array(k)).buffer))):e.send(j)}}};a.XHR=k})(FileAPI);
(function(a,j,k){var f=a.support,p=j.navigator,d=p.mimeTypes,e=!1;if(p.plugins&&"object"==typeof p.plugins["Shockwave Flash"])e=p.plugins["Shockwave Flash"].description&&!(d&&d["application/x-shockwave-flash"]&&!d["application/x-shockwave-flash"].enabledPlugin);else try{e=!(!j.ActiveXObject||!new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(n){}f.flash=e;if(!a.support.html5&&a.support.flash){var q=function(a){return'<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#"  width="100%" height="100%" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>'.replace(/#(\w+)#/ig,
function(g,d){return a[d]})},u=function(a,g){if(a&&a.style){var d,e;for(d in g){e=g[d];"number"==typeof e&&(e+="px");try{a.style[d]=e}catch(f){}}}},y=function(c,g){a.each(g,function(a,g){var d=c[g];c[g]=function(){this.parent=d;return a.apply(this,arguments)}})},x=function(c){var g=c.wid=a.uid();l._fn[g]=c;return"FileAPI.Flash._fn."+g},v=function(a){delete l._fn[a.wid]},m=function(a){var g=k.createElement("a");g.href=a;return g.href},s=a.uid(),r=0,A={},l={_fn:{},init:function(){var c=k.body&&k.body.firstChild;
if(c){do if(1==c.nodeType){a.log("FlashAPI.Flash.inited");var g=k.createElement("div");u(g,{top:1,right:1,width:5,height:5,position:"absolute"});c.parentNode.insertBefore(g,c);l.pingUrl=l.pingUrl||location.protocol+"//"+location.host;l.publish(g,s);return}while(c=c.nextSibling)}10>r&&setTimeout(l.init,50*++r)},publish:function(c,g){c.innerHTML=q({id:g,src:a.staticPath+"FileAPI.flash.swf?r="+a.build,wmode:"transparent",flashvars:"callback=FileAPI.Flash.event&flashId="+g+"&storeKey="+navigator.userAgent.match(/\d/ig).join("")+
"_"+a.build+(l.isReady||!l.pingUrl?"":"&ping="+l.pingUrl)})},ready:function(){l.ready=a.F;l.isReady=!0;l.patch();a.event.on(k,"mouseover",l.mouseover);a.event.on(k,"click",function(a){l.mouseover(a)&&(a.preventDefault?a.preventDefault():a.returnValue=!0)})},getWrapper:function(a){do if(/js-fileapi-wrapper/.test(a.className))return a;while(a=a.parentNode)},mouseover:function(c){c=a.event.fix(c).target;if(/input/i.test(c.nodeName)&&"file"==c.type){var g=c.getAttribute(s);if("n"==g)return!1;if("y"!=
g){c.setAttribute(s,"n");var g=k.createElement("div"),d=l.getWrapper(c);if(!d){a.log("flash.mouseover.error: js-fileapi-wrapper not found");return}u(g,{top:0,left:0,width:c.offsetWidth+100,height:c.offsetHeight+100,position:"absolute"});d.appendChild(g);l.publish(g,a.uid());c.setAttribute(s,"y")}return!0}},event:function(c){var g=c.type;if("ready"==g)return a.log("Flash.event."+c.type+":",c),l.ready(),setTimeout(function(){l.mouseenter(c)},50),!0;"ping"===g?a.log("(flash -> js).ping:",[c.status,c.savedStatus],
c.error):"log"===g?a.log("(flash -> js).log:",c.target):g in l&&setTimeout(function(){a.log("Flash.event."+c.type+":",c);l[g](c)},1)},mouseenter:function(a){var g=l.getInput(a.flashId);g&&(l.cmd(a,"multiple",null!==g.getAttribute("multiple")),l.cmd(a,"accept",(g.getAttribute("accept")||"*").replace(/\./g,"")))},get:function(a){return k[a]||j[a]||k.embeds[a]},getInput:function(a){var g;try{g=l.getWrapper(l.get(a)).getElementsByTagName("input")[0]}catch(d){}return g},select:function(c){var g=l.getInput(c.flashId),
d=a.uid(g),c=c.target.files;a.each(c,function(c){a.checkFileObj(c)});A[d]=c;k.createEvent?(d=k.createEvent("Event"),d.initEvent("change",!0,!1),g.dispatchEvent(d)):k.createEventObject&&(d=k.createEventObject(),g.fireEvent("onchange",d))},cmd:function(c,d,e,f){try{return a.log("(js -> flash)."+d+":",e),l.get(c.flashId||c).cmd(d,e)}catch(j){a.log("(js -> flash).onError:",j),f||setTimeout(function(){l.cmd(c,d,e,!0)},50)}},patch:function(){a.flashEngine=a.support.transform=!0;y(a,{getFiles:function(c,
d,e){if(e)return a.filterFiles(a.getFiles(c),d,e),null;var f=a.isArray(c)?c:A[a.uid(c.target||c.srcElement||c)];if(!f)return this.parent.apply(this,arguments);d&&(d=a.getFilesFilter(d),f=a.filter(f,function(a){return d.test(a.name)}));return f},getInfo:function(a,d){a&&!a.flashId?this.parent.apply(this,arguments):a.info?d(!1,a.info):l.cmd(a,"getFileInfo",{id:a.id,callback:x(function w(e,f){v(w);d(e,a.info=f)})})}});a.support.transform=!0;y(FileAPI.Image.prototype,{_load:function(c,d){if(c&&!c.flashId)this.parent.apply(this,
arguments);else{a.log("_load:",c);var e=this;a.getInfo(c,function(a){d.call(e,a,c)})}},_apply:function(c,d){if(c&&!c.flashId)this.parent.apply(this,arguments);else{a.log("_apply:",c);var e=this.getMatrix(c.info);l.cmd(c,"imageTransform",{id:c.id,matrix:e,callback:x(function C(f,b){v(C);if(f)d(f);else if(!a.support.dataURI||3E4<b.length){var j={width:!(e.deg%180)?e.dw:e.dh,height:e.deg%180?e.dw:e.dh},m=d,h,n=a.uid(),p=k.createElement("ins");u(p,j);p.innerHTML=q({id:n,src:a.staticPath+"FileAPI.flash.image.swf?r="+
a.build,wmode:"opaque",flashvars:"callback="+x(function B(a){try{l.get(n).setImage(b),p=null,v(B)}catch(c){if(!a||"ready"==a.type)clearTimeout(h),h=setTimeout(B,50)}return!0})});m(!1,p)}else{var r=new Image;r.src="data:"+c.type+";base64,"+b;a.event.one(r,"error abort load",function(a){d("load"!=a.type&&a.type,r);r=null})}})})}},toData:function(a){var d=this.data;d&&!d.flashId?this.parent.apply(this,arguments):a.call(this,!d.info,{id:d.id,name:d.name,type:d.type,flashId:d.flashId,matrix:this.getMatrix(d.info)})}});
y(a.Form.prototype,{toData:function(c){for(var d=this.items,e=d.length;e--;)if(d[e].file&&d[e].blob&&!d[e].blob.flashId)return this.parent.apply(this,arguments);a.log("flash.Form.toData");c(d)}});y(a.XHR.prototype,{_send:function(c,d){if(d.nodeName||d.append&&a.support.html5||a.isArray(d)&&"string"===typeof d[0])return this.parent.apply(this,arguments);var e={},f={},j=this,i,b;a.each(d,function(a){a.file?(f[a.name]=a=a.blob,b=a.id,i=a.flashId):e[a.name]=a.blob});a.log("flash.XHR._send:",i,b,f);this.xhr=
{headers:{},abort:function(){l.cmd(i,"abort",b)},getResponseHeader:function(a){return this.headers[a]},getAllResponseHeaders:function(){return this.headers}};l.cmd(i,"upload",{url:m(c.url),data:e,files:f,headers:c.headers,callback:x(function F(b){var d=b.type,e=b.result;a.log("flash.upload."+d+":",b);if("progress"==d)b.lengthComputable=!0,c.progress(b);else if("complete"==d)v(F),"string"==typeof e&&(j.responseText=e.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")),
j.end(b.status);else if("abort"==d||"error"==d)this.end(0,b.message),v(F)})})}})}};a.Flash=l;var t=new Image;a.event.one(t,"error load",function(){a.support.dataURI=!(1!=t.width||1!=t.height);t=null;l.init()});t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}})(FileAPI,this,document);"undefined"!==typeof ajs&&ajs.loaded&&ajs.loaded("{fileapi}FileAPI.min");"function"===typeof define&&define.amd&&define("FileAPI",[],function(){return window.FileAPI||{}});