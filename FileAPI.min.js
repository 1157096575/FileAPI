/**!
 * FileAPI â€” a set of tools for working with files
 *
 * @author  RubaXa  <trash@rubaxa.org>
 * @build	lib/canvas-to-blob lib/FileAPI.core lib/FileAPI.Image lib/FileAPI.Form lib/FileAPI.XHR lib/FileAPI.Flash
 */
(function(a){var k=a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype,g;if(g=a.Blob)try{g=Boolean(new Blob)}catch(j){g=!1}var m=g;if(g=m)if(g=a.Uint8Array)try{g=100===(new Blob([new Uint8Array(100)])).size}catch(f){g=!1}var c=g,q=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder,r=(m||q)&&a.atob&&a.ArrayBuffer&&a.Uint8Array&&function(a){var r,f,g,n;r=0<=a.split(",")[0].indexOf("base64")?atob(a.split(",")[1]):decodeURIComponent(a.split(",")[1]);f=new ArrayBuffer(r.length);g=new Uint8Array(f);
for(n=0;n<r.length;n+=1)g[n]=r.charCodeAt(n);a=a.split(",")[0].split(":")[1].split(";")[0];if(m)return new Blob([c?g:f],{type:a});g=new q;g.append(f);return g.getBlob(a)};a.HTMLCanvasElement&&!k.toBlob&&(k.mozGetAsFile?k.toBlob=function(a,c){a(this.mozGetAsFile("blob",c))}:k.toDataURL&&r&&(k.toBlob=function(a,c){a(r(this.toDataURL(c)))}));"function"===typeof define&&define.amd?define(function(){return r}):a.dataURLtoBlob=r})(this);
(function(a,k){function g(b,t,a){if(b)if(e(b))for(var d=0,c=b.length;d<c;d++)d in b&&t.call(a,b[d],d,b);else for(d in b)b.hasOwnProperty(d)&&t.call(a,b[d],d,b)}function j(b,t,d){if(b){var a=h.uid(b);A[a]||(A[a]={});g(t.split(/\s+/),function(t){s?s.event.add(b,t,d):(A[a][t]||(A[a][t]=[]),A[a][t].push(d),b.addEventListener?b.addEventListener(t,d,!1):b.attachEvent?b.attachEvent("on"+t,d):b["on"+t]=d)})}}function m(b,t,d){if(b){var a=h.uid(b),c=A[a]||{};g(t.split(/\s+/),function(t){if(s)s.event.remove(b,
t,d);else{for(var a=c[t]||[],v=a.length;v--;)if(a[v]===d){a.splice(v,1);break}b.addEventListener?b.removeEventListener(t,d,!1):b.detachEvent?b.detachEvent("on"+t,d):b["on"+t]=null}})}}function f(b,t,d){j(b,t,function L(a){m(b,t,L);d(a)})}function c(b,t,d,a,c){b={type:d.type||d,target:b,result:a};h.extend(b,c);t(b)}function q(b,d,a){if(n){var v=new n;j(v,H,function G(a){var x=a.type;"progress"==x?c(b,d,a,a.target.result,{loaded:a.loaded,total:a.total}):"loadend"==x?(m(v,H,G),v=null):c(b,d,a,a.target.result)});
try{v["readAs"+a](b)}catch(e){c(b,d,"error",k,{error:e.toString()})}}else c(b,d,"error",k,{error:"FileReader is not supported"})}function r(b,a){if(b)if(b.isFile)b.file(function(b){a(!1,[b])},function(){a("entry_file")});else if(b.isDirectory){var d=[];b.createReader().readEntries(function(b){h.afor(b,function(b,c){r(c,function(c,v){c||(d=d.concat(v));b?b():a(!1,d)})})},function(){a("directory_reader")})}else{var c=r,e;b.getAsEntry?e=b.getAsEntry():b.webkitGetAsEntry&&(e=b.webkitGetAsEntry());c(e,
a)}else a("empty_entry")}function e(b){return"object"==typeof b&&b&&"length"in b}var B=1,i=a.createObjectURL&&a||a.URL&&URL.revokeObjectURL&&URL||a.webkitURL&&webkitURL,z=a.File,n=a.FileReader,y=a.FormData,s=a.jQuery,E=(y=!(!z||!(n&&a.Uint8Array||y)))&&"withCredentials"in new XMLHttpRequest,C=y&&E,l=a.document,u=a.dataURLtoBlob,d={},p=/img/i,M=/canvas/i,J=/img|canvas/,D=/input/i,N=/^data:[^,]+,/,K=Math.pow,A={},F=[],H="abort progress error load loadend",O="status statusText readyState response responseXML responseText responseBody".split(" "),
h={build:2,debug:!1,staticPath:"./",KB:1024,MB:K(1024,2),GB:K(1024,3),TB:K(1024,4),expando:"fileapi"+ +new Date,uid:function(b){return b?b[h.expando]=b[h.expando]||h.uid():h.expando+ ++B},log:function(){h.debug&&(a.console&&console.log)&&(console.log.apply?console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},getXHR:function(){var b;if(a.XMLHttpRequest)b=new XMLHttpRequest;else if(a.ActiveXObject)try{b=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(d){}return b},isArray:e,
support:{cors:E,html5:y,dataURI:!0},event:{on:j,off:m,one:f,fix:function(b){b.target||(b.target=a.event&&a.event.srcElement||l);3===b.target.nodeType&&(b.target=event.target.parentNode);return b}},throttle:function(b,d){var c,v,e;return function G(){v=arguments;e=!0;c||(e?(b.apply(a,v),e=!1,c=setTimeout(G,d)):c=null)}},F:function(){},parseJSON:function(b){return a.JSON&&JSON.parse?JSON.parse(b):(new Function("return ("+b.replace(/([\r\n])/g,"\\$1")+");"))()},trim:function(b){b=String(b);return b.trim?
b.trim():b.replace(/^\s+|\s+$/g,"")},queue:function(b){var a=0,d=0,c=!1,e=!1,p={inc:function(){d++},next:function(){a++;setTimeout(p.check,0)},check:function(){a>=d&&!c&&p.end()},isFail:function(){return c},fail:function(){!c&&b(c=!0)},end:function(){e||(e=!0,b())}};return p},each:g,afor:function(b,a){var d=0,c=b.length;e(b)&&c--?function w(){a(c!=d&&w,b[d],d++)}():a(!1)},extend:function(b){g(arguments,function(a){g(a,function(a,d){b[d]=a})});return b},isFile:function(b){return C&&b&&b instanceof
z},isCanvas:function(b){return b&&M.test(b.nodeName)},getFilesFilter:function(b){return(b="string"==typeof b?b:b.getAttribute&&b.getAttribute("accept")||"")?RegExp("("+b.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(b,a){h.isFile(b)?q(b,a,"DataURL"):h.isCanvas(b)?c(b,a,"load",h.toDataURL(b)):c(b,a,"error")},readAsBinaryString:function(b,a){h.isFile(b)?q(b,a,"BinaryString"):c(b,a,"error")},toDataURL:function(b){if("string"==typeof b)return b;if(b.toDataURL)return b.toDataURL("image/png")},
toBinaryString:function(b){return a.atob(h.toDataURL(b).replace(N,""))},readAsImage:function(b,a,d){if(h.isFile(b))if(i){var e=i.createObjectURL(b);e===k?c(b,a,"error"):h.readAsImage(e,a,d)}else h.readAsDataURL(b,function(e){"load"==e.type?h.readAsImage(e.result,a,d):(d||"error"==e.type)&&c(b,a,e,null,{loaded:e.loaded,total:e.total})});else h.isCanvas(b)?c(b,a,"load",b):p.test(b.nodeName)?b.complete?c(b,a,"load",b):f(b,"error abort load",function w(d){"load"==d.type&&i&&i.revokeObjectURL(b.src);m(b,
"error abort load",w);c(b,a,d,b)}):b.iframe?c(b,a,{type:"error"}):(e=new Image,e.src=b.dataURL||b,h.readAsImage(e,a,d))},checkFileObj:function(b){var a={};"object"==typeof b?a=b:a.name=(b+"").split(/(\\|\/)/g).pop();a.type===k&&(a.type=a.name.split(".").pop());g(d,function(b,d){b.test(a.type)&&(a.type=d+"/"+a.type)});return a},getDropFiles:function(b,a){var d=[],c=(b.originalEvent||b||"").dataTransfer||{},p=e(c.items),w=h.queue(function(){a(d)});g((p?c.items:c.files)||[],function(b){w.inc();if(p)r(b,
function(b,a){!b&&d.push.apply(d,a);w.next()});else{var a=function(a){a&&d.push(b);w.next()};if(!b.type&&0==b.size%4096&&102400>=b.size)if(n)try{var c=new n;f(c,H,function(b){b="error"!=b.type;a(b);b&&c.abort()});c.readAsBinaryString(b)}catch(e){a(!1)}else a(null);else a(!0)}});w.check()},getFiles:function(b,a,d){var c=[];if(d)return h.filterFiles(h.getFiles(b),a,d),null;b.jquery&&(b.each(function(){c=c.concat(h.getFiles(this))}),b=c,c=[]);"string"==typeof a&&(a=h.getFilesFilter(a));b.originalEvent&&
(b=b.originalEvent);b.dataTransfer?b=b.dataTransfer:b.target&&(b=b.target);b.files?c=b.files:!C&&D.test(b&&b.tagName)?h.trim(b.value)&&(c=[h.checkFileObj(b.value)],c[0].blob=b,c[0].iframe=!0):e(b)&&(c=b);!a&&D.test(b&&b.tagName)&&(a=h.getFilesFilter(b));return h.filter(c,function(b){return!a||a.test(b.name)})},getInfo:function(b,a){var d={},c=F.concat();h.isFile(b)?function w(){var e=c.shift();e?e.test(b.type)?e(b,function(b,c){b?a(b):(h.extend(d,c),w())}):w():a(!1,d)}():a("not_support",d)},addInfoReader:function(b,
a){a.test=function(a){return b.test(a)};F.push(a)},addMime:function(b,a){d[b]=RegExp("("+a.replace(/,/g,"|")+")$","i")},filter:function(b,a){for(var d=[],c=0,e=b.length,p;c<e;c++)c in b&&(p=b[c],a.call(p,p,c,b)&&d.push(p));return d},filterFiles:function(b,a,d){if(b&&(C||b[0].id)){var c=b.concat(),e,p=[],r=[];(function I(){c.length?(e=c.shift(),h.getInfo(e,function(b,d){(a(e,b?!1:d)?p:r).push(e);I()})):d(p,r)})()}else d(b,[])},upload:function(b){var b=h.extend({beforeupload:h.F,upload:h.F,fileupload:h.F,
fileprogress:h.F,filecomplete:h.F,progress:h.F,complete:h.F},b),a=new h.XHR(b),d=this._getFilesDataArray(b.files),c=0,e=0,p=0,r=1;g(d,function(b){c+=b.size});a.total=c;a.loaded=0;b.beforeupload(a,b);(function I(){var f=d.shift(),l=this;a.currentFile=f;"abort"!=a.statusText&&f?this._getFormData(b,f,function(d){e||b.upload(a,b);var x=f.file,i=new h.XHR(h.extend({},b,{upload:function(){b.fileupload(x,i,b)},progress:function(d){d.lengthComputable&&(p=e+=~~(c*r*(d.loaded/d.total)-p+0.5),b.fileprogress(d,
x,i,b),b.progress({type:d.type,total:c,loaded:a.loaded=e,lengthComputable:!0},x,i,b))},complete:function(d){g(O,function(b){a[b]=i[b]});a.loaded=e+=e-p+~~(c*r+0.5);b.filecomplete(d,i,x,b);I.call(l)}}));r=f.size/c;a.abort=function(){i.abort()};i.send(d)}):b.complete(200==a.status?!1:a.statusText||"error",a,b)}).call(this);return a},_getFilesDataArray:function(b){var a=[],d={};if(D.test(b&&b.tagName)){var c=h.getFiles(b);d[b.name||"file"]=null!==b.getAttribute("multiple")?c:c[0]}else e(b)&&D.test(b[0]&&
b[0].tagName)?g(b,function(b){d[b.name||"file"]=h.getFiles(b)}):d=b;g(d,function w(b,d){e(b)?g(b,function(b,a){w(b,d+"["+a+"]")}):b&&b.name&&a.push({name:d,file:b,size:b.size})});return a},_getFormData:function(b,a,d){var c=a.file,e=a.name,p=c.name,r=c.type,f=(a=h.support.transform&&b.imageTransform)&&"number"==typeof(a.maxWidth||a.minWidth||a.width),i=new h.Form,l=h.queue(function(){d(i)});a&&(/image/.test(c.type)||J.test(c.nodeType))?(l.inc(),f&&(a=[a]),h.Image.transform(c,a,function(a,d){f&&!a?
(!u&&!h.flashEngine&&(d[0]=h.toBinaryString(d[0]),i.multipart=!0),i.append(e,d[0],p,r)):(a||(g(d,function(b,a){!u&&!h.flashEngine&&(b=h.toBinaryString(b),i.multipart=!0);i.append(e+"["+a+"]",b,p,r)}),e+="[original]"),(a||b.imageOriginal)&&i.append(e,c,p,r));l.next()})):i.append(e,c,p);g(b.data,function P(b,a){"object"==typeof b?g(b,function(b,d){P(b,a+"["+d+"]")}):i.append(a,b)});l.check()},reset:function(b){var a,d;s?(d=s(b).clone(!0).insertBefore(b).val("")[0],s(b).remove()):(a=b.parentNode,d=a.insertBefore(b.cloneNode(!0),
b),d.value="",a.removeChild(b),g(A[h.uid(b)],function(a,c){g(a,function(a){m(b,c,a);j(d,c,a)})}));return d},load:function(b,a){var d=h.getXHR();d?(d.open("GET",b,!0),d.overrideMimeType&&d.overrideMimeType("text/plain; charset=x-user-defined"),j(d,"progress",function(b){b.lengthComputable&&a({type:b.type,loaded:b.loaded,total:b.total},d)}),d.onreadystatechange=function(){if(4==d.readyState)if(d.onreadystatechange=null,200==d.status){b=b.split("/");var c={name:b[b.length-1],size:d.getResponseHeader("Content-Length"),
type:d.getResponseHeader("Content-Type")};c.dataURL="data:"+c.type+";base64,"+h.encode64(d.responseBody||d.responseText);a({type:"load",result:c})}else a({type:"error"})},d.send(null)):a({type:"error"});return d},encode64:function(b){var a="",d=0;for("string"!==typeof b&&(b=String(b));d<b.length;){var c=b.charCodeAt(d++)&255,e=b.charCodeAt(d++)&255,p=b.charCodeAt(d++)&255,r=c>>2,c=(c&3)<<4|e>>4;isNaN(e)?e=p=64:(e=(e&15)<<2|p>>6,p=isNaN(p)?64:p&63);a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(r)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(p)}return a}};g({image:"png,jpg,jpeg,bmp,gif,ico,tif,tiff,tga,pcx,cbz,cbr",audio:"m4a,flac,aac,rm,mpa,wav,wma,ogg,mp3,mp2,m3u,mod,amf,dmf,dsm,far,gdm,imf,it,m15,med,okt,s3m,stm,sfx,ult,uni,xm,sid,ac3,dts,cue,aif,aiff,wpl,ape,mac,mpc,mpp,shn,wv,nsf,spc,gym,adplug,adx,dsp,adp,ymf,ast,afc,hps,xsp",
video:"m4v,3gp,nsv,ts,ty,strm,rm,rmvb,m3u,ifo,mov,qt,divx,xvid,bivx,vob,nrg,img,iso,pva,wmv,asf,asx,ogm,m2v,avi,bin,dat,dvr-ms,mpg,mpeg,mp4,mkv,avc,vp3,svq3,nuv,viv,dv,fli,flv,wpl"},function(b,a){h.addMime(a,b)});h.addInfoReader(/^image/,function(b,a){h.readAsImage(b,function(b){var d=b.target;a("load"==b.type?!1:"error",{width:d.width,height:d.height})})});h.event.dnd=function(b,a,d){var c,e;d||(d=a,a=h.F);n?(j(b,"dragenter dragleave dragover",function(b){for(var d=((b.originalEvent||b||"").dataTransfer||
{}).types,p=d&&d.length;p--;)~d[p].indexOf("File")&&(b.preventDefault(),e!==b.type&&(e=b.type,"dragleave"!=e&&a.call(b.currentTarget,!0,b),clearTimeout(c),c=setTimeout(function(){a.call(b.currentTarget,"dragleave"!=e,b)},50)))}),j(b,"drop",function(b){b.preventDefault();e=0;a.call(b.currentTarget,!1,b);h.getDropFiles(b,function(a){d.call(b.currentTarget,a,b)})})):h.log("Drag'n'Drop -- not supported")};s&&!s.fn.dnd&&(s.fn.dnd=function(b,a){return this.each(function(){h.event.dnd(this,b,a)})});a.FileAPI=
h.extend(h,a.FileAPI)})(window);
(function(a,k,g){function j(a,c){if(!(this instanceof j))return new j(a);this.data=a;this.better=!c;this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0}}var m=Math.min,f=Math.round,c=!1;try{c=-1<k.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")}catch(q){}j.prototype={constructor:j,set:function(c){a.extend(this.matrix,c);return this},crop:function(a,c,f,i){f===g&&(f=a,i=c,a=c=0);return this.set({sx:a,sy:c,sw:f,sh:i||f})},resize:function(a,c,f){"string"==typeof c&&
(f=c,c=a);return this.set({dw:a,dh:c,resize:f})},preview:function(a,c){return this.set({dw:a,dh:c||a,resize:"preview"})},rotate:function(a){return this.set({deg:a})},_load:function(c,e){var f=this;a.readAsImage(c,function(a){e.call(f,"load"!=a.type,a.result)})},_apply:function(a,c){var f=k.createElement("canvas"),i=this.getMatrix(a),g=f.getContext("2d"),n=i.deg,j=i.dw,s=i.dh,m=a.width,q=a.height,l,u=a;if(this.better)for(;2<Math.min(m/j,q/s);)m=~~(m/2+0.5),q=~~(q/2+0.5),l=k.createElement("canvas"),
l.width=m,l.height=q,u!==a?(l.getContext("2d").drawImage(u,0,0,u.width,u.height,0,0,m,q),u=l):(u=l,u.getContext("2d").drawImage(a,i.sx,i.sy,i.sw,i.sh,0,0,m,q),i.sx=i.sy=i.sw=i.sh=0);f.width=!(n%180)?j:s;f.height=n%180?j:s;g.rotate(n*Math.PI/180);g.drawImage(u,i.sx,i.sy,i.sw||u.width,i.sh||u.height,180==n||270==n?-j:0,90==n||180==n?-s:0,j,s);c.call(this,!1,f)},getMatrix:function(c){var e=a.extend({},this.matrix),g=e.sw=e.sw||c.width,c=e.sh=e.sh||c.height,i=e.dw=e.dw||e.sw,j=e.dh=e.dh||e.sh,n=g/c,q=
i/j,s=e.resize;if("preview"==s){if(i!=g||j!=c)if(q>=n?(n=g,s=n/q):(s=c,n=s*q),n!=g||s!=c)e.sx=~~((g-n)/2),e.sy=~~((c-s)/2),g=n,c=s}else s&&("min"==s?(i=f(n<q?m(g,i):j*n),j=f(n<q?i/n:m(c,j))):(i=f(n>=q?m(g,i):j*n),j=f(n>=q?i/n:m(c,j))));e.sw=g;e.sh=c;e.dw=i;e.dh=j;return e},get:function(c){a.support.transform?this._load(this.data,function(a,f){a?c(a):this._apply(f,c)}):c("not_support")},toData:function(a){this.get(a)}};j.transform=function(c,e,f){a.getInfo(c,function(g,q){var m={},k=a.queue(function(a){f(a,
m)});g?k.fail():a.each(e,function(a,e){if(!k.isFail()){var f=j(q.nodeType?q:c);if("function"==typeof a)a(q,f);else if(a.width)f[a.preview?"preview":"resize"](a.width,a.height,a.type);else a.maxWidth&&(q.width>a.maxWidth||q.height>a.maxHeight)&&f.resize(a.maxWidth,a.maxHeight,"max"),f.rotate(~~a.rotate);k.inc();f.toData(function(a,c){a?k.fail():(m[e]=c,k.next())})}})})};a.support.canvas=a.support.transform=c;a.Image=j})(FileAPI,document);
(function(a,k,g){var j=k.encodeURIComponent,m=k.FormData,k=function(){this.items=[]};k.prototype={append:function(a,c,g,j){this.items.push({name:a,blob:c&&c.blob||c,file:g||c.name,type:j||c.type})},each:function(a){for(var c=0,g=this.items.length;c<g;c++)a.call(this,this.items[c])},toData:function(f){a.support.html5?this.multipart?(a.log("FileAPI.Form.toMultipartData"),this.toMultipartData(f)):(a.log("FileAPI.Form.toFormData"),this.toFormData(f)):(a.log("tFileAPI.Form.toHtmlData"),this.toHtmlData(f))},
_to:function(f,c,g,j){var e=a.queue(function(){c(f)});this.each(function(a){g(a,f,e,j)});e.check()},toHtmlData:function(f){this._to(g.createDocumentFragment(),f,function(c,f){var j=c.blob,e;c.file?(a.reset(j),f.appendChild(j)):(e=g.createElement("input"),e.type="hidden",e.value=j,f.appendChild(e))})},toFormData:function(a){this._to(new m,a,function(a,f,g){a.file&&f.append("_"+a.name,a.file);a.blob.toBlob?(g.inc(),a.blob.toBlob(function(e){f.append(a.name,e,a.file);g.next()},"image/png")):a.file?f.append(a.name,
a.blob,a.file):f.append(a.name,a.blob)})},toMultipartData:function(f){this._to([],f,function(a,f,g,e){f.push("--_"+e+('\r\nContent-Disposition: form-data; name="'+a.name+'"'+(a.file?'; filename="'+j(a.file)+'"':"")+(a.file?"\r\nContent-Type: "+(a.type||"application/octet-stream"):"")+"\r\n\r\n"+(a.file?a.blob:j(a.blob))+"\r\n"))},a.expando)}};a.Form=k})(FileAPI,window,document);
(function(a){var k=function(){},g=function(g){this.uid=a.uid();this.xhr={abort:k,getResponseHeader:k,getAllResponseHeaders:k};this.options=g};g.prototype={status:0,statusText:"",getResponseHeader:function(a){return this.xhr.getResponseHeader(a)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(a,g){var f=this,c=f.options;f.abort=k;f.status=a;g&&(f.statusText=g);c.complete(200==a?!1:f.statusText||"unknown",f);f.xhr&&f.xhr.node&&setTimeout(function(){try{f.xhr.node.parentNode.removeChild(f.xhr.node)}catch(a){}f.xhr.node=
null;delete window[f.uid]},1)},abort:function(){this.end(0,"abort");this.xhr&&this.xhr.abort()},send:function(a){var g=this,f=this.options;a.toData(function(a){f.upload(f,g);g._send.call(g,f,a)})},_send:function(g,m){var f=this,c,k=f.uid;a.log("XHR._send:",m);if(m.nodeName){g.upload(g,f);c=document.createElement("div");c.innerHTML='<form target="'+k+'" action="'+g.url+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+
k+'" src="javascript:false;"></iframe><input value="'+k+'" name="callback" type="hidden"/></form>';f.xhr.abort=function(){var a=c.getElementsByName("iframe")[0];if(a)try{a.stop?a.stop():a.contentWindow.stop?a.contentWindow.stop():a.contentWindow.document.execCommand("Stop")}catch(f){}c=null};var r=c.getElementsByTagName("form")[0];r.appendChild(m);document.body.appendChild(c);this.xhr.node=c;window[k]=function(a,g,i){f.readyState=4;f.responseText=i;f.end(a,g);c=null};f.readyState=2;r.submit();r=null}else c=
f.xhr=a.getXHR(),c.open("POST",g.url,!0),c.withCredential="true",(!g.headers||!g.headers["X-Requested-With"])&&c.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.each(g.headers,function(a,f){c.setRequestHeader(f,a)}),c.upload&&c.upload.addEventListener("progress",a.throttle(function(a){g.progress(a,f,g)},100),!1),c.onreadystatechange=function(){f.status=c.status;f.statusText=c.statusText;f.readyState=c.readyState;if(4==c.readyState){for(var a in{"":1,XML:1,Text:1,Body:1})f["response"+a]=c["response"+
a];c.onreadystatechange=null;f.end(c.status);c=null}},a.isArray(m)?(c.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+a.expando),m=m.join("")+"--_"+a.expando+"--",c.sendAsBinary?c.sendAsBinary(m):(k=Array.prototype.map.call(m,function(a){return a.charCodeAt(0)&255}),c.send((new Uint8Array(k)).buffer))):c.send(m)}};a.XHR=g})(FileAPI);
(function(a,k,g){var j=a.support,m=k.navigator,f=m.mimeTypes,c=!1;if(m.plugins&&"object"==typeof m.plugins["Shockwave Flash"])c=m.plugins["Shockwave Flash"].description&&!(f&&f["application/x-shockwave-flash"]&&!f["application/x-shockwave-flash"].enabledPlugin);else try{c=!(!k.ActiveXObject||!new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(q){}j.flash=c;if(!a.support.cors&&a.support.flash){var r=function(a){return'<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#"  width="100%" height="100%" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>'.replace(/#(\w+)#/ig,
function(c,e){return a[e]})},e=function(a,c){if(a&&a.style){var e,f;for(e in c){f=c[e];"number"==typeof f&&(f+="px");try{a.style[e]=f}catch(g){}}}},B=function(d,c){a.each(c,function(a,c){var e=d[c];d[c]=function(){this.parent=e;return a.apply(this,arguments)}})},i=function(d){var c=d.wid=a.uid();l._fn[c]=d;return"FileAPI.Flash._fn."+c},z=function(a){delete l._fn[a.wid]},n=function(a){if(!C.test(a)){if(/^\.\//.test(a)||"/"!=a.charAt(0))a=location.pathname+"/"+a.substr(RegExp.$1?2:0);"//"!=a.substr(0,
2)&&(a=location.hostname+"/"+a);C.test(a)||(a=location.protocol+"//"+a)}return a},y=a.uid(),s=0,E={},C=/^https?:/i,l={_fn:{},init:function(){var d=g.body&&g.body.firstChild;if(d){do if(1==d.nodeType){a.log("FlashAPI.Flash.inited");var c=g.createElement("div");e(c,{top:1,right:1,width:5,height:5,position:"absolute"});d.parentNode.insertBefore(c,d);l.pingUrl=l.pingUrl||location.protocol+"//"+location.host;l.publish(c,y);return}while(d=d.nextSibling)}10>s&&setTimeout(l.init,50*++s)},publish:function(d,
c){d.innerHTML=r({id:c,src:n(a.staticPath+"FileAPI.flash.swf?r="+a.build),wmode:"transparent",flashvars:"callback=FileAPI.Flash.event&flashId="+c+"&storeKey="+navigator.userAgent.match(/\d/ig).join("")+"_"+a.build+(l.isReady||!l.pingUrl?"":"&ping="+l.pingUrl)})},ready:function(){l.ready=a.F;l.isReady=!0;l.patch();a.event.on(g,"mouseover",l.mouseover);a.event.on(g,"click",function(a){l.mouseover(a)&&(a.preventDefault?a.preventDefault():a.returnValue=!0)})},getWrapper:function(a){do if(/js-fileapi-wrapper/.test(a.className))return a;
while((a=a.parentNode)&&a!==g.body)},mouseover:function(d){d=a.event.fix(d).target;if(/input/i.test(d.nodeName)&&"file"==d.type){var c=d.getAttribute(y);if("n"==c)return!1;if("y"!=c){d.setAttribute(y,"n");var c=g.createElement("div"),f=l.getWrapper(d);if(!f){a.log("flash.mouseover.error: js-fileapi-wrapper not found");return}e(c,{top:0,left:0,width:d.offsetWidth+100,height:d.offsetHeight+100,position:"absolute"});f.appendChild(c);l.publish(c,a.uid());d.setAttribute(y,"y")}return!0}},event:function(d){var c=
d.type;if("ready"==c)return l.ready(),setTimeout(function(){l.mouseenter(d)},50),!0;"ping"===c?a.log("(flash -> js).ping:",[d.status,d.savedStatus],d.error):"log"===c?a.log("(flash -> js).log:",d.target):c in l&&setTimeout(function(){a.log("Flash.event."+d.type+":",d);l[c](d)},1)},mouseenter:function(a){var c=l.getInput(a.flashId);c&&(l.cmd(a,"multiple",null!==c.getAttribute("multiple")),l.cmd(a,"accept",(c.getAttribute("accept")||"*").replace(/\./g,"")))},get:function(a){return g[a]||k[a]||g.embeds[a]},
getInput:function(a){try{var c=l.getWrapper(l.get(a));if(c)return c.getElementsByTagName("input")[0]}catch(e){}},select:function(c){var e=l.getInput(c.flashId),f=a.uid(e),c=c.target.files;a.each(c,function(c){a.checkFileObj(c)});E[f]=c;g.createEvent?(f=g.createEvent("Event"),f.initEvent("change",!0,!1),e.dispatchEvent(f)):g.createEventObject&&(f=g.createEventObject(),e.fireEvent("onchange",f))},cmd:function(c,e,f,g){try{return a.log("(js -> flash)."+e+":",f),l.get(c.flashId||c).cmd(e,f)}catch(i){a.log("(js -> flash).onError:",
i),g||setTimeout(function(){l.cmd(c,e,f,!0)},50)}},patch:function(){a.flashEngine=a.support.transform=!0;B(a,{getFiles:function(c,e,f){if(f)return a.filterFiles(a.getFiles(c),e,f),null;var g=a.isArray(c)?c:E[a.uid(c.target||c.srcElement||c)];if(!g)return this.parent.apply(this,arguments);e&&(e=a.getFilesFilter(e),g=a.filter(g,function(a){return e.test(a.name)}));return g},getInfo:function(a,c){a&&!a.flashId?this.parent.apply(this,arguments):a.info?c(!1,a.info):l.cmd(a,"getFileInfo",{id:a.id,callback:i(function J(e,
f){z(J);c(e,a.info=f)})})}});a.support.transform=!0;B(FileAPI.Image.prototype,{_load:function(c,e){a.log("FileAPI.Image._load:",c);if(c&&!c.flashId)this.parent.apply(this,arguments);else{var f=this;a.getInfo(c,function(a){e.call(f,a,c)})}},_apply:function(c,f){a.log("FileAPI.Image._apply:",c);if(c&&!c.flashId)this.parent.apply(this,arguments);else{var j=this.getMatrix(c.info);l.cmd(c,"imageTransform",{id:c.id,matrix:j,callback:i(function D(k,m){z(D);if(k)f(k);else if(!a.support.dataURI||3E4<m.length){var n=
{width:!(j.deg%180)?j.dw:j.dh,height:j.deg%180?j.dw:j.dh},s=f,q,u=a.uid(),h=g.createElement("ins");for(q in n)h.setAttribute("data-img-"+q,n[q]);e(h,n);h.innerHTML=r({id:u,src:a.staticPath+"FileAPI.flash.image.swf?r="+a.build,wmode:"opaque",flashvars:"callback="+i(function x(a){try{l.get(u).setImage(m),h=null,z(x)}catch(b){if(!a||"ready"==a.type)clearTimeout(q),q=setTimeout(x,50)}return!0})});s(!1,h)}else{var b=new Image;b.src="data:"+c.type+";base64,"+m;a.event.one(b,"error abort load",function(a){f("load"!=
a.type&&a.type,b);b=null})}})})}},toData:function(a){var c=this.data;c&&!c.flashId?this.parent.apply(this,arguments):a.call(this,!c.info,{id:c.id,flashId:c.flashId,name:c.name,type:c.type,matrix:this.getMatrix(c.info)})}});B(a.Form.prototype,{toData:function(c){for(var e=this.items,f=e.length;f--;)if(e[f].file&&e[f].blob&&!e[f].blob.flashId)return this.parent.apply(this,arguments);a.log("flash.Form.toData");c(e)}});B(a.XHR.prototype,{_send:function(c,e){if(e.nodeName||e.append&&a.support.html5||a.isArray(e)&&
"string"===typeof e[0])return this.parent.apply(this,arguments);var f={},g={},j=this,k,m;a.each(e,function(a){a.file?(g[a.name]=a=a.blob,m=a.id,k=a.flashId):f[a.name]=a.blob});a.log("flash.XHR._send:",k,m,g);this.xhr={headers:{},abort:function(){l.cmd(k,"abort",m)},getResponseHeader:function(a){return this.headers[a]},getAllResponseHeaders:function(){return this.headers}};l.cmd(k,"upload",{url:n(c.url),data:f,files:g,headers:c.headers,callback:i(function F(e){var f=e.type,g=e.result;a.log("flash.upload."+
f+":",e);if("progress"==f)e.loaded=Math.min(e.loaded,e.total),e.lengthComputable=!0,c.progress(e);else if("complete"==f)z(F),"string"==typeof g&&(j.responseText=g.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")),j.end(e.status||200);else if("abort"==f||"error"==f)j.end(0,e.message),z(F)})})}})}};a.Flash=l;var u=new Image;a.event.one(u,"error load",function(){a.support.dataURI=!(1!=u.width||1!=u.height);u=null;l.init()});u.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}})(FileAPI,
window,document);"undefined"!==typeof ajs&&ajs.loaded&&ajs.loaded("{fileapi}FileAPI.min");"function"===typeof define&&define.amd&&define("FileAPI",[],function(){return window.FileAPI||{}});