/**!
 * FileAPI â€” a set of tools for working with files
 *
 * @author  RubaXa  <trash@rubaxa.org>
 * @build	lib/canvas-to-blob lib/FileAPI.html lib/FileAPI.Image lib/FileAPI.Form lib/FileAPI.XHR lib/FileAPI.Flash
 */
(function(a){var k=a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype,i=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder,g=i&&a.atob&&a.ArrayBuffer&&a.Uint8Array&&function(a){var d,e,g,r;d=0<=a.split(",")[0].indexOf("base64")?atob(a.split(",")[1]):decodeURIComponent(a.split(",")[1]);e=new ArrayBuffer(d.length);g=new Uint8Array(e);for(r=0;r<d.length;r+=1)g[r]=d.charCodeAt(r);d=new i;d.append(e);a=a.split(",")[0].split(":")[1].split(";")[0];return d.getBlob(a)};a.HTMLCanvasElement&&!k.toBlob&&(k.mozGetAsFile?
k.toBlob=function(a,d){a(this.mozGetAsFile("blob",d))}:k.toDataURL&&g&&(k.toBlob=function(a,d){a(g(this.toDataURL(d)))}));"undefined"!==typeof define&&define.amd?define(function(){return g}):a.dataURLtoBlob=g})(this);
(function(a,k){function i(b,c,a){if(b){var l=h.uid(b);w[l]||(w[l]={});h.each(c.split(/\s+/),function(c){w[l][c]||(w[l][c]=[]);w[l][c].push(a);b.addEventListener?b.addEventListener(c,a,!1):b.attachEvent?b.attachEvent("on"+c,a):b["on"+c]=a})}}function g(b,c,a){if(b){var l=h.uid(b),f=w[l]||{};h.each(c.split(/\s+/),function(c){for(var A=f[c]||[],l=A.length;l--;)if(A[l]===a){A.splice(l,1);break}b.addEventListener?b.removeEventListener(c,a,!1):b.detachEvent?b.detachEvent("on"+c,a):b["on"+c]=null})}}function q(b,
c,a){i(b,c,function D(f){a(f);g(b,c,D)})}function d(b,c,a,l,f){b={type:a.type||a,target:b,result:l};h.extend(b,f);c(b)}function e(b,c,a){if(t){var l=new t;i(l,"abort progress error load loadend",function B(a){var f=a.type;"progress"==f?d(b,c,a,a.target.result,{loaded:a.loaded,total:a.total}):"loadend"==f?(g(l,"abort progress error load loadend",B),l=null):d(b,c,a,a.target.result)});try{l["readAs"+a](b)}catch(f){d(b,c,"error",k,{error:f.toString()})}}else d(b,c,"error",k,{error:"FileReader is not supported"})}
function o(b){return"object"==typeof b&&b&&"length"in b}var r=1,j=a.createObjectURL&&a||a.URL&&URL.revokeObjectURL&&URL||a.webkitURL&&webkitURL,z=a.File,t=a.FileReader,x=a.FormData,n=!(!z||!(t&&a.Uint8Array||x)),u=a.document,p=a.dataURLtoBlob,m={},c=/img/i,f=/canvas/i,s=/img|canvas/,v=/input/i,G=/^data:[^,]+,/,x=Math.pow,w={},C=[],h={build:1,KB:1024,MB:x(1024,2),GB:x(1024,3),TB:x(1024,4),expando:"fileapi"+(new Date).getTime(),uid:function(b){return b?b[h.expando]=b[h.expando]||h.uid():h.expando+ ++r},
log:function(){a.console&&console.log&&(console.log.apply?console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},getXHR:function(){var b;if(a.XMLHttpRequest)b=new XMLHttpRequest;else if(a.ActiveXObject)try{b=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(c){}return b},isArray:o,support:{html5:n},event:{on:i,off:g,one:q,fix:function(b){b.target||(b.target=a.event&&a.event.srcElement||u);3===b.target.nodeType&&(b.target=event.target.parentNode);return b}},throttle:function(b,
c){var f,l,h;return function B(){l=arguments;h=!0;f||(h?(b.apply(a,l),h=!1,f=setTimeout(B,c)):f=null)}},F:function(b){return b},parseJSON:function(b){return a.JSON&&JSON.parse?JSON.parse(b):(new Function("return "+b+";"))()},trim:function(b){b=String(b);return b.trim?b.trim():b.replace(/^\s+|\s+$/g,"")},queue:function(b){var c=0,a=0,l=!1,f=!1,h={inc:function(){a++},next:function(){c++;setTimeout(h.check,0)},check:function(){c>=a&&!l&&h.end()},isFail:function(){return l},fail:function(){!l&&b(l=!0)},
end:function(){f||(f=!0,b())}};return h},each:function(b,c,a){if(b)if(b.forEach)b.forEach(c,a);else if(o(b))for(var l=0,f=b.length;l<f;l++)l in b&&c.call(a,b[l],l,b);else for(l in b)b.hasOwnProperty(l)&&c.call(a,b[l],l,b)},extend:function(b){h.each(arguments,function(c){h.each(c,function(c,a){b[a]=c})});return b},isFile:function(b){return n&&b&&b instanceof z},isCanvas:function(b){return b&&f.test(b.nodeName)},getFilesFilter:function(b){return(b="string"==typeof b?b:b.getAttribute&&b.getAttribute("accept")||
"")?RegExp("("+b.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(b,c){h.isFile(b)?e(b,c,"DataURL"):h.isCanvas(b)?d(b,c,"load",h.toDataURL(b)):d(b,c,"error")},readAsBinaryString:function(b,c){h.isFile(b)?e(b,c,"BinaryString"):d(b,c,"error")},toDataURL:function(b){if("string"==typeof b)return b;if(b.toDataURL)return b.toDataURL("image/png")},toBinaryString:function(b){return a.atob(h.toDataURL(b).replace(G,""))},readAsImage:function(b,a,f){if(h.isFile(b))if(j){var l=j.createObjectURL(b);
l===k?d(b,a,"error"):h.readAsImage(l,a,f)}else h.readAsDataURL(b,function(c){"load"==c.type?h.readAsImage(c.result,a,f):(f||"error"==c.type)&&d(b,a,c,null,{loaded:c.loaded,total:c.total})});else h.isCanvas(b)?d(b,a,"load",b):c.test(b.nodeName)?b.complete?d(b,a,"load",b):q(b,"error abort load",function y(c){"load"==c.type&&j&&j.revokeObjectURL(b.src);g(b,"error abort load",y);d(b,a,c,b)}):b.iframe?d(b,a,{type:"error"}):(l=new Image,l.src=b.dataURL||b,h.readAsImage(l,a,f))},checkFileObj:function(b){var c=
{};"object"==typeof b?c=b:c.name=(b+"").split(/(\\|\/)/g).pop();c.type===k&&(c.type=c.name.split(".").pop());h.each(m,function(b,a){if(b.test(c.type))c.type=a+"/"+c.type});return c},getFiles:function(b,c,a){var f=[];if(a)return h.filterFiles(h.getFiles(b),c,a),null;b.jquery&&(b.each(function(){f=f.concat(h.getFiles(this))}),b=f,f=[]);"string"==typeof c&&(c=h.getFilesFilter(c));b.originalEvent&&(b=b.originalEvent);b.dataTransfer?b=b.dataTransfer:b.target&&(b=b.target);b.files?f=b.files:!n&&v.test(b&&
b.tagName)?h.trim(b.value)&&(f=[h.checkFileObj(b.value)],f[0].blob=b,f[0].iframe=!0):o(b)&&(f=b);!c&&v.test(b&&b.tagName)&&(c=h.getFilesFilter(b));return h.filter(f,function(b){return!c||c.test(b.name)})},getInfo:function(b,c){var a={},f=C.concat();h.isFile(b)?function y(){var d=f.shift();d?d.test(b.type)?d(b,function(b,f){b?c(b):(h.extend(a,f),y())}):y():c(!1,a)}():c("not_support",a)},addInfoReader:function(b,c){c.test=function(c){return b.test(c)};C.push(c)},addMime:function(b,c){m[b]=RegExp("("+
c.replace(/,/g,"|")+")$","i")},filter:function(b,c){for(var a=[],f=0,h=b.length,d;f<h;f++)f in b&&(d=b[f],c.call(d,d,f,b)&&a.push(d));return a},filterFiles:function(b,c,a){if(b&&(n||b[0].id)){var f=b.concat(),d,e=[],j=[];(function F(){f.length?(d=f.shift(),h.getInfo(d,function(b,a){(c(d,b?!1:a)?e:j).push(d);F()})):a(e,j)})()}else a(b,[])},upload:function(b){var b=h.extend({beforeupload:h.F,upload:h.F,fileupload:h.F,fileprogress:h.F,filecomplete:h.F,progress:h.F,complete:h.F},b),c=new h.XHR(b),a=this._getFilesDataArray(b.files),
f=0,d=0,e=0;h.each(a,function(b){f+=b.size});b.total=f;b.loaded=d;b.beforeupload(c,b);(function E(){var j=a.shift(),r=this;"abort"!=c.statusText&&j?this._getFormData(b,j,function(a){d||b.upload(c,b);var s=new h.XHR(h.extend({},b,{upload:function(){b.fileupload(s,b)},progress:function(c){c.lengthComputable&&(e=d+=~~(f*j.part*(c.loaded/c.total)-e+0.5),b.fileprogress(c,s),b.progress({type:c.type,total:f,loaded:b.loaded=d,lengthComputable:!0}))},complete:function(a){h.extend(c,s);b.loaded=d+=d-e+~~(f*
j.part+0.5);b.filecomplete(a,s);E.call(r)}}));j.part=j.size/f;s.send(a);c.abort=function(){s.abort()}}):b.complete(200==c.status?!1:c.statusText||"error",c)}).call(this);return c},_getFilesDataArray:function(b){var c=[],a={};if(v.test(b&&b.tagName)){var f=h.getFiles(b);a[b.name||"file"]=null!==b.getAttribute("multiple")?f:f[0]}else o(b)&&v.test(b[0]&&b[0].tagName)?h.each(b,function(b){a[b.name||"file"]=h.getFiles(b)}):a=b;h.each(a,function y(b,a){o(b)?h.each(b,function(b,c){y(b,a+"["+c+"]")}):b&&
b.name&&c.push({name:a,file:b,size:b.size})});return c},_getFormData:function(b,c,a){var f=c.file,d=c.name,j=f.name,e=f.type,r=(c=h.support.transform&&b.imageTransform)&&"number"==typeof(c.maxWidth||c.minWidth||c.width),g=new h.Form,t=h.queue(function(){a(g)});c&&(/image/.test(f.type)||s.test(f.nodeType))?(t.inc(),r&&(c=[c]),h.Image.transform(f,c,function(c,a){r&&!c?(!p&&!h.flashEngine&&(a[0]=h.toBinaryString(a[0]),g.multipart=!0),g.append(d,a[0],j,e)):(c||(h.each(a,function(b,c){!p&&!h.flashEngine&&
(b=h.toBinaryString(b),g.multipart=!0);g.append(d+"["+c+"]",b,j,e)}),d+="[original]"),(c||b.imageOriginal)&&g.append(d,f,j,e));t.next()})):g.append(d,f,j);h.each(b.data,function H(b,c){typeof b=="object"?h.each(b,function(b,a){H(b,c+"["+a+"]")}):g.append(c,b)});t.check()},reset:function(b){var c,f;a.jQuery?(f=jQuery(b).clone(!0).insertBefore(b).val("")[0],jQuery(b).remove()):(c=b.parentNode,f=c.insertBefore(b.cloneNode(!0),b),f.value="",c.removeChild(b));h.each(w[h.uid(b)],function(c,a){h.each(c,
function(c){g(b,a,c);i(f,a,c)})});return f},load:function(b,c){var a=h.getXHR();a?(a.open("GET",b,!0),a.overrideMimeType&&a.overrideMimeType("text/plain; charset=x-user-defined"),i(a,"progress",function(b){b.lengthComputable&&c({type:b.type,loaded:b.loaded,total:b.total},a)}),a.onreadystatechange=function(){if(4==a.readyState)if(a.onreadystatechange=null,200==a.status){b=b.split("/");var f={name:b[b.length-1],size:a.getResponseHeader("Content-Length"),type:a.getResponseHeader("Content-Type")};f.dataURL=
"data:"+f.type+";base64,"+h.encode64(a.responseBody||a.responseText);c({type:"load",result:f})}else c({type:"error"})},a.send(null)):c({type:"error"});return a},encode64:function(b){var c="",a=0;for("string"!==typeof b&&(b=String(b));a<b.length;){var f=b.charCodeAt(a++)&255,d=b.charCodeAt(a++)&255,j=b.charCodeAt(a++)&255,h=f>>2,f=(f&3)<<4|d>>4;isNaN(d)?d=j=64:(d=(d&15)<<2|j>>6,j=isNaN(j)?64:j&63);c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(j)}return c}};h.each({image:"png,jpg,jpeg,bmp,gif,ico,tif,tiff,tga,pcx,cbz,cbr",audio:"m4a,flac,aac,rm,mpa,wav,wma,ogg,mp3,mp2,m3u,mod,amf,dmf,dsm,far,gdm,imf,it,m15,med,okt,s3m,stm,sfx,ult,uni,xm,sid,ac3,dts,cue,aif,aiff,wpl,ape,mac,mpc,mpp,shn,wv,nsf,spc,gym,adplug,adx,dsp,adp,ymf,ast,afc,hps,xsp",video:"m4v,3gp,nsv,ts,ty,strm,rm,rmvb,m3u,ifo,mov,qt,divx,xvid,bivx,vob,nrg,img,iso,pva,wmv,asf,asx,ogm,m2v,avi,bin,dat,dvr-ms,mpg,mpeg,mp4,mkv,avc,vp3,svq3,nuv,viv,dv,fli,flv,wpl"},
function(b,c){h.addMime(c,b)});h.addInfoReader(/^image/,function(b,c){h.readAsImage(b,function(b){var a=b.target;c("load"==b.type?!1:"error",{width:a.width,height:a.height})})});a.FileAPI=h})(this);
(function(a,k,i){function g(a,d){if(!(this instanceof g))return new g(a);this.data=a;this.better=!d;this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0}}var q=Math.min,d=Math.round,e=!1;try{e=-1<k.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")}catch(o){}g.prototype={constructor:g,set:function(d){a.extend(this.matrix,d);return this},crop:function(a,d,e,g){e===i&&(e=a,g=d,a=d=0);return this.set({sx:a,sy:d,sw:e,sh:g||e})},resize:function(a,d,e){"string"==typeof d&&
(e=d,d=a);return this.set({dw:a,dh:d,resize:e})},preview:function(a,d){return this.set({dw:a,dh:d||a,resize:"preview"})},rotate:function(a){return this.set({deg:a})},_load:function(d,e){var g=this;a.readAsImage(d,function(a){e.call(g,"load"!=a.type,a.result)})},_apply:function(a,d){var e=k.createElement("canvas"),g=this.getMatrix(a),q=e.getContext("2d"),n=g.deg,o=g.dw,p=g.dh,m=a.width,c=a.height,f,s=a;if(this.better)for(;2<Math.min(m/o,c/p);)m=~~(m/2+0.5),c=~~(c/2+0.5),f=k.createElement("canvas"),
f.width=m,f.height=c,s!==a?(f.getContext("2d").drawImage(s,0,0,s.width,s.height,0,0,m,c),s=f):(s=f,s.getContext("2d").drawImage(a,g.sx,g.sy,g.sw,g.sh,0,0,m,c),g.sx=g.sy=g.sw=g.sh=0);e.width=!(n%180)?o:p;e.height=n%180?o:p;q.rotate(n*Math.PI/180);q.drawImage(s,g.sx,g.sy,g.sw||s.width,g.sh||s.height,180==n||270==n?-o:0,90==n||180==n?-p:0,o,p);d.call(this,!1,e)},getMatrix:function(e){var j=a.extend({},this.matrix),g=j.sw=j.sw||e.width,e=j.sh=j.sh||e.height,o=j.dw=j.dw||j.sw,k=j.dh=j.dh||j.sh,n=g/e,i=
o/k,p=j.resize;if("preview"==p){if(o!=g||k!=e)if(i>=n?(n=g,p=n/i):(p=e,n=p*i),n!=g||p!=e)j.sx=~~((g-n)/2),j.sy=~~((e-p)/2),g=n,e=p}else p&&("min"==p?(o=d(n<i?q(g,o):k*n),k=d(n<i?o/n:q(e,k))):(o=d(n>=i?q(g,o):k*n),k=d(n>=i?o/n:q(e,k))));j.sw=g;j.sh=e;j.dw=o;j.dh=k;return j},get:function(d){a.support.transform?this._load(this.data,function(a,e){a?d(a):this._apply(e,d)}):d("not_support")},toData:function(a){this.get(a)}};g.transform=function(d,e,o){a.getInfo(d,function(k,i){var q={},u=a.queue(function(a){o(a,
q)});k?u.fail():a.each(e,function(a,e){if(!u.isFail()){var c=g(i.nodeType?i:d);if("function"==typeof a)a(i,c);else if(a.width)c[a.preview?"preview":"resize"](a.width,a.height,a.type);else a.maxWidth&&(i.width>a.maxWidth||i.height>a.maxHeight)&&c.resize(a.maxWidth,a.maxHeight,"max"),c.rotate(~~a.rotate);u.inc();c.toData(function(c,a){c?u.fail():(q[e]=a,u.next())})}})})};a.support.canvas=a.support.transform=e;a.Image=g})(FileAPI,document);
(function(a,k,i){var g=k.encodeURIComponent,q=k.FormData,k=function(){this.items=[]};k.prototype={append:function(a,e,g,i){this.items.push({name:a,blob:e&&e.blob||e,file:g||e.name,type:i||e.type})},each:function(a){for(var e=0,g=this.items.length;e<g;e++)a.call(this,this.items[e])},toData:function(d){a.support.html5?this.multipart?(a.log("FileAPI.Form.toMultipartData"),this.toMultipartData(d)):(a.log("FileAPI.Form.toFormData"),this.toFormData(d)):(a.log("tFileAPI.Form.toHtmlData"),this.toHtmlData(d))},
_to:function(d,e,g,i){var j=a.queue(function(){e(d)});this.each(function(a){g(a,d,j,i)});j.check()},toHtmlData:function(d){this._to(i.createDocumentFragment(),d,function(d,g){var k=d.blob,j;d.file?(a.reset(k),g.appendChild(k)):(j=i.createElement("input"),j.type="hidden",j.value=k,g.appendChild(j))})},toFormData:function(a){this._to(new q,a,function(a,d,g){a.file&&d.append("_"+a.name,a.file);a.blob.toBlob?(g.inc(),a.blob.toBlob(function(j){d.append(a.name,j,a.file);g.next()},"image/png")):a.file?d.append(a.name,
a.blob,a.file):d.append(a.name,a.blob)})},toMultipartData:function(d){this._to([],d,function(a,d,i,j){d.push("--_"+j+('\r\nContent-Disposition: form-data; name="'+a.name+'"'+(a.file?'; filename="'+g(a.file)+'"':"")+(a.file?"\r\nContent-Type: "+(a.type||"application/octet-stream"):"")+"\r\n\r\n"+(a.file?a.blob:g(a.blob))+"\r\n"))},a.expando)}};a.Form=k})(FileAPI,this,document);
(function(a){var k=function(){},i=function(g){this.uid=a.uid();this.xhr={abort:k,getResponseHeader:k,getAllResponseHeaders:k};this.options=g};i.prototype={status:0,statusText:"",getResponseHeader:function(a){return this.xhr.getResponseHeader(a)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(a,i){var d=this,e=d.options;d.abort=k;d.status=a;i&&(d.statusText=i);e.complete(200==a?!1:d.statusText||"unknown",d);d.xhr&&d.xhr.node&&setTimeout(function(){try{d.xhr.node.parentNode.removeChild(d.xhr.node)}catch(a){}d.xhr.node=
null;delete window[d.uid]},1)},abort:function(){this.end(0,"abort");this.xhr&&this.xhr.abort()},send:function(a){var i=this,d=this.options;a.toData(function(a){d.upload(d,i);i._send.call(i,d,a)})},_send:function(g,i){var d=this,e,k=d.uid;a.log("XHR._send:",i);if(i.nodeName){g.upload(g,d);e=document.createElement("div");e.innerHTML='<form target="'+k+'" action="'+g.url+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+
k+'" src="javascript:false;"></iframe><input value="'+k+'" name="callback" type="hidden"/></form>';d.xhr.abort=function(){var a=e.getElementsByName("iframe")[0];if(a)try{a.stop?a.stop():a.contentWindow.stop?a.contentWindow.stop():a.contentWindow.document.execCommand("Stop")}catch(d){}};var r=e.getElementsByTagName("form")[0];r.appendChild(i);document.body.appendChild(e);this.xhr.node=e;window[k]=function(a,e,g){d.readyState=4;d.responseText=g;d.end(a,e)};d.readyState=2;r.submit();r=null}else{e=d.xhr=
a.getXHR();e.open("POST",g.url,!0);e.withCredential="true";(!g.headers||!g.headers["X-Requested-With"])&&e.setRequestHeader("X-Requested-With","XMLHttpRequest");a.each(g.headers,function(a,d){e.setRequestHeader(d,a)});if(e.upload)a.event.on(e.upload,"progress",a.throttle(function(a){g.progress(a,g,d)},100));e.onreadystatechange=function(){d.status=e.status;d.statusText=e.statusText;d.readyState=e.readyState;if(4==e.readyState){for(var a in{"":1,XML:1,Text:1,Body:1})d["response"+a]=e["response"+a];
e.onreadystatechange=null;d.end(e.status)}};a.isArray(i)?(e.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+a.expando),i=i.join("")+"--_"+a.expando+"--",e.sendAsBinary?e.sendAsBinary(i):(k=Array.prototype.map.call(i,function(a){return a.charCodeAt(0)&255}),e.send((new Uint8Array(k)).buffer))):e.send(i)}}};a.XHR=i})(FileAPI);
(function(a,k,i){var g=a.support,q=k.navigator,d=q.mimeTypes,e=!1;if(q.plugins&&"object"==typeof q.plugins["Shockwave Flash"])e=q.plugins["Shockwave Flash"].description&&!(d&&d["application/x-shockwave-flash"]&&!d["application/x-shockwave-flash"].enabledPlugin);else try{e=!(!k.ActiveXObject||!new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(o){}g.flash=e;if(!a.support.html5&&a.support.flash){var r=function(a,f){if(a&&a.style){var d,e;for(d in f){e=f[d];"number"==typeof e&&(e+="px");try{a.style[d]=
e}catch(g){}}}},j=function(c,f){a.each(f,function(a,f){var d=c[f];c[f]=function(){this.parent=d;return a.apply(this,arguments)}})},z=function(c){var f=c.wid=a.uid();m._fn[f]=c;return"FileAPI.Flash._fn."+f},t=function(a){delete m._fn[a.wid]},x=function(a){var f=i.createElement("a");f.href=a;return f.href},n=a.expando,u=0,p={},m={_fn:{},init:function(){var c=i.body&&i.body.firstChild;if(c){do if(1==c.nodeType){a.log("FlashAPI.Flash.inited");var f=i.createElement("div");r(f,{top:1,left:1,width:5,height:5,
position:"absolute"});c.parentNode.insertBefore(f,c);m.pingUrl=m.pingUrl||location.protocol+"//"+location.host;m.publish(f,a.expando);return}while(c=c.nextSibling)}10>u&&setTimeout(m.init,50*++u)},publish:function(c,f){var d={id:f,src:"./FileAPI.flash.swf?r="+a.build,flashVars:"callback=FileAPI.Flash.event&flashId="+f+"&storeKey="+navigator.userAgent.match(/\d/ig).join("")+"_"+a.build+(m.isReady||!m.pingUrl?"":"&ping="+m.pingUrl)};c.innerHTML='<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="movie" value="#src#" /><param name="flashvars" value="#flashVars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="wmode" value="transparent" /><param name="menu" value="false" /><embed flashvars="#flashVars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#"  width="100%" height="100%" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>'.replace(/#(\w+)#/ig,
function(a,c){return d[c]})},ready:function(){m.ready=a.F;m.isReady=!0;m.patch();a.event.on(i,"mouseover",m.mouseover);a.event.on(i,"click",function(a){m.mouseover(a)&&(a.preventDefault?a.preventDefault():a.returnValue=!0)})},mouseover:function(c){c=a.event.fix(c).target;if(/input/i.test(c.nodeName)&&"file"==c.type){if("y"!=c.getAttribute(n)){c.setAttribute(n,"y");var f=c.offsetTop,d=c.offsetLeft,e=i.createElement("div");k.getComputedStyle&&(d=getComputedStyle(c,null),f=parseInt(d.top,10)+parseInt(d.marginTop,
10),d=parseInt(d.left,10)+parseInt(d.marginLeft,10));r(e,{top:f,left:d,width:c.offsetWidth,height:c.offsetHeight,position:"absolute"});c.parentNode.appendChild(e);m.publish(e,a.uid())}return!0}},event:function(c){var d=c.type;if("ready"==d)return a.log("Flash.event."+c.type+":",c),m.ready(),setTimeout(function(){m.mouseenter(c)},50),!0;"ping"===d?a.log("(flash -> js).ping:",[c.status,c.savedStatus],c.error):"log"===d?a.log("(flash -> js).log:",c.target):d in m&&setTimeout(function(){a.log("Flash.event."+
c.type+":",c);m[d](c)},1)},mouseenter:function(a){var d=m.getInput(a.flashId);d&&(m.cmd(a,"multiple",null!==d.getAttribute("multiple")),m.cmd(a,"accept",(d.getAttribute("accept")||"*").replace(/\./g,"")))},get:function(a){return i[a]||k[a]||i.embeds[a]},getInput:function(a){a=m.get(a);/embed/i.test(a.nodeName)&&(a=a.parentNode);return a.parentNode.parentNode.getElementsByTagName("input")[0]},select:function(c){var d=m.getInput(c.flashId),e=a.uid(d),c=c.target.files;a.each(c,function(c){a.checkFileObj(c)});
p[e]=c;i.createEvent?(e=i.createEvent("Event"),e.initEvent("change",!0,!1),d.dispatchEvent(e)):i.createEventObject&&(e=i.createEventObject(),d.fireEvent("onchange",e))},cmd:function(c,d,e,g){try{return a.log("(js -> flash)."+d+":",e),m.get(c.flashId||c).cmd(d,e)}catch(i){a.log("(js -> flash).onError:",i),g||setTimeout(function(){m.cmd(c,d,e,!0)},50)}},patch:function(){a.flashEngine=a.support.transform=!0;j(a,{getFiles:function(c,d,e){if(e)return a.filterFiles(a.getFiles(c),d,e),null;var g=a.isArray(c)?
c:p[a.uid(c.target||c.srcElement||c)];if(!g)return this.parent.apply(this,arguments);d&&(d=a.getFilesFilter(d),g=a.filter(g,function(a){return d.test(a.name)}));return g},getInfo:function(a,d){a&&!a.flashId?this.parent.apply(this,arguments):a.info?d(!1,a.info):m.cmd(a,"getFileInfo",{id:a.id,callback:z(function v(e,g){t(v);d(e,a.info=g)})})}});a.support.transform=!0;j(FileAPI.Image.prototype,{_load:function(c,d){if(c&&!c.flashId)this.parent.apply(this,arguments);else{a.log("_load:",c);var e=this;a.getInfo(c,
function(a){d.call(e,a,c)})}},_apply:function(c,d){c&&!c.flashId?this.parent.apply(this,arguments):(a.log("_apply:",c),m.cmd(c,"imageTransform",{id:c.id,matrix:this.getMatrix(c.info),callback:z(function v(a,e){t(v);if(a)d(a);else{var g=new Image;g.src="data:"+c.type+";base64,"+e;d(!1,g)}})}))},toData:function(a){var d=this.data;d&&!d.flashId?this.parent.apply(this,arguments):a.call(this,!d.info,{id:d.id,name:d.name,type:d.type,flashId:d.flashId,matrix:this.getMatrix(d.info)})}});j(a.Form.prototype,
{toData:function(c){for(var d=this.items,e=d.length;e--;)if(d[e].file&&d[e].blob&&!d[e].blob.flashId)return this.parent.apply(this,arguments);a.log("flash.Form.toData");c(d)}});j(a.XHR.prototype,{_send:function(c,d){if(d.nodeName||d.append&&a.support.html5||a.isArray(d)&&"string"===typeof d[0])return this.parent.apply(this,arguments);var e={},g={},i=this,j,k;a.each(d,function(a){a.file?(g[a.name]=a=a.blob,k=a.id,j=a.flashId):e[a.name]=a.blob});a.log("flash.XHR._send:",j,k,g);this.xhr={headers:{},
abort:function(){m.cmd(j,"abort",k)},getResponseHeader:function(a){return this.headers[a]},getAllResponseHeaders:function(){return this.headers}};m.cmd(j,"upload",{url:x(c.url),data:e,files:g,headers:c.headers,callback:z(function b(d){var e=d.type,f=d.result;a.log("flash.upload."+e+":",d);if("progress"==e)d.lengthComputable=!0,c.progress(d);else if("complete"==e)t(b),"string"==typeof f&&(i.responseText=f.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")),i.end(d.status);
else if("abort"==e||"error"==e)this.end(0,d.message),t(b)})})}})}};a.Flash=m;m.init()}})(FileAPI,this,document);window.ajs&&ajs.loaded&&ajs.loaded("{FileAPI}FileAPI.min");"function"===typeof define&&define.amd&&define("FileAPI",[],function(){return window.FileAPI||{}});