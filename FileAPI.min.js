/**!
 * FileAPI â€” a set of tools for working with files
 *
 * @author  RubaXa  <trash@rubaxa.org>
 * @build	lib/canvas-to-blob lib/FileAPI.core lib/FileAPI.Image lib/FileAPI.Form lib/FileAPI.XHR lib/FileAPI.Flash
 */
(function(a){var k=a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype,h;if(h=a.Blob)try{h=Boolean(new Blob)}catch(l){h=!1}var n=h;if(h=n)if(h=a.Uint8Array)try{h=100===(new Blob([new Uint8Array(100)])).size}catch(g){h=!1}var c=h,d=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder,f=(n||d)&&a.atob&&a.ArrayBuffer&&a.Uint8Array&&function(a){var f,h,g,q;f=0<=a.split(",")[0].indexOf("base64")?atob(a.split(",")[1]):decodeURIComponent(a.split(",")[1]);h=new ArrayBuffer(f.length);g=new Uint8Array(h);
for(q=0;q<f.length;q+=1)g[q]=f.charCodeAt(q);a=a.split(",")[0].split(":")[1].split(";")[0];if(n)return new Blob([c?g:h],{type:a});g=new d;g.append(h);return g.getBlob(a)};a.HTMLCanvasElement&&!k.toBlob&&(k.mozGetAsFile?k.toBlob=function(a,c){a(this.mozGetAsFile("blob",c))}:k.toDataURL&&f&&(k.toBlob=function(a,c){a(f(this.toDataURL(c)))}));"function"===typeof define&&define.amd?define(function(){return f}):a.dataURLtoBlob=f})(this);
(function(a,k){function h(b,m,e){if(b)if(t(b))for(var a=0,c=b.length;a<c;a++)a in b&&m.call(e,b[a],a,b);else for(a in b)b.hasOwnProperty(a)&&m.call(e,b[a],a,b)}function l(b,m,a){if(b){var e=i.uid(b);z[e]||(z[e]={});h(m.split(/\s+/),function(m){w?w.event.add(b,m,a):(z[e][m]||(z[e][m]=[]),z[e][m].push(a),b.addEventListener?b.addEventListener(m,a,!1):b.attachEvent?b.attachEvent("on"+m,a):b["on"+m]=a)})}}function n(b,m,a){if(b){var e=i.uid(b),c=z[e]||{};h(m.split(/\s+/),function(m){if(w)w.event.remove(b,
m,a);else{for(var e=c[m]||[],D=e.length;D--;)if(e[D]===a){e.splice(D,1);break}b.addEventListener?b.removeEventListener(m,a,!1):b.detachEvent?b.detachEvent("on"+m,a):b["on"+m]=null}})}}function g(b,m,a){l(b,m,function K(e){n(b,m,K);a(e)})}function c(b,m,a,e,c){b={type:a.type||a,target:b,result:e};i.extend(b,c);m(b)}function d(b,m,a,e){if(r){var f=new r;l(f,E,function M(a){var e=a.type;"progress"==e?c(b,m,a,a.target.result,{loaded:a.loaded,total:a.total}):"loadend"==e?(n(f,E,M),f=null):c(b,m,a,a.target.result)});
try{if(e)f["readAs"+a](e,b);else f["readAs"+a](b)}catch(p){c(b,m,"error",k,{error:p.toString()})}}else c(b,m,"error",k,{error:"filreader_not_support"})}function f(b,m){if(b)if(b.isFile)b.file(function(b){m(!1,[b])},function(){m("entry_file")});else if(b.isDirectory){var a=[];b.createReader().readEntries(function(b){i.afor(b,function(b,e){f(e,function(e,c){e||(a=a.concat(c));b?b():m(!1,a)})})},function(){m("directory_reader")})}else{var e=f,c;b.getAsEntry?c=b.getAsEntry():b.webkitGetAsEntry&&(c=b.webkitGetAsEntry());
e(c,m)}else m("empty_entry")}function t(b){return"object"==typeof b&&b&&"length"in b}function v(b){b.target||(b.target=a.event&&a.event.srcElement||u);3===b.target.nodeType&&(b.target=event.target.parentNode);return b}var B=1,y=a.createObjectURL&&a||a.URL&&URL.revokeObjectURL&&URL||a.webkitURL&&webkitURL,q=a.File,r=a.FileReader,s=a.FormData,w=a.jQuery,x=(s=!(!q||!(r&&a.Uint8Array||s)))&&"withCredentials"in new XMLHttpRequest,j=s&&x,u=a.document,e=a.dataURLtoBlob,p={},N=/img/i,G=/canvas/i,H=/img|canvas/,
C=/input/i,O=/^data:[^,]+,/,I=Math.pow,z={},J=[],E="abort progress error load loadend",P="status statusText readyState response responseXML responseText responseBody".split(" "),i={build:2,debug:!1,staticPath:"./",KB:1024,MB:I(1024,2),GB:I(1024,3),TB:I(1024,4),expando:"fileapi"+ +new Date,uid:function(b){return b?b[i.expando]=b[i.expando]||i.uid():i.expando+ ++B},log:function(){i.debug&&(a.console&&console.log)&&(console.log.apply?console.log.apply(console,arguments):console.log([].join.call(arguments,
" ")))},getXHR:function(){var b;if(a.XMLHttpRequest)b=new XMLHttpRequest;else if(a.ActiveXObject)try{b=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(m){}return b},isArray:t,support:{dnd:x&&"ondrop"in u.createElement("div"),cors:x,html5:s,dataURI:!0},event:{on:l,off:n,one:g,fix:v},throttle:function(b,m){var e,c,f;return function L(){c=arguments;f=!0;e||(f?(b.apply(a,c),f=!1,e=setTimeout(L,m)):e=null)}},F:function(){},parseJSON:function(b){return a.JSON&&JSON.parse?JSON.parse(b):(new Function("return ("+
b.replace(/([\r\n])/g,"\\$1")+");"))()},trim:function(b){b=String(b);return b.trim?b.trim():b.replace(/^\s+|\s+$/g,"")},queue:function(b){var a=0,e=0,c=!1,f=!1,p={inc:function(){e++},next:function(){a++;setTimeout(p.check,0)},check:function(){a>=e&&!c&&p.end()},isFail:function(){return c},fail:function(){!c&&b(c=!0)},end:function(){f||(f=!0,b())}};return p},each:h,afor:function(b,a){var e=0,c=b.length;t(b)&&c--?function A(){a(c!=e&&A,b[e],e++)}():a(!1)},extend:function(b){h(arguments,function(a){h(a,
function(a,e){b[e]=a})});return b},isFile:function(b){return j&&b&&b instanceof q},isCanvas:function(b){return b&&G.test(b.nodeName)},getFilesFilter:function(b){return(b="string"==typeof b?b:b.getAttribute&&b.getAttribute("accept")||"")?RegExp("("+b.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(b,a){i.isFile(b)?d(b,a,"DataURL"):i.isCanvas(b)?c(b,a,"load",i.toDataURL(b)):c(b,a,"error")},readAsBinaryString:function(b,a){i.isFile(b)?d(b,a,"BinaryString"):c(b,a,"error")},
readAsArrayBuffer:function(b,a){i.isFile(b)?d(b,a,"ArrayBuffer"):c(b,a,"error")},readAsText:function(b,a,e){e||(e=a,a="utf-8");i.isFile(b)?d(b,e,"Text",a):c(b,e,"error")},toDataURL:function(b){if("string"==typeof b)return b;if(b.toDataURL)return b.toDataURL("image/png")},toBinaryString:function(b){return a.atob(i.toDataURL(b).replace(O,""))},readAsImage:function(b,a,e){if(i.isFile(b))if(y){var f=y.createObjectURL(b);f===k?c(b,a,"error"):i.readAsImage(f,a,e)}else i.readAsDataURL(b,function(f){"load"==
f.type?i.readAsImage(f.result,a,e):(e||"error"==f.type)&&c(b,a,f,null,{loaded:f.loaded,total:f.total})});else i.isCanvas(b)?c(b,a,"load",b):N.test(b.nodeName)?b.complete?c(b,a,"load",b):g(b,"error abort load",function A(e){"load"==e.type&&y&&y.revokeObjectURL(b.src);n(b,"error abort load",A);c(b,a,e,b)}):b.iframe?c(b,a,{type:"error"}):(f=new Image,f.src=b.dataURL||b,i.readAsImage(f,a,e))},checkFileObj:function(b){var a={};"object"==typeof b?a=b:a.name=(b+"").split(/(\\|\/)/g).pop();a.type===k&&(a.type=
a.name.split(".").pop());h(p,function(b,e){b.test(a.type)&&(a.type=e+"/"+a.type)});return a},getDropFiles:function(b,a){var e=[],c=(b.originalEvent||b||"").dataTransfer||{},p=t(c.items),d=i.queue(function(){a(e)});h((p?c.items:c.files)||[],function(b){d.inc();if(p)f(b,function(b,a){!b&&e.push.apply(e,a);d.next()});else{var a=function(a){a&&e.push(b);d.next()};if(!b.type&&0==b.size%4096&&102400>=b.size)if(r)try{var c=new r;g(c,E,function(b){b="error"!=b.type;a(b);b&&c.abort()});c.readAsBinaryString(b)}catch(m){a(!1)}else a(null);
else a(!0)}});d.check()},getFiles:function(b,a,e){var c=[];if(e)return i.filterFiles(i.getFiles(b),a,e),null;b.jquery&&(b.each(function(){c=c.concat(i.getFiles(this))}),b=c,c=[]);"string"==typeof a&&(a=i.getFilesFilter(a));b.originalEvent&&(b=v(b.originalEvent));b.dataTransfer?b=b.dataTransfer:b.target&&(b=b.target);b.files?c=b.files:!j&&C.test(b&&b.tagName)?i.trim(b.value)&&(c=[i.checkFileObj(b.value)],c[0].blob=b,c[0].iframe=!0):t(b)&&(c=b);!a&&C.test(b&&b.tagName)&&(a=i.getFilesFilter(b));return i.filter(c,
function(b){return!a||a.test(b.name)})},getInfo:function(b,a){var e={},c=J.concat();i.isFile(b)?function A(){var f=c.shift();f?f.test(b.type)?f(b,function(b,c){b?a(b):(i.extend(e,c),A())}):A():a(!1,e)}():a("not_support",e)},addInfoReader:function(b,a){a.test=function(a){return b.test(a)};J.push(a)},addMime:function(b,a){p[b]=RegExp("("+a.replace(/,/g,"|")+")$","i")},filter:function(b,a){for(var e=[],c=0,f=b.length,p;c<f;c++)c in b&&(p=b[c],a.call(p,p,c,b)&&e.push(p));return e},filterFiles:function(b,
a,e){if(b.length){var c=b.concat(),f,p=[],t=[];(function F(){c.length?(f=c.shift(),i.getInfo(f,function(b,e){(a(f,b?!1:e)?p:t).push(f);F()})):e(p,t)})()}else e([],b)},upload:function(b){var b=i.extend({beforeupload:i.F,upload:i.F,fileupload:i.F,fileprogress:i.F,filecomplete:i.F,progress:i.F,complete:i.F},b),a=new i.XHR(b),e=this._getFilesDataArray(b.files),c=0,f=0,p=0,t=1;h(e,function(b){c+=b.size});a.total=c;a.loaded=0;b.beforeupload(a,b);(function F(){var d=e.shift(),v=this;a.currentFile=d;"abort"!=
a.statusText&&d?this._getFormData(b,d,function(e){f||b.upload(a,b);var g=d.file,j=new i.XHR(i.extend({},b,{upload:function(){b.fileupload(g,j,b)},progress:function(e){e.lengthComputable&&(p=f+=~~(c*t*(e.loaded/e.total)-p+0.5),b.fileprogress(e,g,j,b),b.progress({type:e.type,total:c,loaded:a.loaded=f,lengthComputable:!0},g,j,b))},complete:function(e){h(P,function(b){a[b]=j[b]});a.loaded=f+=f-p+~~(c*t+0.5);b.filecomplete(e,j,g,b);F.call(v)}}));t=d.size/c;a.abort=function(){j.abort()};j.send(e)}):b.complete(200==
a.status?!1:a.statusText||"error",a,b)}).call(this);return a},_getFilesDataArray:function(b){var a=[],e={};if(C.test(b&&b.tagName)){var c=i.getFiles(b);e[b.name||"file"]=null!==b.getAttribute("multiple")?c:c[0]}else t(b)&&C.test(b[0]&&b[0].tagName)?h(b,function(b){e[b.name||"file"]=i.getFiles(b)}):e=b;h(e,function A(b,e){t(b)?h(b,function(b,a){A(b,e+"["+a+"]")}):b&&b.name&&a.push({name:e,file:b,size:b.size})});return a},_getFormData:function(b,a,c){var f=a.file,p=a.name,t=f.name,d=f.type,g=(a=i.support.transform&&
b.imageTransform)&&"number"==typeof(a.maxWidth||a.minWidth||a.width),v=new i.Form,j=i.queue(function(){c(v)});a&&(/image/.test(f.type)||H.test(f.nodeType))?(j.inc(),g&&(a=[a]),i.Image.transform(f,a,function(a,c){g&&!a?(!e&&!i.flashEngine&&(c[0]=i.toBinaryString(c[0]),v.multipart=!0),v.append(p,c[0],t,d)):(a||(h(c,function(b,a){!e&&!i.flashEngine&&(b=i.toBinaryString(b),v.multipart=!0);v.append(p+"["+a+"]",b,t,d)}),p+="[original]"),(a||b.imageOriginal)&&v.append(p,f,t,d));j.next()})):v.append(p,f,
t);h(b.data,function Q(b,a){"object"==typeof b?h(b,function(b,e){Q(b,a+"["+e+"]")}):v.append(a,b)});j.check()},reset:function(b){var a,e;w?(e=w(b).clone(!0).insertBefore(b).val("")[0],w(b).remove()):(a=b.parentNode,e=a.insertBefore(b.cloneNode(!0),b),e.value="",a.removeChild(b),h(z[i.uid(b)],function(a,c){h(a,function(a){n(b,c,a);l(e,c,a)})}));return e},load:function(b,a){var e=i.getXHR();e?(e.open("GET",b,!0),e.overrideMimeType&&e.overrideMimeType("text/plain; charset=x-user-defined"),l(e,"progress",
function(b){b.lengthComputable&&a({type:b.type,loaded:b.loaded,total:b.total},e)}),e.onreadystatechange=function(){if(4==e.readyState)if(e.onreadystatechange=null,200==e.status){b=b.split("/");var c={name:b[b.length-1],size:e.getResponseHeader("Content-Length"),type:e.getResponseHeader("Content-Type")};c.dataURL="data:"+c.type+";base64,"+i.encode64(e.responseBody||e.responseText);a({type:"load",result:c})}else a({type:"error"})},e.send(null)):a({type:"error"});return e},encode64:function(b){var a=
"",e=0;for("string"!==typeof b&&(b=String(b));e<b.length;){var c=b.charCodeAt(e++)&255,f=b.charCodeAt(e++)&255,p=b.charCodeAt(e++)&255,t=c>>2,c=(c&3)<<4|f>>4;isNaN(f)?f=p=64:(f=(f&15)<<2|p>>6,p=isNaN(p)?64:p&63);a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(p)}return a}};
h({image:"png,jpg,jpeg,bmp,gif,ico,tif,tiff,tga,pcx,cbz,cbr",audio:"m4a,flac,aac,rm,mpa,wav,wma,ogg,mp3,mp2,m3u,mod,amf,dmf,dsm,far,gdm,imf,it,m15,med,okt,s3m,stm,sfx,ult,uni,xm,sid,ac3,dts,cue,aif,aiff,wpl,ape,mac,mpc,mpp,shn,wv,nsf,spc,gym,adplug,adx,dsp,adp,ymf,ast,afc,hps,xsp",video:"m4v,3gp,nsv,ts,ty,strm,rm,rmvb,m3u,ifo,mov,qt,divx,xvid,bivx,vob,nrg,img,iso,pva,wmv,asf,asx,ogm,m2v,avi,bin,dat,dvr-ms,mpg,mpeg,mp4,mkv,avc,vp3,svq3,nuv,viv,dv,fli,flv,wpl"},function(b,a){i.addMime(a,b)});i.addInfoReader(/^image/,
function(b,a){i.readAsImage(b,function(b){var e=b.target;a("load"==b.type?!1:"error",{width:e.width,height:e.height})})});i.event.dnd=function(b,a,e){var c,f;e||(e=a,a=i.F);r?(l(b,"dragenter dragleave dragover",function(b){for(var e=((b.originalEvent||b||"").dataTransfer||{}).types,p=e&&e.length;p--;)~e[p].indexOf("File")&&(b.preventDefault(),f!==b.type&&(f=b.type,"dragleave"!=f&&a.call(b.currentTarget,!0,b),clearTimeout(c),c=setTimeout(function(){a.call(b.currentTarget,"dragleave"!=f,b)},50)))}),
l(b,"drop",function(b){b.preventDefault();f=0;a.call(b.currentTarget,!1,b);i.getDropFiles(b,function(a){e.call(b.currentTarget,a,b)})})):i.log("Drag'n'Drop -- not supported")};w&&!w.fn.dnd&&(w.fn.dnd=function(b,a){return this.each(function(){i.event.dnd(this,b,a)})});a.FileAPI=i.extend(i,a.FileAPI)})(window);
(function(a,k,h){function l(a,c){if(!(this instanceof l))return new l(a);this.data=a;this.better=!c;this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0}}var n=Math.min,g=Math.round,c=!1;try{c=-1<k.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")}catch(d){}l.prototype={constructor:l,set:function(c){a.extend(this.matrix,c);return this},crop:function(a,c,d,g){d===h&&(d=a,g=c,a=c=0);return this.set({sx:a,sy:c,sw:d,sh:g||d})},resize:function(a,c,d){"string"==typeof c&&
(d=c,c=a);return this.set({dw:a,dh:c,resize:d})},preview:function(a,c){return this.set({dw:a,dh:c||a,resize:"preview"})},rotate:function(a){return this.set({deg:a})},_load:function(c,d){var g=this;a.readAsImage(c,function(a){d.call(g,"load"!=a.type,a.result)})},_apply:function(a,c){var d=k.createElement("canvas"),g=this.getMatrix(a),h=d.getContext("2d"),n=g.deg,r=g.dw,s=g.dh,l=a.width,x=a.height,j,u=a;if(this.better)for(;2<Math.min(l/r,x/s);)l=~~(l/2+0.5),x=~~(x/2+0.5),j=k.createElement("canvas"),
j.width=l,j.height=x,u!==a?(j.getContext("2d").drawImage(u,0,0,u.width,u.height,0,0,l,x),u=j):(u=j,u.getContext("2d").drawImage(a,g.sx,g.sy,g.sw,g.sh,0,0,l,x),g.sx=g.sy=g.sw=g.sh=0);d.width=!(n%180)?r:s;d.height=n%180?r:s;h.rotate(n*Math.PI/180);h.drawImage(u,g.sx,g.sy,g.sw||u.width,g.sh||u.height,180==n||270==n?-r:0,90==n||180==n?-s:0,r,s);c.call(this,!1,d)},getMatrix:function(c){var d=a.extend({},this.matrix),h=d.sw=d.sw||c.width,c=d.sh=d.sh||c.height,k=d.dw=d.dw||d.sw,l=d.dh=d.dh||d.sh,q=h/c,r=
k/l,s=d.resize;if("preview"==s){if(k!=h||l!=c)if(r>=q?(q=h,s=q/r):(s=c,q=s*r),q!=h||s!=c)d.sx=~~((h-q)/2),d.sy=~~((c-s)/2),h=q,c=s}else s&&("min"==s?(k=g(q<r?n(h,k):l*q),l=g(q<r?k/q:n(c,l))):(k=g(q>=r?n(h,k):l*q),l=g(q>=r?k/q:n(c,l))));d.sw=h;d.sh=c;d.dw=k;d.dh=l;return d},get:function(c){a.support.transform?this._load(this.data,function(a,d){a?c(a):this._apply(d,c)}):c("not_support")},toData:function(a){this.get(a)}};l.transform=function(c,d,g){a.getInfo(c,function(h,n){var k={},r=a.queue(function(a){g(a,
k)});h?r.fail():a.each(d,function(a,d){if(!r.isFail()){var g=l(n.nodeType?n:c);if("function"==typeof a)a(n,g);else if(a.width)g[a.preview?"preview":"resize"](a.width,a.height,a.type);else a.maxWidth&&(n.width>a.maxWidth||n.height>a.maxHeight)&&g.resize(a.maxWidth,a.maxHeight,"max"),g.rotate(~~a.rotate);r.inc();g.toData(function(a,c){a?r.fail():(k[d]=c,r.next())})}})})};a.support.canvas=a.support.transform=c;a.Image=l})(FileAPI,document);
(function(a,k,h){var l=k.encodeURIComponent,n=k.FormData,k=function(){this.items=[]};k.prototype={append:function(a,c,d,f){this.items.push({name:a,blob:c&&c.blob||c,file:d||c.name,type:f||c.type})},each:function(a){for(var c=0,d=this.items.length;c<d;c++)a.call(this,this.items[c])},toData:function(g){a.support.html5?this.multipart?(a.log("FileAPI.Form.toMultipartData"),this.toMultipartData(g)):(a.log("FileAPI.Form.toFormData"),this.toFormData(g)):(a.log("tFileAPI.Form.toHtmlData"),this.toHtmlData(g))},
_to:function(g,c,d,f){var h=a.queue(function(){c(g)});this.each(function(a){d(a,g,h,f)});h.check()},toHtmlData:function(g){this._to(h.createDocumentFragment(),g,function(c,d){var f=c.blob,g;c.file?(a.reset(f),f.name=c.name,d.appendChild(f)):(g=h.createElement("input"),g.name=c.name,g.type="hidden",g.value=f,d.appendChild(g))})},toFormData:function(a){this._to(new n,a,function(a,d,f){a.file&&d.append("_"+a.name,a.file);a.blob.toBlob?(f.inc(),a.blob.toBlob(function(g){d.append(a.name,g,a.file);f.next()},
"image/png")):a.file?d.append(a.name,a.blob,a.file):d.append(a.name,a.blob)})},toMultipartData:function(g){this._to([],g,function(a,d,f,g){d.push("--_"+g+('\r\nContent-Disposition: form-data; name="'+a.name+'"'+(a.file?'; filename="'+l(a.file)+'"':"")+(a.file?"\r\nContent-Type: "+(a.type||"application/octet-stream"):"")+"\r\n\r\n"+(a.file?a.blob:l(a.blob))+"\r\n"))},a.expando)}};a.Form=k})(FileAPI,window,document);
(function(a,k){var h=function(){},l=function(a){this.uid=k.uid();this.xhr={abort:h,getResponseHeader:h,getAllResponseHeaders:h};this.options=a};l.prototype={status:0,statusText:"",getResponseHeader:function(a){return this.xhr.getResponseHeader(a)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(n,g){var c=this,d=c.options;c.abort=h;c.status=n;g&&(c.statusText=g);d.complete(200==n?!1:c.statusText||"unknown",c);c.xhr&&c.xhr.node&&setTimeout(function(){var d=
c.xhr.node;try{d.parentNode.removeChild(d)}catch(g){}a[c.uid]=c.xhr.node=null;try{delete a[c.uid]}catch(h){}},1)},abort:function(){this.end(0,"abort");this.xhr&&this.xhr.abort()},send:function(a){var g=this,c=this.options;a.toData(function(a){c.upload(c,g);g._send.call(g,c,a)})},_send:function(h,g){var c=this,d,f=c.uid;k.log("XHR._send:",g);if(g.nodeName){h.upload(h,c);d=document.createElement("div");d.innerHTML='<form target="'+f+'" action="'+h.url+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+
f+'" src="javascript:false;"></iframe><input value="'+f+'" name="callback" type="hidden"/></form>';c.xhr.abort=function(){var a=d.getElementsByName("iframe")[0];if(a)try{a.stop?a.stop():a.contentWindow.stop?a.contentWindow.stop():a.contentWindow.document.execCommand("Stop")}catch(c){}d=null};var l=d.getElementsByTagName("form")[0];l.appendChild(g);k.log(l.parentNode.innerHTML);document.body.appendChild(d);c.xhr.node=d;a[f]=function(a,f,g){c.readyState=4;c.responseText=g;c.end(a,f);d=null};c.readyState=
2;l.submit();l=null}else d=c.xhr=k.getXHR(),d.open("POST",h.url,!0),d.withCredential="true",(!h.headers||!h.headers["X-Requested-With"])&&d.setRequestHeader("X-Requested-With","XMLHttpRequest"),k.each(h.headers,function(a,c){d.setRequestHeader(c,a)}),d.upload&&d.upload.addEventListener("progress",k.throttle(function(a){h.progress(a,c,h)},100),!1),d.onreadystatechange=function(){c.status=d.status;c.statusText=d.statusText;c.readyState=d.readyState;if(4==d.readyState){for(var a in{"":1,XML:1,Text:1,
Body:1})c["response"+a]=d["response"+a];d.onreadystatechange=null;c.end(d.status);d=null}},k.isArray(g)?(d.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+k.expando),g=g.join("")+"--_"+k.expando+"--",d.sendAsBinary?d.sendAsBinary(g):(f=Array.prototype.map.call(g,function(a){return a.charCodeAt(0)&255}),d.send((new Uint8Array(f)).buffer))):d.send(g)}};k.XHR=l})(window,FileAPI);
(function(a,k,h){var l=a.support,n=k.navigator,g=n.mimeTypes,c=!1;if(n.plugins&&"object"==typeof n.plugins["Shockwave Flash"])c=n.plugins["Shockwave Flash"].description&&!(g&&g["application/x-shockwave-flash"]&&!g["application/x-shockwave-flash"].enabledPlugin);else try{c=!(!k.ActiveXObject||!new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(d){}l.flash=c;if(!a.support.cors&&a.support.flash){var f=function(a){return'<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#"  width="100%" height="100%" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>'.replace(/#(\w+)#/ig,
function(c,d){return a[d]})},t=function(a,c){if(a&&a.style){var d,f;for(d in c){f=c[d];"number"==typeof f&&(f+="px");try{a.style[d]=f}catch(g){}}}},v=function(e,c){a.each(c,function(a,c){var d=e[c];e[c]=function(){this.parent=d;return a.apply(this,arguments)}})},B=function(e){var c=e.wid=a.uid();j._fn[c]=e;return"FileAPI.Flash._fn."+c},y=function(a){delete j._fn[a.wid]},q=function(a){if(!x.test(a)){if(/^\.\//.test(a)||"/"!=a.charAt(0))a=location.pathname+"/"+a.substr(RegExp.$1?2:0);"//"!=a.substr(0,
2)&&(a=location.hostname+"/"+a);x.test(a)||(a=location.protocol+"//"+a)}return a},r=a.uid(),s=0,w={},x=/^https?:/i,j={_fn:{},init:function(){var e=h.body&&h.body.firstChild;if(e){do if(1==e.nodeType){a.log("FlashAPI.Flash.inited");var c=h.createElement("div");t(c,{top:1,right:1,width:5,height:5,position:"absolute"});e.parentNode.insertBefore(c,e);j.pingUrl=j.pingUrl||location.protocol+"//"+location.host;j.publish(c,r);return}while(e=e.nextSibling)}10>s&&setTimeout(j.init,50*++s)},publish:function(e,
c){e.innerHTML=f({id:c,src:q(a.staticPath+"FileAPI.flash.swf?r="+a.build),wmode:"transparent",flashvars:"callback=FileAPI.Flash.event&flashId="+c+"&storeKey="+navigator.userAgent.match(/\d/ig).join("")+"_"+a.build+(j.isReady||!j.pingUrl?"":"&ping="+j.pingUrl)})},ready:function(){j.ready=a.F;j.isReady=!0;j.patch();a.event.on(h,"mouseover",j.mouseover);a.event.on(h,"click",function(a){j.mouseover(a)&&(a.preventDefault?a.preventDefault():a.returnValue=!0)})},getWrapper:function(a){do if(/js-fileapi-wrapper/.test(a.className))return a;
while((a=a.parentNode)&&a!==h.body)},mouseover:function(e){e=a.event.fix(e).target;if(/input/i.test(e.nodeName)&&"file"==e.type){var c=e.getAttribute(r);if("i"==c||"r"==c)return!1;if("p"!=c){e.setAttribute(r,"i");var c=h.createElement("div"),d=j.getWrapper(e);if(!d){a.log("flash.mouseover.error: js-fileapi-wrapper not found");return}t(c,{top:0,left:0,width:e.offsetWidth+100,height:e.offsetHeight+100,zIndex:"1000000",position:"absolute"});d.appendChild(c);j.publish(c,a.uid());e.setAttribute(r,"p")}return!0}},
event:function(c){var d=c.type;if("ready"==d){try{j.getInput(c.flashId).setAttribute(r,"r")}catch(f){}j.ready();setTimeout(function(){j.mouseenter(c)},50);return!0}"ping"===d?a.log("(flash -> js).ping:",[c.status,c.savedStatus],c.error):"log"===d?a.log("(flash -> js).log:",c.target):d in j&&setTimeout(function(){a.log("Flash.event."+c.type+":",c);j[d](c)},1)},mouseenter:function(a){var c=j.getInput(a.flashId);c&&(j.cmd(a,"multiple",null!==c.getAttribute("multiple")),j.cmd(a,"accept",(c.getAttribute("accept")||
"*").replace(/\./g,"")))},get:function(a){return h[a]||k[a]||h.embeds[a]},getInput:function(a){try{var c=j.getWrapper(j.get(a));if(c)return c.getElementsByTagName("input")[0]}catch(d){}},select:function(c){var d=j.getInput(c.flashId),f=a.uid(d),c=c.target.files;a.each(c,function(c){a.checkFileObj(c)});w[f]=c;h.createEvent?(f=h.createEvent("Event"),f.initEvent("change",!0,!1),d.dispatchEvent(f)):h.createEventObject&&(f=h.createEventObject(),d.fireEvent("onchange",f))},cmd:function(c,d,f,g){try{return a.log("(js -> flash)."+
d+":",f),j.get(c.flashId||c).cmd(d,f)}catch(h){a.log("(js -> flash).onError:",h),g||setTimeout(function(){j.cmd(c,d,f,!0)},50)}},patch:function(){a.flashEngine=a.support.transform=!0;v(a,{getFiles:function(c,d,f){if(f)return a.filterFiles(a.getFiles(c),d,f),null;var g=a.isArray(c)?c:w[a.uid(c.target||c.srcElement||c)];if(!g)return this.parent.apply(this,arguments);d&&(d=a.getFilesFilter(d),g=a.filter(g,function(a){return d.test(a.name)}));return g},getInfo:function(a,c){a&&!a.flashId?this.parent.apply(this,
arguments):a.info?c(!1,a.info):j.cmd(a,"getFileInfo",{id:a.id,callback:B(function G(d,f){y(G);c(d,a.info=f)})})}});a.support.transform=!0;v(FileAPI.Image.prototype,{_load:function(c,d){a.log("FileAPI.Image._load:",c);if(c&&!c.flashId)this.parent.apply(this,arguments);else{var f=this;a.getInfo(c,function(a){d.call(f,a,c)})}},_apply:function(c,d){a.log("FileAPI.Image._apply:",c);if(c&&!c.flashId)this.parent.apply(this,arguments);else{var g=this.getMatrix(c.info);j.cmd(c,"imageTransform",{id:c.id,matrix:g,
callback:B(function H(k,l){y(H);if(k)d(k);else if(!a.support.dataURI||3E4<l.length){var n={width:!(g.deg%180)?g.dw:g.dh,height:g.deg%180?g.dw:g.dh},r=d,q,s=a.uid(),u=h.createElement("ins");for(q in n)u.setAttribute("data-img-"+q,n[q]);t(u,n);u.innerHTML=f({id:s,src:a.staticPath+"FileAPI.flash.image.swf?r="+a.build,wmode:"opaque",flashvars:"callback="+B(function m(a){try{j.get(s).setImage(l),u=null,y(m)}catch(c){if(!a||"ready"==a.type)clearTimeout(q),q=setTimeout(m,50)}return!0})});r(!1,u)}else{var i=
new Image;a.event.one(i,"error abort load",function(a){d("load"!=a.type&&a.type,i);i=null});i.src="data:"+c.type+";base64,"+l}})})}},toData:function(a){var c=this.data;c&&!c.flashId?this.parent.apply(this,arguments):a.call(this,!c.info,{id:c.id,flashId:c.flashId,name:c.name,type:c.type,matrix:this.getMatrix(c.info)})}});v(a.Form.prototype,{toData:function(c){for(var d=this.items,f=d.length;f--;)if(d[f].file&&d[f].blob&&!d[f].blob.flashId)return this.parent.apply(this,arguments);a.log("flash.Form.toData");
c(d)}});v(a.XHR.prototype,{_send:function(c,d){if(d.nodeName||d.append&&a.support.html5||a.isArray(d)&&"string"===typeof d[0])return this.parent.apply(this,arguments);var f={},g={},h=this,k,l;a.each(d,function(a){a.file?(g[a.name]=a=a.blob,l=a.id,k=a.flashId):f[a.name]=a.blob});a.log("flash.XHR._send:",k,l,g);this.xhr={headers:{},abort:function(){j.cmd(k,"abort",l)},getResponseHeader:function(a){return this.headers[a]},getAllResponseHeaders:function(){return this.headers}};j.cmd(k,"upload",{url:q(c.url),
data:f,files:g,headers:c.headers,callback:B(function z(d){var f=d.type,g=d.result;a.log("flash.upload."+f+":",d);if("progress"==f)d.loaded=Math.min(d.loaded,d.total),d.lengthComputable=!0,c.progress(d);else if("complete"==f)y(z),"string"==typeof g&&(h.responseText=g.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")),h.end(d.status||200);else if("abort"==f||"error"==f)h.end(0,d.message),y(z)})})}})}};a.Flash=j;var u=new Image;a.event.one(u,"error load",function(){a.support.dataURI=
!(1!=u.width||1!=u.height);u=null;j.init()});u.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}})(FileAPI,window,document);"undefined"!==typeof ajs&&ajs.loaded&&ajs.loaded("{fileapi}FileAPI.min");"function"===typeof define&&define.amd&&define("FileAPI",[],function(){return window.FileAPI||{}});