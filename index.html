<!doctype html>
<html xmlns:x="http://xtpl.ru/">
<head>
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>

	<title>FileAPI — multifunction JavaScript router</title>

	<meta name="keywords" content="FileAPI, upload, file, multipart, chunk, images, html5, rubaxa"/>

	<link rel="stylesheet" href="statics/main.css"/>
	<link href="http://fonts.googleapis.com/css?family=Roboto:300,400" rel="stylesheet" type="text/css"/>

	<script src="//code.jquery.com/jquery-1.8.2.min.js"></script>
	<script>!window.jQuery && document.write('<script src="/js/jquery.dev.js"><'+'/script>');</script>

	<script src="http://xtpl.ru/js/xtpl.min.js"></script>
</head>
<body class="body">

	<x:tpl ctrl="main">
		<div id="sidebar" class="sidebar">
			<div>
				<div class="menu">
					<ul x:if="ctx.lang == 'ru'">
						<li><a href="https://github.com/mailru/FileAPI">Репозиторий на GitHub</a></li>
						<li><a href="http://rubaxa.github.com/jquery.fileapi/">jQuery Plugin</a></li>
						<li><a href="./examples/demo.html">Пример #1: demo</a></li>
						<li><a href="./examples/userpic.html">Пример #2: userpic</a></li>
						<li><a href="./examples/watermark.html">Пример #3: watermark</a></li>
						<li><a href="./examples/webcam.html">Пример #4: webcam</a></li>
						<li><a href="#en/{{ctx.relpath}}">{{ctx.lang == 'ru' ? 'English version' : 'Русская версия'}}</a></li>
					</ul>

					<ul x:if="ctx.lang != 'ru'">
						<li><a href="https://github.com/mailru/FileAPI">GitHub repository</a></li>
						<li><a href="http://rubaxa.github.com/jquery.fileapi/">jQuery Plugin</a></li>
						<li><a href="./examples/base.html">Example #1: demo</a></li>
						<li><a href="./examples/userpic.html">Example #2: userpic</a></li>
						<li><a href="./examples/watermark.html">Example #3: watermark</a></li>
						<li><a href="./examples/webcam.html">Example #4: webbam</a></li>
						<li><a href="#ru/{{ctx.relpath}}">Русская версия</a></li>
					</ul>
				</div>

				<div class="menu" x:repeat="item in ctx.api">
					<a href="#{{ctx.lang}}/{{item.label}}" class="menu__name">{{item['class']}}</a>
					<ul>
						<li x:repeat="prop in item.props">
							<a href="#{{ctx.lang}}/{{prop.label}}">{{prop.name}}</a>
						</li>
					</ul>
					<ul>
						<li x:repeat="(name, item) in item.fn">
							<a href="#{{ctx.lang}}/{{item.label}}">{{name}}</a>
						</li>
					</ul>
				</div>
				<div style="height: 5px;"></div>
			</div>
		</div>

		<div>
			<div class="body__top"></div>
			<div>&nbsp;</div>

			<div class="content">
				<div class="logo"></div>

				<div x:repeat="item in ctx.api">
					<a name="{{ctx.lang}}/{{item.label}}"></a>

					<h3>{{item['class']}}</h3>

					<div style="margin-bottom: 30px;">
						<div>
							<x:v mod="txt.hl" output="text" bind="true">item.descr[ctx.lang]</x:v>
						</div>
						<br/>

						<div style="margin-left: 20px;">
							<div x:repeat="prop in item.props">
								<a name="{{ctx.lang}}/{{prop.label}}"></a>
								<h4 class="fn" data-anchor="prop">
									<x:switch select="prop.type">
										<x:case test="-1">
											{{prop.name}}
										</x:case>

										<x:default>
											{{prop.name}}:
											<span class="type">{{prop.type}}</span>
										</x:default>
									</x:switch>
								</h4>
								<div class="descr">
									<x:v mod="txt.hl" output="text" bind="true">prop.descr[ctx.lang] || prop.descr.en</x:v>
								</div>

								<div x:if="prop.code" x:highlight="prop.code.type">
									<pre>
										<code>
											{{prop.code.source[ctx.lang]}}
										</code>
									</pre>
								</div>
								<div x:if="prop.code" style="height: 20px;"></div>
							</div>

							<div x:repeat="fn in item.fn">
								<div x:repeat="variant in fn.variants">
									<a name="{{ctx.lang}}/{{fn.label}}"></a>

									<h4 data-anchor="fn" class="fn">
										<span class="fn__name">{{fn.name}}</span>
										<span class="fn__args">
											<span>( </span>
											<span x:repeat="(idx, arg) in variant.args">
												<x:if test="arg.optional">
													<span class="fn__arg__optional">
														<span>[</span>
														<span x:if="idx">, </span>
														<span>{{arg.name}}:</span>
														<span class="type">{{arg.type}}</span>
														<span>]</span>
													</span>
												</x:if>
												<x:if test="!arg.optional">
													<span x:if="idx">, </span>
													<span>{{arg.name}}:</span>
													<span class="type">{{arg.type}}</span>
												</x:if>
											</span>
											<span> ):</span>
										</span>
										<span class="type">{{fn.returns}}</span>
									</h4>

									<div class="descr">
										<x:v mod="txt.hl" output="text" bind="true">variant.descr[ctx.lang] || variant.descr.en</x:v>
									</div>

									<ul class="args">
										<li x:repeat="arg in variant.args">
											<b>{{arg.name}}</b>
											<span> — </span>
											<span>
												<x:v mod="txt.hl" output="text" bind="true">fn.args[arg.name][ctx.lang]</x:v>
											</span>
										</li>
									</ul>

									<div x:highlight="fn.code.type" x:if="fn.code">
										<pre>
											<code>{{fn.code.source[ctx.lang]}}</code>
										</pre>
									</div>

									<div style="height: 20px;"></div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</x:tpl>



	<script src="./dist/FileAPI.min.js"></script>
	<script src="//yandex.st/highlightjs/7.2/highlight.min.js"></script>


	<script>
		/** @namespace hljs -- highlight.js */
		if( window.hljs ){
			xtpl.decl('highlight', {
				init: function (el, type){
					if( el ){
						el.className += ' language-' + (type == 'js' ? 'javascript' : type);
						hljs.highlightBlock(el);
					}
				}
			});
		}


		xtpl.mod('txt.hl', function (text){
			return	text.replace(/`([^`]+)`/g, '<span class="code">$1</span>');
		});


		$(window).resize(function (){
			$('#sidebar').css('height', $(window).height());
		});


		xtpl.ctrl('main', function (ctx){
			var lang = (window.navigator.userLanguage || window.navigator.language).split('-')[0];
			var _rlang = /(?:\/|^)(en|ru)\//;
			var _updScroll = function (){
				var anchor = location.toString().replace(/^.+#/, '');
				if( anchor ){
					var offset = $('a[name="'+anchor+'"]').offset();
					offset && $(window).scrollTop(offset.top);
				}
				$(window).trigger('resize');
			};

			ctx.api = {};
			ctx.lang = /(en|ru)/.test(lang) ? lang : 'en';


			ctx.getArgs = function (args){
				return	xtpl.utils.map(args, function (arg){
					return	arg.name;
				}).join(', ');
			};


			$(window).bind('hashchange', function (){
				var href = location.toString().split('#').pop();
				var lang = (href.match(_rlang) || [,ctx.lang])[1];

				ctx.lang = lang;
				ctx.relpath = href.replace(/^.+\//, '');

				ctx.$apply && ctx.$apply(_updScroll);
			}).trigger('hashchange');


			$.getJSON('./statics/docs.json?ver='+FileAPI.version, function (json){
				ctx.api = json;
				ctx.$apply(_updScroll);
			});
		});
	</script>
</body>
</html>
